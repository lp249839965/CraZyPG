!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.CZPG={})}(this,function(e){"use strict";function t(e,t,n){this.raw=[],this.x=e||0,this.y=t||0,this.z=n||0}function n(e,t,n,r){this.raw=[],1===arguments.length?this.raw=e.slice(0,4):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0===r?1:r)}function r(){this.raw=r.identity()}function i(e){if(e instanceof Int8Array)return kt;if(e instanceof Uint8Array)return Bt;if(e instanceof Uint8ClampedArray)return Bt;if(e instanceof Int16Array)return Dt;if(e instanceof Uint16Array)return zt;if(e instanceof Int32Array)return jt;if(e instanceof Uint32Array)return Ht;if(e instanceof Float32Array)return Gt;throw new Error("unsupported typed array type")}function o(e){var t=Vt[e];if(!t)throw new Error("unkonw gl type");return t}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Float32Array;return Ut(e)?e:new t(e)}function s(){this._position=new t(0,0,0),this._scale=new t(1,1,1),this._rotation=new t(0,0,0),this._quaternion=new n,this.matrix=new r,this.normMat=new Float32Array(9),this.worldMatrix=new r,this.forward=new Float32Array(4),this.up=new Float32Array(4),this.right=new Float32Array(4),this._needUpdateMatrix=!1,this.needUpdateWorldMatrix=!0}function u(e){return!!e.texStorage2D}function h(e){var t=document.getElementById(e);if(!t||""===t.textContent)throw new Error(e+" shader element does not exist or have text.");var n=t.textContent.indexOf("#version 300 es");return t.textContent.slice(n)}function l(e,t,n){var r=e.createShader(n);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Error compiling shader: \n"+function(e){var t=e.split("\n"),n=(t.length+1).toString().length+6,r=void 0;return t.map(function(e,t){if((r="0:"+(t+1)).length>=n)return r.substring(0,n)+e;for(var i=0;i<n-r.length;i++)r+=" ";return r+e}).join("\n")}(t)+" \n\n"+e.getShaderInfoLog(r));return r}function c(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=void 0,o=void 0;if("string"==typeof t&&t.length<20){i=l(e,h(t),e.VERTEX_SHADER)}else"string"==typeof t&&(i=l(e,t,e.VERTEX_SHADER));if("string"==typeof n&&n.length<20){o=l(e,h(n),e.FRAGMENT_SHADER)}else"string"==typeof n&&(o=l(e,n,e.FRAGMENT_SHADER));var a=e.createProgram();if(e.attachShader(a,i),e.attachShader(a,o),e.bindAttribLocation(a,gt,_t),e.bindAttribLocation(a,Mt,Et),e.bindAttribLocation(a,yt,bt),e.bindAttribLocation(a,Tt,At),r.transformFeedbackVaryings){var s=r.transformFeedbackVaryings;Array.isArray(s)||(s=Object.keys(s)),e.transformFeedbackVaryings(a,s,r.transformFeedbackMode||e.SEPARATE_ATTRIBS)}if(e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error("Error createing shader program.\n\n"+e.getProgramInfoLog(a));if((void 0===r.validateProgram||r.validateProgram)&&(e.validateProgram(a),!e.getProgramParameter(a,e.VALIDATE_STATUS)))throw new Error("Error validating shader program.\n\n"+e.getProgramInfoLog(a));return e.detachShader(a,i),e.detachShader(a,o),e.deleteShader(i),e.deleteShader(o),a}function f(e,t){return Qt[t].bindPoint}function d(e,t){return function(n){e.uniform1i(t,n)}}function m(e,t){return function(n){e.uniform1iv(t,n)}}function p(e,t){return function(n){e.uniform2iv(t,n)}}function v(e,t){return function(n){e.uniform3iv(t,n)}}function _(e,t){return function(n){e.uniform4iv(t,n)}}function g(e,t,n,r){var i=f(0,t);return u(e)?function(t){var o=void 0,a=void 0;t instanceof WebGLTexture?(o=t,a=null):(o=t.texture,a=t.sampler),e.uniform1i(r,n),e.activeTexture(e.TEXTURE0+n),e.bindTexture(i,o),e.bindSampler(n,a)}:function(t){e.uniform1i(r,n),e.activeTexture(e.TEXTURE0+n),e.bindTexture(i,t)}}function b(e,t,n,r,i){for(var o=f(0,t),a=new Int32Array(i),s=0;s<i;++s)a[s]=n+s;return u(e)?function(t){e.uniform1iv(r,a),t.forEach(function(t,r){e.activeTexture(e.TEXTURE0+a[r]);var i=void 0,s=void 0;t instanceof WebGLTexture?(i=t,s=null):(i=t.texture,s=t.sampler),e.bindSampler(n,s),e.bindTexture(o,i)})}:function(t){e.uniform1iv(r,a),t.forEach(function(t,n){e.activeTexture(e.TEXTURE0+a[n]),e.bindTexture(o,t)})}}function y(e,t){return function(n){e.bindBuffer(e.ARRAY_BUFFER,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,n.numComponents||n.size,n.type||e.FLOAT,n.normalize||!1,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}function E(e,t){return function(n){e.bindBuffer(e.ARRAY_BUFFER,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,n.numComponents||n.size,n.type||e.INT,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}function M(e,t,n){var r=n.size,i=n.count;return function(n){e.bindBuffer(e.ARRAY_BUFFER,n.buffer);for(var o=n.size||n.numComponents||r,a=o/i,s=n.type||e.FLOAT,u=Qt[s].size*o,h=n.normalize||!1,l=n.offset||0,c=u/i,f=0;f<i;++f)e.enableVertexAttribArray(t+f),e.vertexAttribPointer(t+f,a,s,h,u,l+c*f),void 0!==n.divisor&&e.vertexAttribDivisor(t+f,n.divisor)}}function A(e){var t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function T(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var o=e.getActiveAttrib(t,i);if(!A(o)){var a=e.getAttribLocation(t,o.name),s=Jt[o.type],u=s.setter(e,a,s);u.location=a,n[o.name]=u}}return n}function x(e,t){Object.keys(t).forEach(function(n){var r=e[n];r&&r(t[n])})}function R(e,t){function n(n){var i=e.getUniformLocation(t,n.name),o=n.size>1&&"[0]"===n.name.substr(-3),a=n.type,s=Qt[a];if(!s)throw new Error("unknown type: 0x"+a.toString(16));var u=void 0;if(s.bindPoint){var h=r;r+=n.size,u=o?s.arraySetter(e,a,h,i,n.size):s.setter(e,a,h,i,n.size)}else u=s.arraySetter&&o?s.arraySetter(e,i):s.setter(e,i);return u.location=i,u}for(var r=0,i={},o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<o;a++){var s=e.getActiveUniform(t,a);if(!A(s)){var u=s.name;"[0]"===u.substr(-3)&&(u=u.substr(0,u.length-3));var h=n(s);i[u]=h}}var l={};return i.keyMap=l,Object.keys(i).forEach(function(e){0===e.indexOf(Ft)&&(l[e.replace(Ft,"")]=e)}),i}function O(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=n.length,o=function(t){var r=n[t];if(Array.isArray(r))for(var i=r.length,o=0;o<i;o++)O(e,r[o]);else Object.keys(r).forEach(function(t){var n=e[t];void 0===n&&Object.prototype.hasOwnProperty.call(e.keyMap,t)&&(n=e[e.keyMap[t]]),n&&n(r[t])})},a=0;a<i;a++)o(a)}function P(e,t){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=[],i=[],o=0;o<n;o++){i.push(o),r.push({});var a=e.getActiveUniform(t,o);if(A(a))break;r[o].name=a.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockIndex"],["UNIFORM_OFFSET","offset"]].forEach(function(n){var o=n[0],a=n[1];e.getActiveUniforms(t,i,e[o]).forEach(function(e,t){r[t][a]=e})});for(var s={},u=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS),h=0;h<u;h++){var l=e.getActiveUniformBlockName(t,h),c={index:h,usedByVertexShader:e.getActiveUniformBlockParameter(t,h,e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:e.getActiveUniformBlockParameter(t,h,e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:e.getActiveUniformBlockParameter(t,h,e.UNIFORM_BLOCK_DATA_SIZE),uniformIndices:e.getActiveUniformBlockParameter(t,h,e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)};c.used=c.usedByVertexShader||c.usedByFragmentShader,s[l]=c}return{blockSpecs:s,uniformData:r}}function w(e,t,n,r){var i=n.blockSpecs,o=n.uniformData,a=i[r];if(!a)return console.warn("no uniform block object named: "+r),{name:r,uniforms:{}};var s=new ArrayBuffer(a.size),u=e.createBuffer(),h=a.index;e.bindBuffer(e.UNIFORM_BUFFER,u),e.uniformBlockBinding(t,a.index,h);var l=r+".";$t.test(l)&&(l=l.replace($t,"."));var c={};return a.uniformIndices.forEach(function(e){var t=o[e],n=Qt[t.type],r=n.Type,i=t.size*n.size,a=t.name;a.substr(0,l.length)===l&&(a=a.substr(l.length)),c[a]=new r(s,t.offset,i/r.BYTES_PER_ELEMENT)}),{name:r,array:s,typedArray:new Float32Array(s),buffer:u,uniforms:c}}function I(e,t,n){var r={};return Object.keys(n.blockSpecs).forEach(function(i){r[i]=w(e,t,n,i)}),r}function F(e,t,n){var r=t.blockSpecs[n.name];if(r){var i=r.index;return e.bindBufferRange(e.UNIFORM_BUFFER,i,n.buffer,n.offset||0,n.array.byteLength),!0}return!1}function S(e,t,n){F(e,t,n)&&e.bufferData(e.UNIFORM_BUFFER,n.array,e.DYNAMIC_DRAW)}function N(e,t){var n=e.uniforms,r=!1;return Object.keys(t).forEach(function(e){var i=n[e];if(i){var o=t[e];o.length?i.set(o):i[0]=o,r=!0}}),r}function C(e,t,n,r){Object.keys(n).forEach(function(i){N(n[i],r)?S(e,t,n[i]):F(e,t,n[i])})}function L(e,t){for(var n={},r=e.getProgramParameter(t,e.TRANSFORM_FEEDBACK_VARYINGS),i=0;i<r;i++){var o=e.getTransformFeedbackVarying(t,i);n[o.name]={index:i,type:o.type,size:o.size}}return n}function U(e,t,n,r){var i=e.createTransformFeedback();return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i),e.useProgram(t),function(e,t,n){n.attribs&&(n=n.attribs),Object.keys(n).forEach(function(r){var i=t[r];if(i){var o=n[r];o.offset?e.bindBufferRange(e.TRANSFORM_FEEDBACK_BUFFER,i.index,o.buffer,o.offset,o.size):e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,i.index,o.buffer)}})}(e,n,r),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),function(e,t,n){n.attribs&&(n=n.attribs),Object.keys(n).forEach(function(n){var r=t[n];r&&e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r.index,null)})}(e,n,r),i}function k(e){return"index"===e||"indices"===e}function B(e){return e.length?e:e.data}function D(e,t){return Ut(e)?e:k(t)?new Uint16Array(e):new Float32Array(e)}function z(e,t){var n=void 0;if(n=en.test(e)?4:tn.test(e)?2:3,t%n>0)throw new Error("Can not guess numComponents for attribute "+e+".");return n}function j(e,t){return e.numComponents||e.size||z(t,B(e).length)}function H(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.ARRAY_BUFFER,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.STATIC_DRAW;if(t instanceof WebGLBuffer)return t;var i=e.createBuffer();return e.bindBuffer(n,i),e.bufferData(n,t,r),i}function G(e,t,n){var r="indices"===n?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;return H(e,D(B(t),n),r,t.drawType)}function V(e,t){var n={};return Object.keys(t).forEach(function(r){if(!k(r)){var o=t[r],a=o.name||o.attrib||o.attribName||r,s=void 0!==o.normalize&&o.normalize,u=void 0,h=void 0,l=void 0;if("number"==typeof o||"number"==typeof o.data){var c=o.data||o,f=o.type||Float32Array,d=c*f.BYTES_PER_ELEMENT;h=function(e){switch(e){case Int8Array:return kt;case Uint8Array:case Uint8ClampedArray:return Bt;case Int16Array:return Dt;case Uint16Array:return zt;case Int32Array:return jt;case Uint32Array:return Ht;case Float32Array:return Gt;default:throw new Error("unsupported typed array type")}}(f),l=o.numComponents||o.size||z(r,c),u=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,d,o.drawType||e.STATIC_DRAW)}else{var m=D(B(o),r);u=o.buffer||H(e,m,e.ARRAY_BUFFER,o.drawType),h=i(m),l=j(o,r),o.numComponents=l}n[a]={buffer:u,numComponents:l,type:h,normalize:s,stride:o.stride||0,offset:o.offset||0,divisor:void 0===o.divisor?void 0:o.divisor,drawType:o.drawType||e.STATIC_DRAW}}}),n}function W(e,t){var n={attribs:V(e,t)},r=t.indices;if(r){var o=D(B(r),"indices");n.indices=H(e,o,e.ELEMENT_ARRAY_BUFFER),n.numElements=o.length,n.elementType=i(o)}else n.numElements=function(e,t){var n=void 0,r=void 0;for(r=0;r<nn.length;r++)if(nn[r]in t){n=nn[r];break}if(r===nn.length){var i=Object.keys(t);n=qt(i,1)[0]}var o=t[n];e.bindBuffer(e.ARRAY_BUFFER,o.buffer);var a=e.getBufferParameter(e.ARRAY_BUFFER,e.BUFFER_SIZE);e.bindBuffer(e.ARRAY_BUFFER,null);var s=void 0;if(0!==o.stride)s=Math.floor((a-o.offset)/o.stride);else{var u=function(e,t){return t===e.BYTE?1:t===e.UNSIGNED_BYTE?1:t===e.SHORT?2:t===e.UNSIGNED_SHORT?2:t===e.INT?4:t===e.UNSIGNED_INT?4:t===e.FLOAT?4:0}(e,o.type),h=(a-o.offset)/u,l=o.numComponents||o.size;if((s=h/l)%1!=0)throw new Error("numComponent "+l+" not correct for length "+h)}return s}(e,n.attribs);return n}function X(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DYNAMIC_DRAW;e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,n,r)}function Y(){this.raw=Y.identity()}function q(e,t,n,r){this.cullFace=!0,this.blend=!1,this.depth=!0,this.sampleBlend=!1,this.shaders=[t,n],this.program=null,this.programs=[],this.programMap=[],this.gl=e,this.opts=r,this.camera=null,this.currentUniformObj={},this.uniformObj={},this.programInfos=[],this.uniformObjs=[],this._programUpdated=!1,this.setDefines()}function Z(e,t,n){return[e.slice(0,t),n,e.slice(t)].join("")}function K(e){q.call(this,e,K.vs,K.fs),this.deactivate()}function Q(e){this.mesh=e,this.enablePick=!0,this.transform=new s,this.node=null,this._uniformObj={}}function J(e,t){var n=e.x-t.x,r=e.y-t.y,i=e.z-t.z;return n*n+r*r+i*i}function $(e,t,n){var r=t.x,i=t.y,o=t.z,a=n.x-r,s=n.y-i,u=n.z-o;if(0!==a||0!==s||0!==u){var h=((e.x-r)*a+(e.y-i)*s+(e.z-o)*u)/(a*a+s*s+u*u);h>1?(r=n.x,i=n.y,o=n.z):h>0&&(r+=a*h,i+=s*h,o+=u*h)}return a=e.x-r,s=e.y-i,u=e.z-o,a*a+s*s+u*u}function ee(e,t,n){var r=void 0!==t?t*t:1;return e=n?e:function(e,t){for(var n=e[0],r=[n],i=void 0,o=1,a=e.length;o<a;o++)J(i=e[o],n)>t&&(r.push(i),n=i);return n!==i&&r.push(i),r}(e,r),e=function(e,t){var n=e.length,r=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(n),i=0,o=n-1,a=[],s=[],u=void 0,h=void 0,l=void 0,c=void 0;for(r[i]=r[o]=1;o;){for(h=0,u=i+1;u<o;u++)(l=$(e[u],e[i],e[o]))>h&&(c=u,h=l);h>t&&(r[c]=1,a.push(i,c,c,o)),o=a.pop(),i=a.pop()}for(u=0;u<n;u++)r[u]&&s.push(e[u]);return s}(e,r)}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];Object.keys(t).forEach(function(e){"indices"!==e&&(t[e].data=a(t[e].data),t[e].numComponents=j(t[e],e))}),Object.assign(this,{name:e,attribArrays:t,_bufferInfo:null,drawMode:Nt,cullFace:!0,blend:!1,depth:!0,sampleBlend:!1,instanceCount:void 0,offset:0},n)}function ne(e){var t=e.mesh||e,n=t.attribArrays,r=n.indices.data,i=t.drawMode;r&&i===Nt&&(Object.keys(n).forEach(function(e){if("indices"!==e){for(var t=n[e].data,i=n[e].numComponents,o=[],a=0;a<r.length;a++)for(var s=0;s<i;s++)o.push(t[r[a]*i+s]);n[e].data=o}}),delete n.indices,delete t.bufferInfo,delete t.vao)}function re(e,t){q.call(this,e,re.vs,re.fs),this.setCamera(t),this.setUniformObj({u_colors:[.5,.5,.5,1,0,0,0,1,0,0,0,1]}),this.deactivate()}function ie(e,t,n){q.call(this,e,ie.vs,ie.fs),this.setCamera(t),this.setUniformObj({u_texture:n}),this.deactivate()}function oe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;q.call(this,e,oe.vs,oe.fs),this.setCamera(t),this.setUniformObj({u_dayTex:n,u_nightTex:r,u_rate:i}),this.deactivate()}function ae(e,t){q.call(this,e,ae.vs,ae.fs),this.setCamera(t),this.setUniformObj({position:[10,10,10],color:[1,1,1],ambientColor:[.07,.07,.07],shiness:20,diffuseFactor:.3,specularFactor:.1,isFlat:!1,isBlinn:!0,isGamma:!0}),this.deactivate()}function se(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,105/255,180/255,125/255];q.call(this,e,se.vs,se.fs),this.setCamera(t),this.setPointSize(n),this.setColor(r),this.deactivate()}function ue(e,t){q.call(this,e,ue.vs,ue.fs),this.setCamera(t),this.setUniformObj({position:[10,10,10],color:[1,1,1],ambientColor:[.15,.15,.15],falloff:.15,radius:5,shiness:20,specularFactor:.1,roughness:.5,albedo:.85,isFlat:!1,isGamma:!0}),this.deactivate()}function he(e,t){q.call(this,e,he.vs,he.fs),this.setCamera(t),this.setColor([0,0,0]),this.deactivate()}function le(e,t){q.call(this,e,le.vs,le.fs),this.sampleBlend=!0,this.setCamera(t),this.setUniformObj({thickness:.5,screenWidth:!0,stroke:[0,157/255,118/255,1],fill:[1,147/255,172/255,0],backStroke:[0,88/255,83/255,1],feather:1,colorBack:!1,noiseSmall:!1,noiseBig:!1,squeeze:!1,squeezeEndpoint:.5,squeezeMiddle:1,dash:!1,dashRepeats:10,dashLength:.5,dashOverlap:!0,dashAnimate:!1,dualStroke:!1,secondThickness:.2}),this.deactivate()}function ce(e,t){q.call(this,e,ce.vs,ce.fs),this.setCamera(t),this.setUniformObj({linewidth:1,color:[1,105/255,180/255,1],screenSize:!0,tile:.3}),this.blend=!0,this.depth=!1,this.deactivate()}function fe(e,t,n,r,i){q.call(this,e,t,n,{transformFeedbackVaryings:r,transformFeedbackMode:i}),this.transformfeedbackInfo=L(e,this.program),this._customAttrib=!0,this.deactivate()}function de(e,t){q.call(this,e,de.vs,de.fs,{validateProgram:!1}),this.setCamera(t),this.deactivate(),this._maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS)}function me(e,t,n){var r=e.mesh||e,i=void 0;if(r&&r.attribArrays&&r.attribArrays[_t]){if(3!==r.attribArrays[_t].numComponents)return console.error("MeshLine need 3 dimensions points array, but received "+r.attribArrays[_t].numComponents+" dimensions array."),null;i=r.attribArrays[_t].data}else{if(!Array.isArray(r))return console.error("MeshLine need 3 dimensions points array, but received Object "+e),null;if(r.length%3!=0)return console.error("MeshLine need 3 dimensions points array, but received array's length divided by 3 not 0."),null;i=r}this.widthCallback=t;var o=this.process(i,n||r.name&&r.name+"_Meshline"||"MeshLine");Q.call(this,o)}function pe(){}function ve(e){var t=_n[e];if(!t)throw new Error("unknown internal format");return{format:t.textureFormat,type:Array.isArray(t.type)?t.type[0]:t.type}}function _e(e,t,n){var r=n||vn.textureOptions,i=r.target||e.TEXTURE_2D;if(e.bindTexture(i,t),!1!==r.color){var o=function(e){var t=e||vn.textureColor;return Ut(t)?t:new Uint8Array([t[0],t[1],t[2],t[3]])}(n.color);if(i===e.TEXTURE_CUBE_MAP)for(var a=0;a<6;a++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);else i===e.TEXTURE_3D||i===e.TEXTURE_2D_ARRAY?e.texImage3D(i,0,e.RGBA,1,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage2D(i,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o)}}function ge(e,t,n){function r(){s.removeEventListener("error",i),s.removeEventListener("load",o),s=null}function i(){a("couldn't load image: "+e,s),r()}function o(){a(null,s),r()}var a=n||pe,s=new Image,u=void 0!==t?t:bn(e);return void 0!==u&&(s.crossOrigin=u),s.addEventListener("error",i),s.addEventListener("load",o),s.src=e,s}function be(e,t){void 0!==t.colorspaceConversion&&(yn.colorspaceConversion=e.getParameter(e.UNPACK_COLORSPACE_CONVERSION_WEBGL),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.colorspaceConversion)),void 0!==t.premultiplyAlpha&&(yn.premultiplyAlpha=e.getParameter(e.UNPACH_PREMULTIPLY_ALPHA_WEBGL),e.pixelStorei(e.UNPACH_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha)),void 0!==t.flipY&&(yn.flipY=e.getParameter(e.UNPACK_FLIP_Y_WEBGL),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY))}function ye(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,yn.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(e.UNPACH_PREMULTIPLY_ALPHA_WEBGL,yn.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,yn.flipY)}function Ee(e,t){return(t||{}).cubeFaceOrder||[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z]}function Me(e,t){var n=Ee(e,t).map(function(e,t){return{face:e,idx:t}});return n.sort(function(e,t){return e.face-t.face}),n}function Ae(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function Te(e){return 0==(e&e-1)}function xe(e,t,n,r,i,o,a){var s=n||vn.textureOptions,h=o||e.RGBA,l=(a||e.UNSIGNED_SHORT,s.target||e.TEXTURE_2D),c=r||s.width,f=i||s.height;if(e.bindTexture(l,t),function(e,t,n,r){if(!u(e))return Te(t)&&Te(n);var i=_n[r];if(!i)throw new Error("unknown internal format");return i.colorRenderable&&i.textureFilterable}(e,c,f,h))e.generateMipmap(l);else{var d=function(e){var t=_n[e];if(!t)throw new Error("unknow internal format");return t.textureFilterable}(h)?e.LINEAR:e.NEAREST;e.texParameteri(l,e.TEXTURE_MIN_FILTER,d),e.texParameteri(l,e.TEXTURE_MAG_FILTER,d),e.texParameteri(l,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(l,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}}function Re(e,t,n){var r=n.target||e.TEXTURE_2D;e.bindTexture(r,t),function(e,t,n,r){r.minMag&&(n.call(e,t,e.TEXTURE_MIN_FILTER,r.minMag),n.call(e,t,e.TEXTURE_MAG_FILTER,r.minMag)),r.min&&n.call(e,t,e.TEXTURE_MIN_FILTER,r.min),r.mag&&n.call(e,t,e.TEXTURE_MAG_FILTER,r.mag),r.wrap&&(n.call(e,t,e.TEXTURE_WRAP_S,r.wrap),n.call(e,t,e.TEXTURE_WRAP_T,r.wrap),(t===e.TEXTURE_3D||t instanceof En)&&n.call(e,t,e.TEXTURE_WRAP_R,r.wrap)),r.wrapR&&n.call(e,t,e.TEXTURE_WRAP_R,r.wrapR),r.wrapS&&n.call(e,t,e.TEXTURE_WRAP_S,r.wrapS),r.wrapT&&n.call(e,t,e.TEXTURE_WRAP_T,r.wrapT),r.minLod&&n.call(e,t,e.TEXTURE_MIN_LOD,r.minLod),r.maxLod&&n.call(e,t,e.TEXTURE_MAX_LOD,r.maxLod),r.baseLevel&&n.call(e,t,e.TEXTURE_BASE_LEVEL,r.baseLevel),r.maxLevel&&n.call(e,t,e.TEXTURE_MAX_LEVEL,r.maxLevel)}(e,r,e.texParameteri,n)}function Oe(e,t,n,r){var i=r||vn.textureOptions,o=i.target||e.TEXTURE_2D,a=i.level||0,s=n.width,u=n.height,h=i.internalFormat||i.format||e.RGBA,l=ve(h),c=i.format||l.format,f=i.type||l.type;if(be(e,i),e.bindTexture(o,t),o===e.TEXTURE_CUBE_MAP){var d=n.width,m=n.height,p=void 0,v=void 0;if(d/6===m)p=m,v=[0,0,1,0,2,0,3,0,4,0,5,0];else if(m/6===d)p=d,v=[0,0,0,1,0,2,0,3,0,4,0,5];else if(d/3==m/2)p=d/3,v=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(d/2!=m/3)throw new Error("can't guess cube map from element: "+(n.src?n.src:n.nodeName));p=d/2,v=[0,0,1,0,0,1,1,1,0,2,1,2]}Mn.canvas.width=p,Mn.canvas.height=p,s=p,u=p,Me(e,r).forEach(function(t){var r=v[2*t.idx+0]*p,i=v[2*t.idx+1]*p;Mn.drawImage(n,r,i,p,p,0,0,p,p),e.texImage2D(t.face,a,h,c,f,Mn.canvas)}),Mn.canvas.width=1,Mn.canvas.height=1}else if(o===e.TEXTURE_3D){var _=Math.min(n.width,n,u),g=Math.max(n.width,n.height),b=g/_;if(b%1!=0)throw new Error("can not compute TEXTURE_3D dimensions of element");var y=n.width===g?1:0,E=n.height===g?1:0;e.texImage3D(o,a,h,_,_,_,0,c,f,null),Mn.canvas.width=_,Mn.canvas.height=_;for(var M=0;M<b;M++){var A=M*_*y,T=M*_*E,x=_,R=_,O=_,P=_;Mn.drawImage(n,A,T,x,R,0,0,O,P),e.texSubImage3D(o,a,0,0,M,_,_,1,c,f,Mn.canvas)}Mn.canvas.width=1,Mn.canvas.height=1}else e.texImage2D(o,a,h,c,f,n);return ye(e,r),Ae(i)&&xe(e,t,r,s,u,h,f),Re(e,t,r),t}function Pe(e,t,n){return Ut(t)?i(t):n||e.UNSIGNED_BYTE}function we(e,t,n,r,i){if(i%1!=0)throw new Error("can't guess dimensions");var o=void 0,a=void 0;if(n||r){if(r){if(!n&&(o=i/r)%1)throw new Error("can't guess dimensions")}else if((a=i/n)%1)throw new Error("can't guess dimensions")}else{var s=Math.sqrt(i/(t===e.TEXTURE_CUBE_MAP?6:1));s%1==0?(o=s,a=s):(o=i,a=1)}return{width:o,height:a}}function Ie(e,t,n,r){var i=r||vn.textureOptions,a=i.target||e.TEXTURE_2D;e.bindTexture(a,t);var s=i.width,u=i.height,h=i.depth,l=i.level||0,c=i.internalFormat||i.format||e.RGBA,f=ve(c),d=i.format||f.format,m=i.format||Pe(e,n,f.type),p=n;if(Ut(p))p instanceof Uint8ClampedArray&&(p=new Uint8Array(p.buffer));else{var v=o(m);p=new v(n)}var _=function(e,t){var n=_n[e];if(!n)throw new Error("unknown internal format");var r=n.bytesPerElementMap[t];if(void 0===r)throw new Error("unknown internal format");return r}(c,m),g=p.byteLength/_;if(g%1)throw new Error("length wrong for format: "+Kt(e,d));var b=void 0;if(a===e.TEXTURE_3D)if(s||u||h)!s||u&&h?!u||s&&h?(b=we(e,a,s,u,g/h),s=b.width,u=b.height):(b=we(e,a,s,h,g/u),s=b.width,h=b.height):(b=we(e,a,u,h,g/s),u=b.width,h=b.height);else{var y=Math.cbrt(g);if(y%1!=0)throw new Error("can't guess size of array of numElements: "+g);s=y,u=y,h=y}else b=we(e,a,s,u,g),s=b.width,u=b.height;if(e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment||1),be(e,r),a===e.TEXTURE_CUBE_MAP){var E=g/6*(_/p.BYTES_PER_ELEMENT);Me(e,r).forEach(function(t){var n=E*t.idx,r=p.subarray(n,n+E);e.texImage2D(t.face,l,c,s,u,0,d,m,r)})}else a===e.TEXTURE_3D?e.texImage3D(a,l,c,s,u,h,0,d,m,p):e.texImage2D(a,l,c,s,u,0,d,m,p);return ye(e,r),{width:s,height:u,depth:h,type:m}}function Fe(e,t,n,r){var i=r||pe,o=n.src;if(6!==o.length)throw new Error("there must be 6 urls for a cubemap");var a=n.level||0,s=n.internalFormat||n.format||e.RGBA,u=ve(s),h=n.format||u.format,l=n.type||e.UNSIGNED_BYTE,c=n.target||e.TEXTURE_2D;if(c!==e.TEXTURE_CUBE_MAP)throw new Error("target must be TEXTURE_CUBE_MAP");_e(e,t,n);var f=Object.assign({},n),d=6,m=[],p=Ee(e,f),v=void 0;v=o.map(function(n,r){return ge(n,f.crossOrigin,function(n){return function(r,o){d-=1,r?m.push(r):(be(e,f),e.bindTexture(c,t),5===d?Ee(e).forEach(function(t){e.texImage2D(t,a,s,h,l,o)}):e.texImage2D(n,a,s,h,l,o),ye(e,f),Ae(f)&&e.generateMipmap(c)),0===d&&i(m.length?m:void 0,v,t)}}(p[r]))})}function Se(e,t,n,r){var i=r||pe,o=n.src,a=n.internalFormat||n.format||e.RGBA,s=ve(a),u=n.format||s.format,h=n.type||e.UNSIGNED_BYTE,l=n.target||e.TEXTURE_2D_ARRAY;if(l!==e.TEXTURE_3D&&l!==e.TEXTURE_2D_ARRAY)throw new Error("target must be TEXTURE_3D or TEXTURE_2D_ARRAY");_e(e,t,n);var c=Object.assign({},n),f=o.length,d=[],m=void 0,p=c.level||0,v=c.width,_=c.height,g=o.length,b=!0;m=o.map(function(n,r){return ge(n,c.crossOrigin,function(n){return function(r,o){if(f-=1,r)d.push(r);else{if(be(e,c),e.bindTexture(l,t),b){b=!1,v=c.width||o.width,_=c.width||o.width,e.texImage3D(l,p,a,v,_,g,0,u,h,null);for(var s=0;s<g;s++)e.texSubImage3D(l,p,0,0,s,v,_,1,u,h,o)}else{var y=o;o.width===v&&o.height===_||(y=Mn.canvas,Mn.canvas.width=v,Mn.canvas.height=_,Mn.drawImage(o,0,0,v,_)),e.texSubImage3D(l,p,0,0,n,v,_,1,u,h,y),y===Mn.canvas&&(Mn.canvas.width=0,Mn.canvas.height=0)}ye(e,c),Ae(c)&&e.generateMipmap(l)}0===f&&i(d.length?d:void 0,m,t)}}(r))})}function Ne(e,t,n){var r=n||pe,i=t||vn.textureOptions,o=e.createTexture(),a=i.target||e.TEXTURE_2D,s=i.width||1,u=i.height||1,h=i.internalFromat||e.RGBA,l=ve(h),c=i.type||l.type;e.bindTexture(a,o),a===e.TEXTURE_CUBE_MAP&&(e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE));var f=i.src;if(f)if("string"==typeof f)!function(e,t,n,r){var i=r||pe,o=n||vn.textureOptions;_e(e,t,o);var a=Object.assign({},o),s=ge(o.src,a.crossOrigin,function(n,r){n?i(n,t,s):(Oe(e,t,r,a),i(null,t,r))})}(e,o,i,r);else if(Ut(f)||Array.isArray(f)&&("number"==typeof f[0]||Array.isArray(f[0])||Ut(f[0]))){var d=Ie(e,o,f,i);s=d.width,u=d.height,c=d.type}else if(Array.isArray(f)&&"string"==typeof f[0])a===e.TEXTURE_CUBE_MAP?Fe(e,o,t,r):Se(e,o,i,r);else{if(!(f instanceof HTMLElement))throw new Error("unsupported src type");Oe(e,o,f,i),s=f.width,u=f.height}else!function(e,t,n){var r=n.target||e.TEXTURE_2D;e.bindTexture(r,t);var i=n.level||0,o=n.internalFormat||n.format||e.RGBA,a=ve(o),s=n.format||a.format,u=n.type||a.type;if(be(e,n),r===e.TEXTURE_CUBE_MAP)for(var h=0;h<6;++h)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+h,i,o,n.width,n.height,0,s,u,null);else r===e.TEXTURE_3D?e.texImage3D(r,i,o,n.width,n.height,n.depth,0,s,u,null):e.texImage2D(r,i,o,n.width,n.height,0,s,u,null);ye(e,n)}(e,o,i);return Ae(t)&&xe(e,o,i,s,u,h,c),Re(e,o,i),o}function Ce(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.width,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.height,o=n.target||e.TEXTURE_2D;e.bindTexture(o,t);var a=n.level||0,s=n.internalFormat||n.format||e.RGBA,u=ve(s),h=n.format||u.format,l=void 0,c=n.src;if(l=c&&(Ut(c)||Array.isArray(c)&&"number"==typeof c[0])?n.type||Pe(e,c,u.type):n.type||u.type,o===e.TEXTURE_CUBE_MAP)for(var f=0;f<6;f++)e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X+f,a,s,r,i,0,h,l,null);else e.texImage2D(o,a,s,r,i,0,h,l,null)}function Le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.clearColor(t,n,r,i),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function Ue(){this.transform=new s,this.projMat=r.identity(),this.viewMat=r.identity(),this.target=new t,this.up=[0,1,0],this.matrix=this.transform.matrix.raw}function ke(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:45,t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;Ue.call(this),this._fov=e,this.fovRadian=Lt.degree2Radian(this._fov),this.aspect=t,this.near=n,this.far=i,r.perspective(this.projMat,this.fovRadian,t,n,i)}function Be(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*e;Ue.call(this),this.size=e,this.aspect=t,this.near=n,this.far=i,this.zoom=1,this.left=this.size*this.aspect/-2,this.right=this.size*this.aspect/2,this.bottom=this.size/-2,this.top=this.size/2,r.ortho(this.projMat,this.left/this.zoom,this.right/this.zoom,this.bottom/this.zoom,this.top/this.zoom,this.near/this.zoom,this.far/this.zoom)}function De(e,t){this.raw=[],this.x=e||0,this.y=t||0}function ze(e,t,n){this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0}function je(e){this.files=[],this.items=[],this.addFiles(e)}function He(){this.line="",this.cArray=[]}function Ge(e){"string"==typeof e?this.name=e:e&&e.isModel?this.setModel(e):this.name="NODE_"+Rn++,this.children=[],this.parent=null,this.transform=this.model?this.model.transform:new s,this.matrix=this.transform.matrix,this.worldMatrix=this.transform.worldMatrix,this.needUpdateWorldMatrix=this.transform.needUpdateWorldMatrix}function Ve(){this.currentSceneName="null"}function We(e,t){return void 0!==t?console.error("glTF not have "+e+" on index "+t):console.error("glTF not have "+e+" property"),!1}function Xe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments[3],i=arguments[4];this.shader=new se(e,t,r,i);var o={};o[_t]={data:n,drawType:e.DYNAMIC_DRAW},this.mesh=new te("PointHelper",o,{drawMode:e.POINTS}),this.model=new Q(this.mesh),this.gl=e}function Ye(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,105/255,180/255,1,1,182/255,193/255,80/255];q.call(this,e,Ye.vs,Ye.fs),this.setCamera(t),this.setColors(n),this.deactivate()}function qe(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1;this.shader=new Ye(e,t,r),this.normalLength=i;var o=n&&this._getdata(n),a={};a[_t]={data:o,drawType:e.DYNAMIC_DRAW},this.mesh=new te("LineHelper",a,{drawMode:e.LINES}),this.model=new Q(this.mesh),n.isModel&&this.setTransform(n.transform),this.gl=e,this.copyToWorldMatrix=!0}function Ze(e,t,n){this.x=e,this.y=t,this.z=n}function Ke(e){return e*e*e*(e*(6*e-15)+10)}function Qe(e,t,n){return(1-n)*e+n*t}function Je(e,t,n,r){for(var i=void 0,o=void 0,a=void 0,s=n-1,u=t-1,h=void 0,l=void 0,c=void 0,f=void 0,d=void 0,m=void 0,p=void 0,v=[],_=t*n,g=0;g<_;g++)a=3*(o=Math.floor(g/n))*n+3*(i=g%n),d=i>0?e[3*o*n+3*(i-1)+1]:e[a+1],m=i<s?e[3*o*n+3*(i+1)+1]:e[a+1],p=o>0?e[3*(o-1)*n+3*i+1]:e[a+1],h=d-m,l=r,c=(o<u?e[3*(o+1)*n+3*i+1]:e[a+1])-p,f=Math.sqrt(h*h+l*l+c*c),v.push(h/f,l/f,c/f);return v}function $e(e,t){return Bn||(Bn=e.createRenderbuffer()),t instanceof Bn.constructor}function et(e,t){return Dn||(Dn=e.createTexture()),t instanceof Dn.constructor}function tt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ln,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.drawingBufferWidth,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.drawingBufferHeight,i=e.FRAMEBUFFER,o=e.createFramebuffer();e.bindFramebuffer(i,o);var a=0,s={framebuffer:o,attachments:[],width:n,height:r};if(t.forEach(function(t){var o=t.attachment,u=t.format,h=function(e){return Un[e]}(u);if(h||(h=e.COLOR_ATTACHMENT0+a++),!o)if(function(e){return kn[e]}(u))o=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o),e.renderbufferStorage(e.RENDERBUFFER,u,n,r),e.bindRenderbuffer(e.RENDERBUFFER,null);else{var l=Object.assign({},t,{width:n,height:r});void 0===l.auto&&(l.auto=!1,l.min=l.min||l.minMag||e.LINEAR,l.mag=l.mag||l.minMag||e.LINEAR,l.wrapS=l.wrapS||l.wrap||e.CLAMP_TO_EDGE,l.wrapT=l.wrapT||l.wrap||e.CLAMP_TO_EDGE),o=Ne(e,l)}if($e(e,o))e.framebufferRenderbuffer(i,h,e.RENDERBUFFER,o);else{if(!et(e,o))throw new Error("unkonwn attachment type for framebuffer");e.framebufferTexture2D(i,h,t.texTarget||e.TEXTURE_2D,o,t.level||0)}s.attachments.push(o)}),a>1){for(var u=[],h=0;h<a;h++)u.push(e.COLOR_ATTACHMENT0+h);e.drawBuffers(u)}switch(e.checkFramebufferStatus(e.FRAMEBUFFER)){case e.FRAMEBUFFER_COMPLETE:break;case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.log("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.log("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.log("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case e.FRAMEBUFFER_UNSUPPORTED:console.log("FRAMEBUFFER_UNSUPPORTED");break;case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:console.log("FRAMEBUFFER_INCOMPLETE_MULTISAMPLE");break;case e.RENDERBUFFER_SAMPLES:console.log("RENDERBUFFER_SAMPLES")}return e.bindFramebuffer(e.FRAMEBUFFER,null),s}function nt(e,t){var n=e.FRAMEBUFFER;t?(e.bindFramebuffer(n,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(n,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}function rt(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=new Uint8Array(4);return e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer||t),e.readBuffer(e.COLOR_ATTACHMENT0+i),e.readPixels(n,r,1,1,e.RGBA,e.UNSIGNED_BYTE,o),e.bindFramebuffer(e.FRAMEBUFFER,null),o}function it(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ln,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.drawingBufferWidth,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.drawingBufferHeight;t.width=r,t.height=i,n.forEach(function(n,o){var a=t.attachments[o],s=n.format;if($e(e,a))e.bindRenderbuffer(e.RENDERBUFFER,a),e.renderbufferStorage(e.RENDERBUFFER,s,r,i);else{if(!et(e,a))throw new Error("unknown attachment type -- fun resizeFramebufferInfo()");Ce(e,a,n,r,i)}})}function ot(e){e>=16777215&&(e=0,console.warn("Color picker models length bigger than max length 16777214"));var t=new Float32Array(3);return t[0]=(255&e)/255,t[1]=((65280&e)>>8)/255,t[2]=((16711680&e)>>16)/255,t}function at(e){return e[0]|e[1]<<8|e[2]<<16}function st(e,t,n){this.gl=e,this.canvas=e.canvas,this.controler=n,this.shader=new he(e,t),this.models=[],this.blankColor=this.id2Color(this.blankId),this.framebufferInfo=tt(e),this.flag=0,this.isActive=!1,this.updateCanvasParam(),this.eventListeners={type:"mouseleftclick",listener:this.onmouseclick.bind(this)},this.controler.addListeners(this.eventListeners)}function ut(e){q.call(this,e,ut.vs,ut.fs),this.setFlipy(!0),this.deactivate()}function ht(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.gl=e,this.canvas=e.canvas,this.models=t,this.bufferIdx=i,this.framebufferInfo=n,this.controler=r,this.eventListeners={type:"mouseleftclick",listener:this.onmouseclick.bind(this)},this.controler.addListeners(this.eventListeners),this.isActive=!1,this.updateCanvasParam()}function lt(e){e.forEach(function(e){return Object.assign(e,{addFunction:function(e){"function"==typeof e?this.push(e):console.warn("listenerOptions.listener( "+e+" ) is not a function.")}.bind(e),removeFunction:function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)}.bind(e)})})}function ct(e,t){var n=e;return function(e){!1!==this.enable&&n.forEach(function(t){t(e)})}.bind(t)}function ft(e){this.element=e,this.enable=!0,this.mouseDownListeners=[],this.mouseMoveListeners=[],this.mouseUpListeners=[],this.mouseWheelListeners=[],this.keydownListeners=[],this.keyupListeners=[],this.touchStartListeners=[],this.touchMoveListeners=[],this.touchEndListeners=[],this.mouseClickListeners=[],this.mouseLeftClickListeners=[],this.mouseMiddleClickListeners=[],this.mouseRightClickListeners=[],lt([this.mouseDownListeners,this.mouseMoveListeners,this.mouseUpListeners,this.mouseWheelListeners,this.keydownListeners,this.keyupListeners,this.touchStartListeners,this.touchMoveListeners,this.touchEndListeners,this.mouseClickListeners,this.mouseLeftClickListeners,this.mouseMiddleClickListeners,this.mouseRightClickListeners]),this.oncontext=function(e){!1!==this.enable&&e.preventDefault()}.bind(this),this.element.addEventListener("contextmenu",this.oncontext,!1),this.onmousedown=ct(this.mouseDownListeners,this),this.element.addEventListener("mousedown",this.onmousedown,!1),this.onmousemove=ct(this.mouseMoveListeners,this),document.addEventListener("mousemove",this.onmousemove,!1),this.onmouseup=ct(this.mouseUpListeners,this),document.addEventListener("mouseup",this.onmouseup,!1),this.onwheel=ct(this.mouseWheelListeners,this),this.element.addEventListener("wheel",this.onwheel,!1),this.onkeydown=ct(this.keydownListeners,this),window.addEventListener("keydown",this.onkeydown,!1),this.onkeyup=ct(this.keyupListeners,this),window.addEventListener("keyup",this.onkeyup,!1),this.ontouchstart=ct(this.touchStartListeners,this),this.element.addEventListener("touchstart",this.ontouchstart,!1),this.ontouchmove=ct(this.touchMoveListeners,this),this.element.addEventListener("touchmove",this.ontouchmove,!1),this.ontouchend=ct(this.touchEndListeners,this),this.element.addEventListener("touchend",this.ontouchend,!1),this.onmouseclick=ct(this.mouseClickListeners,this),this.onmouseleftclick=ct(this.mouseLeftClickListeners,this),this.onmousemiddleclick=ct(this.mouseMiddleClickListeners,this),this.onmouserightclick=ct(this.mouseRightClickListeners,this),this._flag=0;var t=this;this.addListeners([{type:"mousedown",listener:function(){t._flag=0}},{type:"mousemove",listener:function(){t._flag=1}},{type:"mouseup",listener:function(e){if(!1!==t.enable&&0===t._flag)switch(t.onmouseclick(e),e.button){case zn.LEFT:t.onmouseleftclick(e);break;case zn.MIDDLE:t.onmousemiddleclick(e);break;case zn.RIGHT:t.onmouserightclick(e)}}}])}function dt(e,t){this.models=[],this.shaders=[],this.shadersMap=[],this.helpers=[],this.helpersMap=[],this.root=new Ge("root_node"),this.renderer=e,this.gl=this.renderer.context,this.controler=t||new ft(this.gl.canvas),this.quad2UnitModel=sn.createModel("screenQuad",2),this.ScreenQuadShader=new ut(this.gl).setDefines("FXAA").setUniformObj({u_resolution:[this.gl.canvas.width,this.gl.canvas.height]});var n=[{format:this.gl.RGBA,type:this.gl.UNSIGNED_BYTE,minMag:this.gl.LINEAR,wrap:this.gl.CLAMP_TO_EDGE},{format:this.gl.RGBA,type:this.gl.UNSIGNED_BYTE,minMag:this.gl.LINEAR,wrap:this.gl.CLAMP_TO_EDGE},{format:this.gl.DEPTH_STENCIL}];this.attachments=n,this.framebufferInfo=tt(this.gl,this.attachments),this.bufferPicker=new ht(this.gl,this.models,this.framebufferInfo,this.controler,1),this.setPick(!1)}function mt(e,t,n,r){for(var i=0;i<t.length;i++)e[i]=t[i]+r*(n[i]-t[i]);return e}function pt(e,t,r,i){n.slerp(e,t,r,i)}function vt(e){this.raw=e,this._parseRawData(e),this._playList=[]}var _t="a_position",gt=0,bt="a_uv",yt=1,Et="a_normal",Mt=2,At="a_barycentric",Tt=4,xt="u_worldMat",Rt="u_viewMat",Ot="u_projMat",Pt="u_mvpMat",wt="u_vpMat",It="u_normMat",Ft="u_",St="u_camPos",Nt=4,Ct=Math.PI/180,Lt={RADIAN_PER_DEGREE:Ct,degree2Radian:function(e){return e*Ct},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},map:function(e,t,n,r,i){return r+(i-r)*(e-t)/(n-t)},arrayEquals:function(e,t){if(e.length!==t.length)return!1;for(var n=e.length,r=0;r<n;r++)if(Math.abs(e[r]-t[r])>1e-6*Math.max(1,Math.abs(e[r]),Math.abs(t[r])))return!1;return!0},arrayClone:function(e){for(var t=e.constructor,n=e.length,r=new t(n),i=0;i<n;i++)r[i]=e[i];return r}};Object.defineProperties(t.prototype,{x:{get:function(){return this.raw[0]},set:function(e){this.raw[0]=e}},y:{get:function(){return this.raw[1]},set:function(e){this.raw[1]=e}},z:{get:function(){return this.raw[2]},set:function(e){this.raw[2]=e}}}),Object.assign(t.prototype,{length:function(e){if(void 0===e)return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);var t=e.x-this.x,n=e.y-this.y,r=e.z-this.z;return Math.sqrt(t*t+n*n+r*r)},squareLength:function(e){if(void 0===e)return this.x*this.x+this.y*this.y+this.z*this.z;var t=e.x-this.x,n=e.y-this.y,r=e.z-this.z;return t*t+n*n+r*r},normalize:function(){var e=this.length();return this.x/=e,this.y/=e,this.z/=e,this},set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setFromSpherical:function(e){return t.fromSpherical(this.raw,e),this},setFromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},setFromRotationMatrix:function(e){var t=e.raw||e,n=t[0],r=t[4],i=t[8],o=t[5],a=t[9],s=t[6],u=t[10];return this.y=Math.asin(Lt.clamp(i,-1,1)),Math.abs(i)<.99999?(this.x=Math.atan2(-a,u),this.z=Math.atan2(-r,n)):(this.x=Math.atan2(s,o),this.z=0),this},multiScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},getArray:function(){return this.raw},getFloatArray:function(){return new Float32Array(this.raw)},clone:function(){return new t(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-e.y,this.z=e.z-e.y,this},dot:function(e){return this.dotVectors(this,e),this},cross:function(e,n){var r=n||new t;return t.crossVectors(r.raw,this.raw,e.raw),r},applyQuaternion:function(e){return t.transformQuat(this.raw,this.raw,e.raw),this},dotVectors:function(e,t){return e.x*t.z+e.y*t.y+e.z*t.z}}),Object.assign(t,{crossVectors:function(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e},fromSpherical:function(e,t){var n=Math.sin(t.phi)*t.radius;return e[0]=n*Math.sin(t.theta),e[1]=Math.cos(t.phi)*t.radius,e[2]=n*Math.cos(t.theta),e},transformQuat:function(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2],h=n[3],l=h*r+s*o-u*i,c=h*i+u*r-a*o,f=h*o+a*i-s*r,d=-a*r-s*i-u*o;return e[0]=l*h+d*-a+c*-u-f*-s,e[1]=c*h+d*-s+f*-a-l*-u,e[2]=f*h+d*-u+l*-s-c*-a,e}}),Object.defineProperties(n.prototype,{x:{get:function(){return this.raw[0]},set:function(e){this.raw[0]=e}},y:{get:function(){return this.raw[1]},set:function(e){this.raw[1]=e}},z:{get:function(){return this.raw[2]},set:function(e){this.raw[2]=e}},w:{get:function(){return this.raw[3]},set:function(e){this.raw[3]=e}}}),Object.assign(n.prototype,{set:function(e,t,n,r){return 1===arguments.length?this.raw=e.slice(0,4):(this.x=e,this.y=t,this.z=n,this.w=r),this},clone:function(){return new n(this.raw)},getArray:function(){return this.raw},setFromEuler:function(e,t,r){return n.fromEuler(this.raw,e,t,r),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){return n.normalize(this.raw,this.raw),this},setFromUnitVectors:function(){var e=new t;return function(n,r){e=new t;var i=n.dot(r)+1;return i<1e-6?(i=0,Math.abs(n.x)>Map.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):t.cross(e,n,r),this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this.normalize(),this}}(),invert:function(){return n.invert(this.raw,this.raw),this}}),Object.assign(n,{normalize:function(e,t){var n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]);return 0===n?(e[0]=0,e[1]=0,e[2]=0,e[3]=1):(n=1/n,e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n),e},fromEuler:function(e,t,n,r){var i=Math.cos,o=Math.sin,a=i(t/2),s=i(n/2),u=i(r/2),h=o(t/2),l=o(n/2),c=o(r/2);e[0]=h*s*u+a*l*c,e[1]=a*l*u-h*s*c,e[2]=a*s*c+h*l*u,e[3]=a*s*u-h*l*c},invert:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=o*s,e},lerp:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e[3]=s+r*(n[3]-s),e},slerp:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=n[0],h=n[1],l=n[2],c=n[3],f=void 0,d=void 0,m=void 0,p=void 0,v=void 0;return(d=i*u+o*h+a*l+s*c)<0&&(d=-d,u=-u,h=-h,l=-l,c=-c),1-d>1e-6?(f=Math.acos(d),m=Math.sin(f),p=Math.sin((1-r)*f)/m,v=Math.sin(r*f)/m):(p=1-r,v=r),e[0]=p*i+v*u,e[1]=p*o+v*h,e[2]=p*a+v*l,e[3]=p*s+v*c,e},fromMatrix4:function(e,t){var n=t[0],r=t[4],i=t[8],o=t[1],a=t[5],s=t[9],u=t[2],h=t[6],l=t[10],c=n+a+l,f=void 0;return c>0?(f=.5/Math.sqrt(c+1),e[3]=.25/f,e[0]=(h-s)*f,e[1]=(i-u)*f,e[2]=(o-r)*f):n>a&&n>l?(f=2*Math.sqrt(1+n-a-l),e[3]=(h-s)/f,e[0]=.25*f,e[1]=(r+o)/f,e[2]=(i+u)/f):a>l?(f=2*Math.sqrt(1+a-n-l),e[3]=(i-u)/f,e[0]=(r+o)/f,e[1]=.25*f,e[2]=(s+h)/f):(f=2*Math.sqrt(1+l-n-a),e[3]=(o-r)/f,e[0]=(i+u)/f,e[1]=(s+h)/f,e[2]=.25*f),e}}),Object.assign(r.prototype,{translate:function(e,t,n){return void 0!==e.x?(r.translate(this.raw,e.x,e.y,e.z),this):(r.translate(this.raw,e,t,n),this)},rotateX:function(e){return r.rotateX(this.raw,e),this},rotateY:function(e){return r.rotateY(this.raw,e),this},rotateZ:function(e){return r.rotateZ(this.raw,e),this},applyQuaternion:function(){var e=new Array(16);return function(t){return r.fromQuat(e,void 0===t.x?t:t.raw),r.mult(this.raw,this.raw,e),this}}(),scale:function(e,t,n){return void 0!==e.x?(r.scale(this.raw,e.x,e.y,e.z),this):(r.scale(this.raw,e,t,n),this)},invert:function(){return r.invert(this.raw,this.raw),this},resetRotation:function(){for(var e=0;e<this.raw.length;e++)e>=12&&e<=14||(this.raw[e]=e%5==0?1:0);return this},reset:function(){for(var e=0;e<this.raw.length;e++)this.raw[e]=e%5==0?1:0;return this},fromTRS:function(e,t,n){return r.fromRotationTranslationScale(this.raw,t,e,n),this}}),Object.assign(r,{identity:function(e){if(e)return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e;var t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},perspective:function(e,t,n,r,i){var o=1/Math.tan(t/2),a=1/(r-i);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*a,e[15]=0,e},ortho:function(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),h=1/(o-a);return e[0]=-2*s,e[1]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*h,e[15]=1,e},transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},normalMat3:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],h=t[7],l=t[8],c=t[9],f=t[10],d=t[11],m=t[12],p=t[13],v=t[14],_=t[15],g=n*s-r*a,b=n*u-i*a,y=n*h-o*a,E=r*u-i*s,M=r*h-o*s,A=i*h-o*u,T=l*p-c*m,x=l*v-f*m,R=l*_-d*m,O=c*v-f*p,P=c*_-d*p,w=f*_-d*v,I=g*w-b*P+y*O+(E*R-M*x)+A*T;return I?(I=1/I,e[0]=(s*w-u*P+h*O)*I,e[1]=(u*R-a*w-h*x)*I,e[2]=(a*P-s*R+h*T)*I,e[3]=(i*P-r*w-o*O)*I,e[4]=(n*w-i*R+o*x)*I,e[5]=(r*R-n*P-o*T)*I,e[6]=(p*A-v*M+_*E)*I,e[7]=(v*y-m*A-_*b)*I,e[8]=(m*M-p*y+_*g)*I,e):null},transformVec4:function(e,t,n){return e[0]=t[0]*n[0]+t[4]*n[1]+t[8]*n[2]+t[12]*n[3],e[1]=t[1]*n[0]+t[5]*n[1]+t[9]*n[2]+t[13]*n[3],e[2]=t[2]*n[0]+t[6]*n[1]+t[10]*n[2]+t[14]*n[3],e[3]=t[3]*n[0]+t[7]*n[1]+t[11]*n[2]+t[15]*n[3],e},mult:function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],h=t[6],l=t[7],c=t[8],f=t[9],d=t[10],m=t[11],p=t[12],v=t[13],_=t[14],g=t[15],b=n[0],y=n[1],E=n[2],M=n[3];return e[0]=b*r+y*s+E*c+M*p,e[1]=b*i+y*u+E*f+M*v,e[2]=b*o+y*h+E*d+M*_,e[3]=b*a+y*l+E*m+M*g,b=n[4],y=n[5],E=n[6],M=n[7],e[4]=b*r+y*s+E*c+M*p,e[5]=b*i+y*u+E*f+M*v,e[6]=b*o+y*h+E*d+M*_,e[7]=b*a+y*l+E*m+M*g,b=n[8],y=n[9],E=n[10],M=n[11],e[8]=b*r+y*s+E*c+M*p,e[9]=b*i+y*u+E*f+M*v,e[10]=b*o+y*h+E*d+M*_,e[11]=b*a+y*l+E*m+M*g,b=n[12],y=n[13],E=n[14],M=n[15],e[12]=b*r+y*s+E*c+M*p,e[13]=b*i+y*u+E*f+M*v,e[14]=b*o+y*h+E*d+M*_,e[15]=b*a+y*l+E*m+M*g,e},scale:function(e,t,n,r){return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=n,e[5]*=n,e[6]*=n,e[7]*=n,e[8]*=r,e[9]*=r,e[10]*=r,e[11]*=r,e},rotateY:function(e,t){var n=Math.sin(t),r=Math.cos(t),i=e[0],o=e[1],a=e[2],s=e[3],u=e[8],h=e[9],l=e[10],c=e[11];return e[0]=i*r-u*n,e[1]=o*r-h*n,e[2]=a*r-l*n,e[3]=s*r-c*n,e[8]=i*n+u*r,e[9]=o*n+h*r,e[10]=a*n+l*r,e[11]=s*n+c*r,e},rotateX:function(e,t){var n=Math.sin(t),r=Math.cos(t),i=e[4],o=e[5],a=e[6],s=e[7],u=e[8],h=e[9],l=e[10],c=e[11];return e[4]=i*r+u*n,e[5]=o*r+h*n,e[6]=a*r+l*n,e[7]=s*r+c*n,e[8]=u*r-i*n,e[9]=h*r-o*n,e[10]=l*r-a*n,e[11]=c*r-s*n,e},rotateZ:function(e,t){var n=Math.sin(t),r=Math.cos(t),i=e[0],o=e[1],a=e[2],s=e[3],u=e[4],h=e[5],l=e[6],c=e[7];return e[0]=i*r+u*n,e[1]=o*r+h*n,e[2]=a*r+l*n,e[3]=s*r+c*n,e[4]=u*r-i*n,e[5]=h*r-o*n,e[6]=l*r-a*n,e[7]=c*r-s*n,e},rotate:function(e,t,n){var r=n[0],i=n[1],o=n[2],a=Math.sqrt(r*r+i*i+o*o);if(Math.abs(a)<1e-6)return null;r*=a=1/a,i*=a,o*=a;var s=Math.sin(t),u=Math.cos(t),h=1-u,l=e[0],c=e[1],f=e[2],d=e[3],m=e[4],p=e[5],v=e[6],_=e[7],g=e[8],b=e[9],y=e[10],E=e[11],M=r*r*h+u,A=i*r*h+o*s,T=o*r*h-i*s,x=r*i*h-o*s,R=i*i*h+u,O=o*i*h+r*s,P=r*o*h+i*s,w=i*o*h-r*s,I=o*o*h+u;return e[0]=l*M+m*A+g*T,e[1]=c*M+p*A+b*T,e[2]=f*M+v*A+y*T,e[3]=d*M+_*A+E*T,e[4]=l*x+m*R+g*O,e[5]=c*x+p*R+b*O,e[6]=f*x+v*R+y*O,e[7]=d*x+_*R+E*O,e[8]=l*P+m*w+g*I,e[9]=c*P+p*w+b*I,e[10]=f*P+v*w+y*I,e[11]=d*P+_*w+E*I,e},invert:function(e,t){void 0===t&&(t=e);var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],h=t[7],l=t[8],c=t[9],f=t[10],d=t[11],m=t[12],p=t[13],v=t[14],_=t[15],g=n*s-r*a,b=n*u-i*a,y=n*h-o*a,E=r*u-i*s,M=r*h-o*s,A=i*h-o*u,T=l*p-c*m,x=l*v-f*m,R=l*_-d*m,O=c*v-f*p,P=c*_-d*p,w=f*_-d*v,I=g*w-b*P+y*O+E*R-M*x+A*T;return!!I&&(I=1/I,e[0]=(s*w-u*P+h*O)*I,e[1]=(i*P-r*w-o*O)*I,e[2]=(p*A-v*M+_*E)*I,e[3]=(f*M-c*A-d*E)*I,e[4]=(u*R-a*w-h*x)*I,e[5]=(n*w-i*R+o*x)*I,e[6]=(v*y-m*A-_*b)*I,e[7]=(l*A-f*y+d*b)*I,e[8]=(a*P-s*R+h*T)*I,e[9]=(r*R-n*P-o*T)*I,e[10]=(m*M-p*y+_*g)*I,e[11]=(c*y-l*M-d*g)*I,e[12]=(s*x-a*O-u*T)*I,e[13]=(n*O-r*x+i*T)*I,e[14]=(p*b-m*E-v*g)*I,e[15]=(l*E-c*b+f*g)*I,!0)},translate:function(e,t,n,r){return e[12]=e[0]*t+e[4]*n+e[8]*r+e[12],e[13]=e[1]*t+e[5]*n+e[9]*r+e[13],e[14]=e[2]*t+e[6]*n+e[10]*r+e[14],e[15]=e[3]*t+e[7]*n+e[11]*r+e[15],e},lookAt:function(e,t,n,r){var i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,h=void 0,l=void 0,c=void 0,f=void 0,d=void 0,m=t[0],p=t[1],v=t[2],_=r[0],g=r[1],b=r[2],y=n[0],E=n[1],M=n[2];return Math.abs(m-y)<1e-6&&Math.abs(p-E)<1e-6&&Math.abs(v-M)<1e-6?this.identity(e):(l=m-y,c=p-E,f=v-M,d=1/Math.sqrt(l*l+c*c+f*f),l*=d,c*=d,f*=d,i=g*f-b*c,o=b*l-_*f,a=_*c-g*l,(d=Math.sqrt(i*i+o*o+a*a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),s=c*a-f*o,u=f*i-l*a,h=l*o-c*i,(d=Math.sqrt(s*s+u*u+h*h))?(s*=d=1/d,u*=d,h*=d):(s=0,u=0,h=0),e[0]=i,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=c,e[7]=0,e[8]=a,e[9]=h,e[10]=f,e[11]=0,e[12]=-(i*m+o*p+a*v),e[13]=-(s*m+u*p+h*v),e[14]=-(l*m+c*p+f*v),e[15]=1,e)},equals:function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],l=e[8],c=e[9],f=e[10],d=e[11],m=e[12],p=e[13],v=e[14],_=e[15],g=t[0],b=t[1],y=t[2],E=t[3],M=t[4],A=t[5],T=t[6],x=t[7],R=t[8],O=t[9],P=t[10],w=t[11],I=t[12],F=t[13],S=t[14],N=t[15];return Math.abs(n-g)<=1e-6*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-b)<=1e-6*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-y)<=1e-6*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-E)<=1e-6*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-M)<=1e-6*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(s-A)<=1e-6*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-T)<=1e-6*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(h-x)<=1e-6*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(l-R)<=1e-6*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(c-O)<=1e-6*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(f-P)<=1e-6*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(d-w)<=1e-6*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(m-I)<=1e-6*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(p-F)<=1e-6*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(v-S)<=1e-6*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(_-N)<=1e-6*Math.max(1,Math.abs(_),Math.abs(N))},clone:function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromQuat:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,h=n*a,l=r*a,c=r*s,f=i*a,d=i*s,m=i*u,p=o*a,v=o*s,_=o*u;return e[0]=1-c-m,e[1]=l+_,e[2]=f-v,e[3]=0,e[4]=l-_,e[5]=1-h-m,e[6]=d+p,e[7]=0,e[8]=f+v,e[9]=d-p,e[10]=1-h-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,h=o+o,l=r*s,c=r*u,f=r*h,d=i*u,m=i*h,p=o*h,v=a*s,_=a*u,g=a*h;return e[0]=1-(d+p),e[1]=c+g,e[2]=f-_,e[3]=0,e[4]=c-g,e[5]=1-(l+p),e[6]=m+v,e[7]=0,e[8]=f+_,e[9]=m-v,e[10]=1-(l+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromRotationTranslationScale:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,h=o+o,l=a+a,c=i*u,f=i*h,d=i*l,m=o*h,p=o*l,v=a*l,_=s*u,g=s*h,b=s*l,y=r[0],E=r[1],M=r[2];return e[0]=(1-(m+v))*y,e[1]=(f+b)*y,e[2]=(d-g)*y,e[3]=0,e[4]=(f-b)*E,e[5]=(1-(c+v))*E,e[6]=(p+_)*E,e[7]=0,e[8]=(d+g)*M,e[9]=(p-_)*M,e[10]=(1-(c+m))*M,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],h=t[9],l=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(o*o+a*a+s*s),e[2]=Math.sqrt(u*u+h*h+l*l),e},getRotation:function(e,t){var n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e},determinant:function(e){var t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],u=e[13],h=e[2],l=e[6],c=e[10],f=e[14];return e[3]*(+i*s*l-r*u*l-i*a*c+n*u*c+r*a*f-n*s*f)+e[7]*(+t*s*f-t*u*c+i*o*c-r*o*f+r*u*h-i*s*h)+e[11]*(+t*u*l-t*a*f-i*o*l+n*o*f+i*a*h-n*u*h)+e[15]*(-r*a*h-t*s*l+t*a*c+r*o*l-n*o*c+n*s*h)},decompose:function(e,t,i,o){var a=r.clone(e),s=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),u=Math.sqrt(a[4]*a[4]+a[5]*a[5]+a[6]*a[6]),h=Math.sqrt(a[8]*a[8]+a[9]*a[9]+a[10]*a[10]);r.determinant(a)<0&&(s=-s),t[0]=a[12],t[1]=a[13],t[2]=a[14];var l=1/s,c=1/u,f=1/h;a[0]*=l,a[1]*=l,a[2]*=l,a[4]*=c,a[5]*=c,a[6]*=c,a[8]*=f,a[9]*=f,a[10]*=f,n.fromMatrix4(i,a),o[0]=s,o[1]=u,o[2]=h}});var Ut=window.SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof window.SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer},kt=5120,Bt=5121,Dt=5122,zt=5123,jt=5124,Ht=5125,Gt=5126,Vt={},Wt=Vt;Wt[kt]=Int8Array,Wt[Bt]=Uint8Array,Wt[Dt]=Int16Array,Wt[zt]=Uint16Array,Wt[jt]=Int32Array,Wt[Ht]=Uint32Array,Wt[Gt]=Float32Array,Wt[32819]=Uint16Array,Wt[32820]=Uint16Array,Wt[33635]=Uint16Array,Wt[5131]=Uint16Array,Wt[33640]=Uint32Array,Wt[35899]=Uint32Array,Wt[35902]=Uint32Array,Wt[36269]=Uint32Array,Wt[34042]=Uint32Array;var Xt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Yt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),qt=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Zt=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};Object.defineProperties(s.prototype,{position:{get:function(){return this._position.getArray().slice()},set:function(e){this.setPosition(e)}},scale:{get:function(){return this._scale.getArray().slice()},set:function(e){this.setScale(e)}},rotation:{get:function(){return this._rotation.getArray().slice()},set:function(e){this.setRotation(e)}},quaternion:{get:function(){return this._quaternion.getArray().slice()},set:function(e){this.setQuaternion(e)}}}),Object.assign(s.prototype,{updateMatrix:function(){return this._needUpdateMatrix&&(this.matrix.fromTRS(this._position.raw,this._quaternion.raw,this._scale.raw),this._needUpdateMatrix=!1),this},updateNormalMatrix:function(){return r.normalMat3(this.normMat,this.worldMatrix.raw),this},updateDirection:function(){return r.transformVec4(this.forward,this.worldMatrix.raw,[0,0,1,0]),r.transformVec4(this.up,this.worldMatrix.raw,[0,1,0,0]),r.transformVec4(this.right,this.worldMatrix.raw,[1,0,0,0]),this},copyToWorldMatrix:function(){return r.copy(this.worldMatrix.raw,this.matrix.raw),this},getMatrix:function(){return this.matrix.raw},getWorldMatrix:function(){return this.worldMatrix.raw},getNormalMatrix:function(){return this.normMat},reset:function(){this._position.set(0,0,0),this._scale.set(1,1,1),this._rotation.set(0,0,0),this._quaternion.set(0,0,0,1)},updateEuler:function(){var e=new r;return function(){e.reset().applyQuaternion(this._quaternion),this._rotation.setFromRotationMatrix(e.raw)}}(),updateQuaternion:function(){var e;(e=this._quaternion).setFromEuler.apply(e,Zt(this.rotation))},setScale:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];if(1===n.length){if(n[0]instanceof t)return this.setScale.apply(this,Zt(n[0].getArray()));if((Array.isArray(n[0])||Ut(n[0]))&&3===n[0].length)return this.setScale.apply(this,Zt(n[0]))}else if(3===n.length){var i;(i=this._scale).set.apply(i,n),this._needUpdateMatrix=!0,this.needUpdateWorldMatrix=!0}return this},setPosition:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];if(1===n.length){if(n[0]instanceof t)return this.setPosition.apply(this,Zt(n[0].getArray()));if((Array.isArray(n[0])||Ut(n[0]))&&3===n[0].length)return this.setPosition.apply(this,Zt(n[0]))}else if(3===n.length){var i;(i=this._position).set.apply(i,n),this._needUpdateMatrix=!0,this.needUpdateWorldMatrix=!0}return this},setRotation:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];if(1===n.length){if(n[0]instanceof t)return this.setRotation.apply(this,Zt(n[0].getArray()));if((Array.isArray(n[0])||Ut(n[0]))&&3===n[0].length)return this.setRotation.apply(this,Zt(n[0]))}else if(3===n.length){var i;(i=this._rotation).set.apply(i,n),this.updateQuaternion(),this._needUpdateMatrix=!0,this.needUpdateWorldMatrix=!0}return this},setQuaternion:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(1===t.length){if(t[0]instanceof n)return this.setQuaternion.apply(this,Zt(t[0].getArray()));if((Array.isArray(t[0])||Ut(t[0]))&&4===t[0].length)return this.setQuaternion.apply(this,Zt(t[0]))}else if(4===t.length){var i;(i=this._quaternion).set.apply(i,t),this.updateEuler(),this._needUpdateMatrix=!0,this.needUpdateWorldMatrix=!0}return this},getVec3Position:function(){return this._position},clone:function(){var e=new s;return e.position=this.position,e.quaternion=this.quaternion,e.scale=this.scale,e}});var Kt=function(){var e={},t={};return function(n,r){return function(n){var r=n.constructor.name;if(!e[r]){for(var i in n)if("number"==typeof n[i]){var o=t[n[i]];t[n[i]]=o?o+" | "+i:i}e[r]=!0}}(n),t[r]||"0x"+r.toString(16)}}(),Qt={};Qt[5126]={Type:Float32Array,size:4,setter:function(e,t){return function(n){e.uniform1f(t,n)}},arraySetter:function(e,t){return function(n){e.uniform1fv(t,n)}}},Qt[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(n){e.uniform2fv(t,n)}}},Qt[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(n){e.uniform3fv(t,n)}}},Qt[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(n){e.uniform4fv(t,n)}}},Qt[5124]={Type:Int32Array,size:4,setter:d,arraySetter:m},Qt[35667]={Type:Int32Array,size:8,setter:p},Qt[35668]={Type:Int32Array,size:12,setter:v},Qt[35669]={Type:Int32Array,size:16,setter:_},Qt[5125]={Type:Uint32Array,size:4,setter:function(e,t){return function(n){e.uniform1ui(t,n)}},arraySetter:function(e,t){return function(n){e.uniform1uiv(t,n)}}},Qt[36294]={Type:Uint32Array,size:8,setter:function(e,t){return function(n){e.uniform2uiv(t,n)}}},Qt[36295]={Type:Uint32Array,size:12,setter:function(e,t){return function(n){e.uniform3uiv(t,n)}}},Qt[36296]={Type:Uint32Array,size:16,setter:function(e,t){return function(n){e.uniform4uiv(t,n)}}},Qt[35670]={Type:Uint32Array,size:4,setter:d,arraySetter:m},Qt[35671]={Type:Uint32Array,size:8,setter:p},Qt[35672]={Type:Uint32Array,size:12,setter:v},Qt[35673]={Type:Uint32Array,size:16,setter:_},Qt[35674]={Type:Float32Array,size:16,setter:function(e,t){return function(n){e.uniformMatrix2fv(t,!1,n)}}},Qt[35675]={Type:Float32Array,size:36,setter:function(e,t){return function(n){e.uniformMatrix3fv(t,!1,n)}}},Qt[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4fv(t,!1,n)}}},Qt[35685]={Type:Float32Array,size:24,setter:function(e,t){return function(n){e.uniformMatrix2x3fv(t,!1,n)}}},Qt[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix2x4fv(t,!1,n)}}},Qt[35687]={Type:Float32Array,size:24,setter:function(e,t){return function(n){e.uniformMatrix3x2fv(t,!1,n)}}},Qt[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix3x4fv(t,!1,n)}}},Qt[35689]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix4x2fv(t,!1,n)}}},Qt[35690]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix4x3fv(t,!1,n)}}},Qt[35678]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:3553},Qt[35680]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:34067},Qt[35679]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:32879},Qt[35682]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:3553},Qt[36289]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:35866},Qt[36292]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:35866},Qt[36293]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:34067},Qt[36298]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:3553},Qt[36299]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:32879},Qt[36300]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:34067},Qt[36303]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:35866},Qt[36306]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:3553},Qt[36307]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:32879},Qt[36308]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:34067},Qt[36311]={Type:null,size:0,setter:g,arraySetter:b,bindPoint:35866};var Jt={};Jt[5126]={size:4,setter:y},Jt[35664]={size:8,setter:y},Jt[35665]={size:12,setter:y},Jt[35666]={size:16,setter:y},Jt[5124]={size:4,setter:E},Jt[35667]={size:8,setter:E},Jt[35668]={size:12,setter:E},Jt[35669]={size:16,setter:E},Jt[5125]={size:4,setter:E},Jt[36294]={size:8,setter:E},Jt[36295]={size:12,setter:E},Jt[36296]={size:16,setter:E},Jt[35670]={size:4,setter:E},Jt[35671]={size:8,setter:E},Jt[35672]={size:12,setter:E},Jt[35673]={size:16,setter:E},Jt[35674]={size:4,setter:M,count:2},Jt[35675]={size:9,setter:M,count:3},Jt[35676]={size:16,setter:M,count:4};var $t=/\[\d+\]\.$/,en=/color|colour/i,tn=/uv|coord/i,nn=["position","positions","a_position"];Object.assign(Y,{identity:function(){var e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e},equals:function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],l=e[8],c=t[0],f=t[1],d=t[2],m=t[3],p=t[4],v=t[5],_=t[6],g=t[7],b=t[8];return Math.abs(n-c)<=1e-6*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-f)<=1e-6*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-d)<=1e-6*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-m)<=1e-6*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-p)<=1e-6*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-v)<=1e-6*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-_)<=1e-6*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(h-g)<=1e-6*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(l-b)<=1e-6*Math.max(1,Math.abs(l),Math.abs(b))},clone:function(e){var t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}}),Object.assign(q.prototype,{activate:function(){return q.currentProgram!==this.program&&(this.gl.useProgram(this.program),q.currentProgram=this.program),this},deactivate:function(){return this.gl.useProgram(null),q.currentProgram=null,this},setUniformObjProp:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};void 0!==this.currentUniformObj[e]&&n(this.currentUniformObj[e],t)||(this.uniformObj[e]=t,this.currentUniformObj[e]=t,n===r.equals?this.currentUniformObj[e]=r.clone(t):n===Y.equals?this.currentUniformObj[e]=Y.clone(t):Array.isArray(t)?this.currentUniformObj[e]=t.slice():n===Lt.arrayEquals&&(this.currentUniformObj[e]=Lt.arrayClone(t)))},setUniformObj:function(e){var t=this;return Object.keys(e).forEach(function(n){16===e[n].length&&"number"==typeof e[n][0]?t.setUniformObjProp(n,e[n],r.equals):9===e[n].length&&"number"==typeof e[n][0]?t.setUniformObjProp(n,e[n],Y.equals):e[n].length&&"number"==typeof e[n][0]?t.setUniformObjProp(n,e[n],Lt.arrayEquals):t.setUniformObjProp(n,e[n])}),this},setUniforms:function(e){return O(this.uniformSetters,e),this},setBlockUniforms:function(e){return C(this.gl,this.uniformBlockSpec,this.uniformBlockInfos,e),this},setProjMatrix:function(e){return this.setUniformObjProp(Ot,e,r.equals),this},setViewMatrix:function(e){return this.setUniformObjProp(Rt,e,r.equals),this},setWorldMatrix:function(e){return this.setUniformObjProp(xt,e,r.equals),this},setTexture:function(e){return this.setUniformObj({texture:e}),this},setCamera:function(e){return this.camera=e,this},updateCamera:function(){return this.camera?(this._needCamPos&&this.setUniformObjProp(St,this.camera.position,Lt.arrayEquals),this.setProjMatrix(this.camera.projMat),this.setViewMatrix(this.camera.viewMat),this):this},dispose:function(){this.gl.getParameter(this.gl.CURRENT_PROGRAM)===this.program&&this.gl.useProgram(null),this.gl.deleteProgram(this.program)},preRender:function(){var e=this;return this._programUpdated?(this.uniformObj=this.currentUniformObj,this._programUpdated=!1):q.currentProgram!==this.program&&Object.keys(this.currentUniformObj).forEach(function(t){e.currentUniformObj[t]instanceof WebGLTexture&&(e.uniformObj[t]=e.currentUniformObj[t])}),this.activate(),this.updateCamera(),(this._needMVPMat||this._needVPMat)&&(this.currentUniformObj.temp=r.mult(r.identity(),this.currentUniformObj[Ot],this.currentUniformObj[Rt]),this._needVPMat&&this.setUniformObjProp(wt,this.currentUniformObj.temp,r.equals),this._needMVPMat&&(this.currentUniformObj.temp=r.mult(this.currentUniformObj.temp,this.currentUniformObj.temp,this.currentUniformObj[xt]),this.setUniformObjProp(Pt,this.currentUniformObj.temp,r.equals))),this.setUniforms(this.uniformObj),this.setBlockUniforms(this.uniformObj),this.uniformObj={},this},renderModel:function(e){q.cullFace!==(this.cullFace&&e.cullFace)&&(this.gl[this.cullFace&&e.cullFace?"enable":"disable"](this.gl.CULL_FACE),q.cullFace=this.cullFace&&e.cullFace),q.blend!==(this.blend||e.blend)&&(this.gl[this.blend||e.blend?"enable":"disable"](this.gl.BLEND),q.blend=this.blend||e.blend),q.depth!==(this.depth&&e.depth)&&(this.gl.depthMask(this.depth&&e.depth),q.depth=this.depth&&e.depth),q.sampleBlend!==(this.sampleBlend||e.sampleBlend)&&(this.gl[this.sampleBlend||e.sampleBlend?"enable":"disable"](this.gl.SAMPLE_ALPHA_TO_COVERAGE),q.sampleBlend=this.sampleBlend||e.sampleBlend),e.preRender(this.gl,this._customAttrib?this:void 0),this.setUniformObj(e.uniformObj),this.setWorldMatrix(e.transform.getWorldMatrix()),this._needNormMat&&this.setUniformObjProp(It,e.normMat,Y.equals),this.preRender(),this.gl.bindVertexArray(e.mesh.vao);var t=e.mesh.bufferInfo,n=e.instanceCount;return t.indices||t.elementType?"number"==typeof n?this.gl.drawElementsInstanced(e.drawMode,t.numElements,void 0===t.elementType?this.gl.UNSIGNED_SHORT:t.elementType,e.offset,n):this.gl.drawElements(e.drawMode,t.numElements,void 0===t.elementType?this.gl.UNSIGNED_SHORT:t.elementType,e.offset):"number"==typeof n?this.gl.drawArraysInstanced(e.drawMode,e.offset,t.numElements,n):this.gl.drawArrays(e.drawMode,e.offset,t.numElements),this.gl.bindVertexArray(null),this},setDefines:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length>0){for(var r=-1,i=this.programMap.length,o=0;o<i;o++){var a=this.programMap[o],s=!1;if(a.length===t.length){s=!0;for(var u=0;u<t.length;u++)if(a.indexOf(t[u])<0){s=!1;break}}if(s){r=o;break}}return r<0?(this.currentShaders=q.injectDefines.apply(q,[this.shaders].concat(t)),this.programs[i]=c.apply(void 0,[this.gl].concat(Zt(this.currentShaders),[this.opts])),this.program=this.programs[i],this.programMap[i]=t,this.updateProgram(i),this):this.program===this.programs[r]?this:(this.program=this.programs[r],this.updateProgram(r),this)}return this.programMap.length>0?this.program===this.programs[0]?this:(this.program=this.programs[0],this.updateProgram(0),this):(this.currentShaders=this.shaders,this.programs[0]=c.apply(void 0,[this.gl].concat(Zt(this.shaders),[this.opts])),this.program=this.programs[0],this.programMap[0]=[],this.updateProgram(0),this)},updateProgram:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;e>-1&&e<this.programInfos.length?(this.attribSetters=this.programInfos[e].attribSetters,this.uniformSetters=this.programInfos[e].uniformSetters,this.uniformBlockSpec=this.programInfos[e].uniformBlockSpec,this.uniformBlockInfos=this.programInfos[e].uniformBlockInfos,this.currentShaders=this.programInfos[e].shaders,this._needMVPMat=this.programInfos[e]._needMVPMat,this._needVPMat=this.programInfos[e]._needVPMat,this._needCamPos=this.programInfos[e]._needCamPos,this._needNormMat=this.programInfos[e]._needNormMat,this._customAttrib=this.programInfos[e]._customAttrib):(this.gl.useProgram(this.program),this.attribSetters=T(this.gl,this.program),this.uniformSetters=R(this.gl,this.program),this.uniformBlockSpec=P(this.gl,this.program),this.uniformBlockInfos=I(this.gl,this.program,this.uniformBlockSpec),this._needMVPMat=Object.prototype.hasOwnProperty.call(this.uniformSetters,Pt),this._needVPMat=Object.prototype.hasOwnProperty.call(this.uniformSetters,wt),this._needCamPos=Object.prototype.hasOwnProperty.call(this.uniformSetters,St),this._needNormMat=Object.prototype.hasOwnProperty.call(this.uniformSetters,It),this._customAttrib=Object.keys(this.attribSetters).filter(function(e){return[_t,bt,Et,At].indexOf(e)<0}).length>0,this.programInfos[e]={attribSetters:this.attribSetters,uniformSetters:this.uniformSetters,uniformBlockSpec:this.uniformBlockSpec,uniformBlockInfos:this.uniformBlockInfos,shaders:this.currentShaders,_needMVPMat:this._needMVPMat,_needVPMat:this._needVPMat,_needCamPos:this._needCamPos,_needNormMat:this._needNormMat,_customAttrib:this._customAttrib},this.uniformObjs[e]=Object.assign({},this.currentUniformObj)),q.currentProgram=null,this._programUpdated=!0,this.currentUniformObj=this.uniformObjs[e]}}),Object.assign(q,{currentProgram:null,cullFace:!0,blend:!1,depth:!0,sampleBlend:!1,injectDefines:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(Array.isArray(e))return e.map(function(e){return q.injectDefines.apply(q,[e].concat(n))});for(var i=e.indexOf("\n")+1,o=e,a=void 0,s=0;s<n.length;s++)a="#define "+n[s]+"\n",e.indexOf(a)<0&&(o=Z(o,i,a));return o},removeDefines:function(e){for(var t=e,n=void 0,r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];for(var a=0;a<i.length;a++)n="#define "+i[a]+"\n",e.indexOf(n)>0&&(t=t.replace(n,""));return t}});K.prototype=Object.assign(Object.create(q.prototype),{constructor:K}),Object.assign(K,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\nin vec2 a_uv;\nin vec3 a_normal;\nin vec3 a_barycentric;\n\nuniform mat4 u_mvpMat;\nuniform mat4 u_worldMat;\nuniform mat3 u_normMat;\n\nout vec2 v_uv;\nout vec3 v_pos;\nout vec3 v_norm;\nout vec3 v_barycentric;\n\nvoid main() {\n    v_uv = a_uv;\n    v_pos = (u_worldMat * vec4(a_position, 1.0)).xyz;\n    v_norm = normalize(u_normMat * a_normal);\n    v_barycentric = a_barycentric;\n\n    gl_Position = u_mvpMat * vec4(a_position, 1.0);\n}\n",fs:"#version 300 es\n\nprecision mediump float;\n#define GLSLIFY 1\n\nin vec2 v_uv;\nin vec3 v_pos;\nin vec3 v_norm;\nin vec3 v_barycentric;\n\nuniform sampler2D u_texture;\n\nout vec4 finalColor;\n\nvoid main() {\n    vec4 color = texture(u_texture, v_uv);\n\n    finalColor = color + vec4(normalize(v_pos) + vec3(v_uv, 1.0) + v_barycentric, 0.0);\n}\n"});var rn=function(){var e=void 0;return function(t){return e||(e=new K(t)),e}}();Object.defineProperties(Q.prototype,{isModel:{get:function(){return!0}},name:{get:function(){return this._name||this.mesh.name},set:function(e){this._name=e}},normMat:{get:function(){return this.transform.normMat}},matrix:{get:function(){return this.transform.matrix.raw}},positionInfo:{get:function(){return this.mesh.attribArrays[_t]}},uvInfo:{get:function(){return this.mesh.attribArrays[bt]}},normalInfo:{get:function(){return this.mesh.attribArrays[Et]}},uniformObj:{get:function(){return this._uniformObj}},position:{get:function(){return this.transform.position},set:function(e){this.setPosition(e)}},scale:{get:function(){return this.transform.scale},set:function(e){this.setScale(e)}},rotation:{get:function(){return this.transform.rotation},set:function(e){this.setRotation(e)}},quaternion:{get:function(){return this.transform.quaternion},set:function(e){this.setQuaternion(e)}},drawMode:{get:function(){return void 0!==this._drawMode?this._drawMode:this.mesh.drawMode},set:function(e){this._drawMode=e}},cullFace:{get:function(){return void 0!==this._cullFace?this._cullFace:this.mesh.cullFace},set:function(e){this._cullFace=e}},blend:{get:function(){return void 0!==this._blend?this._blend:this.mesh.blend},set:function(e){this._blend=e}},depth:{get:function(){return void 0!==this._depth?this._depth:this.mesh.depth},set:function(e){this._depth=e}},sampleBlend:{get:function(){return void 0!==this._sampleBlend?this._sampleBlend:this.mesh.sampleBlend},set:function(e){this._sampleBlend=e}},instanceCount:{get:function(){return void 0!==this._instanceCount?this._instanceCount:this.mesh.instanceCount},set:function(e){this._instanceCount=e}},offset:{get:function(){return void 0!==this._offset?this._offset:this.mesh.offset},set:function(e){this._offset=e}},updateVao:{get:function(){return this.mesh._updateVao},set:function(e){this.mesh._updateVao=!!e}}}),Object.assign(Q.prototype,{setScale:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n[0]instanceof s?this.setScale.apply(this,Zt(n[0].scale)):((e=this.transform).setScale.apply(e,n),this)},setPosition:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n[0]instanceof s?this.setPosition.apply(this,Zt(n[0].position.getArray())):((e=this.transform).setPosition.apply(e,n),this)},setRotation:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n[0]instanceof s?this.setRotation.apply(this,Zt(n[0].rotation.getArray())):((e=this.transform).setRotation.apply(e,n),this)},setQuaternion:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n[0]instanceof s?this.setQuaternion.apply(this,Zt(n[0].quaternion.getArray())):((e=this.transform).setQuaternion.apply(e,n),this)},setTransform:function(e){return this.transform=e,this},preRender:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn(e);return this.createBufferInfo(e).createVAO(e,t),this},createVAO:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn(e);return this.mesh._updateVao&&this.mesh.vao&&(e.deleteVertexArray(this.mesh.vao),this.mesh._updateVao=!1,this.mesh.vao=null),this.mesh.vao||(this.mesh.vao=function(e,t,n,r){var i=e.createVertexArray();return e.bindVertexArray(i),x(r||T(e,n),t.attribs),t.indices&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indices),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindVertexArray(null),i}(e,this.mesh.bufferInfo,t.program,t.attribSetters)),this},createBufferInfo:function(e){return this.mesh.bufferInfo||(this.mesh.bufferInfo=W(e,this.mesh.attribArrays),this.bufferInfo=this.mesh.bufferInfo),this},setUniformObj:function(e){return Object.assign(this._uniformObj,e),this}});var on={getPoint:function(e,n,r,i,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new t,s=1-(o=Lt.clamp(o,0,1));return a.x=s*s*s*e.x+3*s*s*o*n.x+3*s*o*o*r.x+o*o*o*i.x,a.y=s*s*s*e.y+3*s*s*o*n.y+3*s*o*o*r.y+o*o*o*i.y,a.z=s*s*s*e.z+3*s*s*o*n.z+3*s*o*o*r.z+o*o*o*i.z,a},getPoints:function(e,t,n,r,i){for(var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=[],u=0;u<o;u++){var h=u/(o-1);s.push(on.getPoint(e,t,n,r,h))}return i?ee(s,i,a):s},simplify:ee};Object.defineProperties(te.prototype,{isMesh:{get:function(){return!0}},bufferInfo:{get:function(){return this._bufferInfo},set:function(e){this._bufferInfo=e,this._updateVao=!0}}}),Object.assign(te.prototype,{updateBufferInfo:function(e){var t=this;if(this._bufferInfo){var n=!1;Object.keys(this._bufferInfo).forEach(function(r){e[r]&&(t._bufferInfo[r]=e[r],n=!0),"attribs"===r&&Object.keys(t._bufferInfo.attribs).forEach(function(r){e[r]&&(t._bufferInfo.attribs[r]=e[r],n=!0)})}),n&&(this._updateVao=!0)}}});var an={};Object.assign(an,{createModel:function(e,t,n){return new Q(an.createMesh(e,t,n))},createMesh:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GridAxis",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,r=[],i=[],o=t/n,a=t/2,s=void 0,u=0;u<=n;u++)s=u*o-a,r.push(s),r.push(0),r.push(a),i.push(0),r.push(s),r.push(0),r.push(-a),i.push(0),r.push(-a),r.push(0),r.push(s),i.push(0),r.push(a),r.push(0),r.push(s),i.push(0);r.push(-a),r.push(0),r.push(0),i.push(1),r.push(a),r.push(0),r.push(0),i.push(1),r.push(0),r.push(-a),r.push(0),i.push(2),r.push(0),r.push(a),r.push(0),i.push(2),r.push(0),r.push(0),r.push(-a),i.push(3),r.push(0),r.push(0),r.push(a),i.push(3);var h={a_color:{data:i,numComponents:1}};return h[_t]={data:r},new te(e,h,{drawMode:1})}});var sn={};Object.assign(sn,{createModel:function(e,t,n,r){return new Q(sn.createMesh(e,t,n,r))},createMesh:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Quad",t=arguments[1],n=arguments[2],r=arguments[3];return new te(e,sn.createVertices(t,n,r),{cullFace:!1})},createVertices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e/2,i=[t+-1*r,n+1*r,t+-1*r,n+-1*r,t+1*r,n+-1*r,t+1*r,n+1*r],o={indices:{data:[0,1,3,1,2,3]}};return o[_t]={data:i,numComponents:2},o[bt]={data:[0,0,0,1,1,1,1,0]},o[Et]={data:[0,0,1,0,0,1,0,0,1,0,0,1]},o}});var un={};Object.assign(un,{createModel:function(e,t,n,r,i,o,a){return new Q(un.createMesh(e,t,n,r,i,o,a))},createMesh:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Cube",t=arguments[1],n=arguments[2],r=arguments[3],i=arguments[4],o=arguments[5],a=arguments[6];return new te(e,un.createVertices(t,n,r,i,o,a),{cullFace:!1})},createVertices:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=.5*e,s=.5*t,u=.5*n,h=r-a,l=r+a,c=i-s,f=i+s,d=o-u,m=o+u,p=[h,f,m,0,h,c,m,0,l,c,m,0,l,f,m,0,l,f,d,1,l,c,d,1,h,c,d,1,h,f,d,1,h,f,d,2,h,c,d,2,h,c,m,2,h,f,m,2,h,c,m,3,h,c,d,3,l,c,d,3,l,c,m,3,l,f,m,4,l,c,m,4,l,c,d,4,l,f,d,4,h,f,d,5,h,f,m,5,l,f,m,5,l,f,d,5],v=[],_=0;_<p.length/4;_+=4)v.push(_,_+1,_+3,_+1,_+2,_+3);for(var g=[],b=0;b<6;b++)g.push(0,0,0,1,1,1,1,0);var y={indices:{data:v}};return y[_t]={data:p,numComponents:4},y[bt]={data:g},y[Et]={data:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0]},y}});var hn={};Object.assign(hn,{createModel:function(e,t,n,r,i,o,a,s){return new Q(hn.createMesh(e,t,n,r,i,o,a,s))},createMesh:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sphere",t=arguments[1],n=arguments[2],r=arguments[3],i=arguments[4],o=arguments[5],a=arguments[6],s=arguments[7];return new te(e,hn.createVertices(t,n,r,i,o,a,s))},createVertices:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI,s=a-o,u=i-r,h=[],l=[],c=[],f=0;f<=n;f++)for(var d=0;d<=t;d++){var m=d/t,p=f/n,v=u*m+r,_=s*p+o,g=Math.sin(_),b=Math.cos(_),y=Math.sin(v),E=-Math.cos(v)*g,M=b,A=y*g;h.push(e*E,e*M,e*A),l.push(E,M,A),c.push(m,1-p)}for(var T=t+1,x=[],R=0;R<t;R++)for(var O=0;O<n;O++){var P=(O+0)*T+R+1,w=(O+0)*T+R,I=(O+1)*T+R,F=(O+1)*T+R+1;(0!==O||o>0)&&x.push(P,w,F),(O!==n-1||a<Math.PI)&&x.push(w,I,F)}var S={indices:{data:x}};return S[_t]={data:h},S[bt]={data:c},S[Et]={data:l},S}});var ln={createModel:function(e,t,n,r,i){return new Q(ln.createMesh(e,t,n,r,i))},createMesh:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"curve",t=arguments[1],n=arguments[2],r=arguments[3],i=arguments[4],o=[],a=0;a<Math.floor((t.length-1)/3);a++)o.pop(),o=o.concat(on.getPoints(t[3*a+0],t[3*a+1],t[3*a+2],t[3*a+3],n,r,i));var s=(o=o.map(function(e){return e.getArray()})).reduce(function(e,t){return e.concat(t)}),u={};return u[_t]={data:s},new te(e,u,{drawMode:3})}},cn=function(){function e(t,n){Xt(this,e);var r=this;this.lastTime=null,this.callback=t,this.isActive=!1,this.fps=0,"number"==typeof n&&n>0?(this.frameTimeLimit=1/n,this.run=function(){var e=performance.now(),t=(e-r.lastTime)/1e3;t>=r.frameTimeLimit&&(r.fps=Math.floor(1/t),r.lastTime=e,r.callback(t)),r.isActive&&window.requestAnimationFrame(r.run)}):this.run=function(){var e=performance.now(),t=(e-r.lastTime)/1e3;r.fps=Math.floor(1/t),r.lastTime=e,r.callback(t),r.isActive&&window.requestAnimationFrame(r.run)}}return Yt(e,[{key:"start",value:function(){return this.isActive=!0,this.lastTime=performance.now(),window.requestAnimationFrame(this.run),this}},{key:"stop",value:function(){this.isActive=!1}}]),e}();re.prototype=Object.assign(Object.create(q.prototype),{constructor:re}),Object.assign(re,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\nin float a_color;\n\nuniform mat4 u_mvpMat;\nuniform vec3 u_colors[4];\n\nout vec3 v_color;\n\nvoid main() {\n    v_color = u_colors[int(a_color)];\n    gl_Position = u_mvpMat * vec4(a_position, 1.0);\n}\n",fs:"#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\n\nin vec3 v_color;\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nvoid main() {\n    finalColor = vec4(v_color, 1.0);\n\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n}\n"});ie.prototype=Object.assign(Object.create(q.prototype),{constructor:ie}),Object.assign(ie,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\nin vec2 a_uv;\n\nuniform mat4 u_mvpMat;\n\nout highp vec2 v_uv;\n\nvoid main() {\n    v_uv = a_uv;\n    gl_Position = u_mvpMat * vec4(a_position, 1.0);\n}\n",fs:"#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\n\nin highp vec2 v_uv;\n\nuniform sampler2D u_texture;\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nvoid main() {\n    finalColor = texture(u_texture, vec2(v_uv.s, v_uv.t));\n\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n}\n"});oe.prototype=Object.assign(Object.create(q.prototype),{constructor:oe,setRate:function(e){return this.setUniformObj({u_rate:e}),this},setTexture:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.setUniformObj({u_dayTex:e,u_nightTex:t}),this},updateCamera:function(){return this.setProjMatrix(this.camera.projMat),this.setViewMatrix(this.camera.getOrientMatrix()),this}}),Object.assign(oe,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec4 a_position;\n\nuniform mat4 u_mvpMat;\n\nout highp vec3 v_uv;\n\nvoid main() {\n    v_uv = a_position.xyz;\n    gl_Position = u_mvpMat * vec4(a_position.xyz, 1.0);\n    gl_Position.z = gl_Position.w;\n}\n",fs:"#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\n\nin highp vec3 v_uv;\n\nuniform samplerCube u_dayTex;\nuniform samplerCube u_nightTex;\nuniform float u_rate;\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nvoid main() {\n    finalColor = mix( texture(u_dayTex, v_uv), texture(u_nightTex, v_uv), u_rate);\n\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n}\n"});ae.prototype=Object.assign(Object.create(q.prototype),{constructor:ae}),Object.assign(ae,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\nin vec2 a_uv;\nin vec3 a_normal;\n\nuniform mat4 u_mvpMat;\nuniform mat4 u_worldMat;\nuniform mat3 u_normMat;\n\nout vec2 v_uv;\nout vec3 v_pos;\nout vec3 v_norm;\n\nvoid main() {\n    v_uv = a_uv;\n    v_pos = (u_worldMat * vec4(a_position, 1.0)).xyz;\n    v_norm = u_normMat * a_normal;\n\n    gl_Position = u_mvpMat * vec4(a_position, 1.0);\n}\n",fs:"#version 300 es\n\nprecision mediump float;\n#define GLSLIFY 1\nvec3 flatnorm(vec3 pos) {\n  return normalize(cross(dFdx(pos), dFdy(pos)));\n}\n\nin vec2 v_uv;\nin vec3 v_pos;\nin vec3 v_norm;\n\nuniform Material {\n    float diffuseFactor;\n    float specularFactor;\n    float shiness;\n    bool isFlat;\n    bool isBlinn;\n    bool isGamma;\n} u_material;\n\nuniform Light {\n    vec3 position;\n    vec3 color;\n    vec3 ambientColor;\n} u_light;\n\nuniform sampler2D u_texture;\nuniform vec3 u_camPos;\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nconst float kPi = 3.14159265;\nconst vec3 gamma = vec3(1.0/2.2);\n\nvoid main() {\n    vec4 baseColor4 = texture(u_texture, v_uv);\n    vec3 baseColor = baseColor4.rgb;\n\n    vec3 ambient = u_light.ambientColor;\n\n    vec3 surfaceToLight = normalize(u_light.position - v_pos);\n    vec3 normal = vec3(0.0);\n\n    if(u_material.isFlat) {\n        normal = flatnorm(v_pos);\n    } else {\n        normal = normalize(v_norm);\n    }\n\n    float diff = max(dot(surfaceToLight, normal), 0.0);\n    vec3 diffuse = diff * u_material.diffuseFactor * u_light.color;\n\n    vec3 surfaceToView = normalize(u_camPos - v_pos);\n    float spec = 0.0;\n    if(u_material.isBlinn) {\n        float kEnergyConservation = ( 8.0 + u_material.shiness ) / ( 8.0 * kPi );\n        vec3 halfwayDir = normalize(surfaceToLight + surfaceToView);\n        spec = pow(max(dot(normal, halfwayDir), 0.0), u_material.shiness) * kEnergyConservation;\n    } else {\n        float kEnergyConservation = ( 2.0 + u_material.shiness ) / ( 2.0 * kPi ); \n        vec3 reflectDir = reflect(-surfaceToLight, normal);\n        spec = pow(max(dot(surfaceToView, reflectDir), 0.0), u_material.shiness) * kEnergyConservation;\n    }\n    vec3 specular = u_light.color * spec * u_material.specularFactor;\n\n    vec3 linearColor = (ambient + diffuse) * baseColor.rgb + specular.rgb;\n\n    if (u_material.isGamma) {\n        finalColor = vec4(pow(linearColor, gamma), baseColor4.a);\n    } else {\n        finalColor = vec4(linearColor, baseColor4.a);\n    }\n\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n}\n"});se.prototype=Object.assign(Object.create(q.prototype),{constructor:se,setColor:function(e){return this.setUniformObj({u_color:e}),1!==e[3]?this.blend=!0:this.blend=!1,this},setPointSize:function(e){return this.setUniformObj({u_pSize:e}),this}}),Object.assign(se,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\n\nuniform mat4 u_mvpMat;\nuniform float u_pSize;\n\nvoid main() {\n    gl_PointSize = u_pSize;\n    gl_Position = u_mvpMat * vec4(a_position.xyz, 1.0);\n}\n",fs:"#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\n\nuniform vec4 u_color;\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nvoid main() {\n    finalColor = u_color;\n\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n}\n"});ue.prototype=Object.assign(Object.create(q.prototype),{constructor:ue}),Object.assign(ue,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\nin vec2 a_uv;\nin vec3 a_normal;\n\nuniform mat4 u_mvpMat;\nuniform mat4 u_worldMat;\nuniform mat3 u_normMat;\n\nout vec2 v_uv;\nout vec3 v_pos;\nout vec3 v_norm;\n\nvoid main() {\n    v_uv = a_uv;\n    v_pos = (u_worldMat * vec4(a_position, 1.0)).xyz;\n    v_norm = normalize(u_normMat * a_normal);\n\n    gl_Position = u_mvpMat * vec4(a_position, 1.0);\n}\n",fs:"#version 300 es\n\nprecision mediump float;\n#define GLSLIFY 1\n\nuniform Light {\n    vec3 position;\n    vec3 color;\n    vec3 ambientColor;\n    float falloff;\n    float radius;\n} u_light;\n\nuniform Material {\n    float specularFactor;\n    float shiness;\n    float roughness;\n    float albedo;\n    bool isFlat;\n    bool isGamma;\n} u_material;\n\nin vec2 v_uv;\nin vec3 v_pos;\nin vec3 v_norm;\n\nvec3 normals(vec3 pos) {\n  vec3 fdx = dFdx(pos);\n  vec3 fdy = dFdy(pos);\n  return normalize(cross(fdx, fdy));\n}\n\nfloat orenNayarDiffuse(\n  vec3 lightDirection,\n  vec3 viewDirection,\n  vec3 surfaceNormal,\n  float roughness,\n  float albedo) {\n  \n  float LdotV = dot(lightDirection, viewDirection);\n  float NdotL = dot(lightDirection, surfaceNormal);\n  float NdotV = dot(surfaceNormal, viewDirection);\n\n  float s = LdotV - NdotL * NdotV;\n  float t = mix(1.0, max(NdotL, NdotV), step(0.0, s));\n\n  float sigma2 = roughness * roughness;\n  float A = 1.0 + sigma2 * (albedo / (sigma2 + 0.13) + 0.5 / (sigma2 + 0.33));\n  float B = 0.45 * sigma2 / (sigma2 + 0.09);\n\n  return albedo * max(0.0, NdotL) * (A + B * s / t) / 3.14159265;\n}\n\nfloat phongSpecular(\n  vec3 lightDirection,\n  vec3 viewDirection,\n  vec3 surfaceNormal,\n  float shininess) {\n\n  //Calculate Phong power\n  vec3 R = -reflect(lightDirection, surfaceNormal);\n  return pow(max(0.0, dot(viewDirection, R)), shininess);\n}\n\n// by Tom Madams\n// Simple:\n// https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n//\n// Improved\n// https://imdoingitwrong.wordpress.com/2011/02/10/improved-light-attenuation/\nfloat attenuation_0(float r, float f, float d) {\n  float denom = d / r + 1.0;\n  float attenuation = 1.0 / (denom*denom);\n  float t = (attenuation - f) / (1.0 - f);\n  return max(t, 0.0);\n}\n\nconst float gamma_0 = 2.2;\n\nfloat toLinear(float v) {\n  return pow(v, gamma_0);\n}\n\nvec2 toLinear(vec2 v) {\n  return pow(v, vec2(gamma_0));\n}\n\nvec3 toLinear(vec3 v) {\n  return pow(v, vec3(gamma_0));\n}\n\nvec4 toLinear(vec4 v) {\n  return vec4(toLinear(v.rgb), v.a);\n}\n\nconst float gamma_1 = 2.2;\n\nfloat toGamma(float v) {\n  return pow(v, 1.0 / gamma_1);\n}\n\nvec2 toGamma(vec2 v) {\n  return pow(v, vec2(1.0 / gamma_1));\n}\n\nvec3 toGamma(vec3 v) {\n  return pow(v, vec3(1.0 / gamma_1));\n}\n\nvec4 toGamma(vec4 v) {\n  return vec4(toGamma(v.rgb), v.a);\n}\n\nuniform sampler2D u_texture;\nuniform vec3 u_camPos;\n\nvec4 textureLinear(sampler2D uTex, vec2 uv) {\n    return toLinear(texture(uTex, uv));\n}\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nvoid main() {\n    vec3 normal = vec3(0.0);\n    if(u_material.isFlat) {\n        normal = normals(v_pos);\n    } else {\n        normal = normalize(v_norm);\n    }\n\n    vec3 lightVector = u_light.position - v_pos;\n    vec3 color = vec3(0.0);\n\n    float lightDistance = length(lightVector);\n    float falloff = attenuation_0(u_light.radius, u_light.falloff, lightDistance);\n\n    vec4 baseColor = vec4(0.0);\n    if(u_material.isGamma) {\n        baseColor = textureLinear(u_texture, v_uv);\n    } else {\n        baseColor = texture(u_texture, v_uv);\n    }\n    vec3 diffuseColor = baseColor.rgb;\n    \n    vec3 L = normalize(lightVector);\n    vec3 V = normalize(u_camPos - v_pos);\n\n    float specular = u_material.specularFactor * phongSpecular(L, V, normal, u_material.shiness) * falloff;\n    vec3 diffuse = u_light.color * orenNayarDiffuse(L, V, normal, u_material.roughness, u_material.albedo) * falloff;\n    vec3 ambient = u_light.ambientColor;\n\n    color += diffuseColor * (diffuse + ambient) + specular;\n\n    if (u_material.isGamma) {\n        color = toGamma(color);\n    }\n    \n    finalColor = vec4(color, baseColor.a);\n\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n\n}\n"});he.prototype=Object.assign(Object.create(q.prototype),{constructor:he,setColor:function(e){return this.setUniformObj({u_color:e}),this}}),Object.assign(he,{vs:"#version 300 es\n#define GLSLIFY 1\n\nin vec3 a_position;\n\nuniform mat4 u_mvpMat;\n\nvoid main() {\n    gl_Position = u_mvpMat * vec4(a_position, 1.0);\n}\n",fs:"#version 300 es\n\nprecision mediump float;\n#define GLSLIFY 1\n\nuniform vec3 u_color;\n\nout vec4 finalColor;\n\nvoid main() {\n    finalColor = vec4(u_color, 1.0);\n}\n"});le.prototype=Object.assign(Object.create(q.prototype),{constructor:le,preRender:function(){this.currentUniformObj.stroke[3]<1||this.currentUniformObj.fill[3]<1?(this.sampleBlend=!0,this.cullFace=!1):(this.sampleBlend=!1,this.cullFace=!0),q.prototype.preRender.call(this)}}),Object.assign(le,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\nin vec3 a_barycentric;\n\nuniform mat4 u_mvpMat;\n\nout vec3 v_barycentric;\nout vec3 v_pos;\n\nvoid main() {\n    v_barycentric = a_barycentric;\n    v_pos = a_position;\n    gl_Position = u_mvpMat * vec4(a_position, 1.0);\n}\n",fs:"#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\n\n// https://github.com/mattdesl/webgl-wireframes/blob/gh-pages/lib/wire.frag\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nfloat mod289(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat permute(float x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat taylorInvSqrt(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n  }\n\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n  {\n  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                        0.276393202250021,  // 2 * G4\n                        0.414589803375032,  // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// First corner\n  vec4 i  = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n  //  x1 = x0 - i1  + 1.0 * C.xxxx\n  //  x2 = x0 - i2  + 2.0 * C.xxxx\n  //  x3 = x0 - i3  + 3.0 * C.xxxx\n  //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289(i);\n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n\n#define PI 3.14159265359\n\nin vec3 v_barycentric;\nin vec3 v_pos;\n\nuniform float u_thickness;\nuniform vec4 u_stroke;\nuniform vec4 u_fill;\nuniform float u_secondThickness;\nuniform bool u_dualStroke;\nuniform float u_feather;\n\nuniform bool u_screenWidth;\n\nuniform vec4 u_backStroke;\nuniform bool u_colorBack;\n\nuniform float u_time;\nuniform bool u_noiseSmall;\nuniform bool u_noiseBig;\n\nuniform bool u_squeeze;\nuniform float u_squeezeEndpoint;\nuniform float u_squeezeMiddle;\n\nuniform bool u_dash;\nuniform float u_dashRepeats;\nuniform float u_dashLength;\nuniform bool u_dashOverlap;\nuniform bool u_dashAnimate;\n\nfloat edgeFactor(float offset, float thickness){\n    vec3 d = fwidth(v_barycentric);\n    vec3 a3 = smoothstep(d * ((thickness * 0.5) - u_feather) , d * ((thickness * 0.5) + u_feather), v_barycentric + offset);\n    return min(min(a3.x, a3.y), a3.z);\n}\n\nfloat aastep(float thickness, float d) {\n    float afwidth = fwidth(d) * u_feather;\n    return smoothstep(thickness - afwidth, thickness + afwidth, d);\n}\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nvoid main() {\n    float d = min(min(v_barycentric.x, v_barycentric.y), v_barycentric.z);\n    float noiseOff = 0.0;\n    if (u_noiseBig) noiseOff += snoise(vec4(v_pos.xyz * 1.0, u_time * 0.05)) * 0.15;\n    if (u_noiseSmall) noiseOff += snoise(vec4(v_pos.xyz * 80.0, u_time * 0.1)) * 0.12;\n    d += noiseOff;\n\n    float positionAlong = max(v_barycentric.x, v_barycentric.y);\n    if (v_barycentric.y < v_barycentric.x && v_barycentric.y < v_barycentric.z) {\n        positionAlong = 1.0 - positionAlong;\n    }\n\n    float computedThickness = u_thickness;\n\n    if (u_squeeze) {\n        computedThickness *= mix(u_squeezeEndpoint, u_squeezeMiddle, sin(positionAlong * PI));\n    }\n\n    if (u_dash) {\n        float offset = 1.0 / u_dashRepeats * u_dashLength / 2.0;\n\n        if (!u_dashOverlap) {\n            offset += 1.0 / u_dashRepeats / 2.0;\n        }\n\n        if (u_dashAnimate) {\n            offset += u_time * 0.022;\n        }\n\n        float pattern = fract((positionAlong + offset) * u_dashRepeats);\n        computedThickness *= 1.0 - aastep(u_dashLength, pattern);\n    }\n\n    float frag = 0.0;\n    if (u_screenWidth) {\n        frag = edgeFactor(noiseOff, computedThickness * 10.0);\n    } else {\n        frag = aastep(computedThickness / 10.0, d);\n    }\n\n    float inner = 0.0;\n    if(u_dualStroke) {\n        inner = 1.0 - aastep(u_secondThickness, d);       \n    }\n\n    if(u_colorBack && !gl_FrontFacing) {\n        finalColor = mix(u_backStroke, u_fill, abs(inner - frag));\n    } else {\n        finalColor = mix(u_stroke, u_fill, abs(inner - frag));\n    }\n\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n}\n"});ce.prototype=Object.assign(Object.create(q.prototype),{constructor:ce,preRender:function(){this.setUniformObj({resolution:[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight],near:this.camera.near,far:this.camera.far}),q.prototype.preRender.call(this)}}),Object.assign(ce,{vs:"#version 300 es\n#define GLSLIFY 1\n\n// https://github.com/spite/THREE.MeshLine/blob/master/src/THREE.MeshLine.js\n\nin vec3 a_position;\nin vec2 a_uv;\nin vec3 a_previous;\nin vec3 a_next;\nin float a_side;\nin float a_width;\nin float a_counters;\n\nuniform mat4 u_projMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_worldMat;\nuniform vec2 u_resolution;\nuniform float u_linewidth;\nuniform float u_near;\nuniform float u_far;\nuniform bool u_screenSize;\n\nout vec2 v_uv;\nout float v_counters;\n\nvec2 fix(vec4 i, float aspect) {\n    vec2 res = i.xy / i.w;\n    res.x *= aspect;\n    return res;\n}\n\nvoid main() {\n    float aspect = u_resolution.x / u_resolution.y;\n    float pixelWidthRatio = 1.0 / (u_resolution.x * u_projMat[0][0]);\n\n    v_uv = a_uv;\n    v_counters = a_counters;\n\n    mat4 m = u_projMat * u_viewMat * u_worldMat;\n    vec4 finalPosition = m * vec4(a_position, 1.0);\n    vec4 prevPos = m * vec4(a_previous, 1.0);\n    vec4 nextPos = m * vec4(a_next, 1.0);\n\n    vec2 currentP = fix(finalPosition, aspect);\n    vec2 prevP = fix(prevPos, aspect);\n    vec2 nextP = fix(nextPos, aspect);\n\n    float pixelWidth = finalPosition.w * pixelWidthRatio;\n    float w = 1.8 * pixelWidth * u_linewidth * a_width * 10.0;\n\n    if(!u_screenSize) {\n        w = 1.8 * u_linewidth * a_width * 0.01;\n    }\n\n    vec2 dir;\n    if (nextP == currentP) dir = normalize(currentP - prevP);\n    else if (prevP == currentP) dir = normalize(nextP - currentP);\n    else {\n        vec2 dir1 = normalize(currentP - prevP);\n        vec2 dir2 = normalize(nextP - currentP);\n        dir = normalize(dir1 + dir2);\n    }\n\n    vec2 normal = vec2(-dir.y, dir.x);\n    normal.x /= aspect;\n    normal *= 0.5 * w;\n\n    vec4 offset = vec4(normal * a_side, 0.0, 1.0);\n    finalPosition.xy += offset.xy;\n    \n    gl_Position = finalPosition;\n}\n",fs:"#version 300 es\n\nprecision mediump float;\n#define GLSLIFY 1\n\nin vec2 v_uv;\nin vec4 v_color;\nin float v_counters;\n\nuniform sampler2D u_texture;\nuniform bool u_useTexture;\nuniform float u_visibilityStart;\nuniform float u_visibilityEnd;\nuniform float u_tile;\nuniform vec2 u_repeat;\nuniform vec4 u_color;\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nfloat aastep(float thickness, float d) {\n    return smoothstep(thickness, thickness + u_tile, d);\n}\n\nvoid main() {\n\n    vec4 c = u_color;\n    if(u_useTexture) c *= texture(u_texture, v_uv * u_repeat);\n\n    c.a *= aastep(0.0, (v_counters - u_visibilityStart) / (u_visibilityEnd - u_visibilityStart));\n    c.a *= aastep(0.0, (u_visibilityEnd - v_counters) / (u_visibilityEnd - u_visibilityStart));\n\n    finalColor = c;\n\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n\n}\n\n"}),fe.prototype=Object.assign(Object.create(q.prototype),{constructor:fe,createBufferInfo:function(e){var t=this;return Object.keys(e).forEach(function(n){var r=e[n];"number"==typeof r?e[n]={data:r,drawType:t.gl.STREAM_COPY}:void 0===r.drawType&&(e[n].drawType=t.gl.STREAM_COPY)}),W(this.gl,e)},createTransformFeedback:function(e){return U(this.gl,this.program,this.transformfeedbackInfo,e)},transform:function(e,t){return this.gl.enable(this.gl.RASTERIZER_DISCARD),this.activate(),this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,e),this.gl.beginTransformFeedback(t.mesh.drawMode),q.prototype.renderModel.call(this,t),this.gl.endTransformFeedback(),this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null),this.gl.disable(this.gl.RASTERIZER_DISCARD),this}});var fn="MORPH_TARGET_NUM ",dn="a_morphPositions_",mn="a_morphNromals_",pn="a_morphTangents_";de.prototype=Object.assign(Object.create(q.prototype),{constructor:de,makeSafe:function(e){if(!e.makeSafeGLTF){var t=Object.keys(e.mesh.attribArrays);if(t.length>this._maxVertexAttribs){var n=t.length,r=e.defines,i={},o=0;r.indexOf("HAS_MORPH_POSITION")>-1&&(o++,i.morphPosition=!0),r.indexOf("HAS_MORPH_NORMAL")>-1&&(o++,i.morphNormal=!0),r.indexOf("HAS_MORPH_TANGENT")>-1&&(o++,i.morphTangent=!0);var a=r.filter(function(e){return e.startsWith(fn)})[0];r.splice(r.indexOf(a),1);for(var s=Number(a.slice(fn.length)),u=s,h=n;h>this._maxVertexAttribs;)u--,h-=o;if(u>0){r.push(function(e){return"MORPH_TARGET_NUM "+e}(u)),i.morphTargetNum=u,i.originCount=s,i.originPositionArrays=[],i.originNormalArrays=[],i.originTangentArrays=[];for(var l=0;l<s;l++)i.morphPosition&&i.originPositionArrays.push(e.mesh.attribArrays[dn+l]),i.morphNormal&&i.originNormalArrays.push(e.mesh.attribArrays[mn+l]),i.morphTangent&&i.originTangentArrays.push(e.mesh.attribArrays[pn+l]);i.originPositionArrays.length<1&&delete i.originPositionArrays,i.originNormalArrays.length<1&&delete i.originNormalArrays,i.originTangentArrays.length<1&&delete i.originTangentArrays,e.bufferInfo||e.createBufferInfo(this.gl),i.originPositionBufferInfo=[],i.originNormalBufferInfo=[],i.originTangentBufferInfo=[];for(var c=e.mesh.bufferInfo.attribs,f=0;f<i.originCount;f++)i.morphPosition&&i.originPositionBufferInfo.push(c[dn+f]),i.morphNormal&&i.originNormalBufferInfo.push(c[mn+f]),i.morphTangent&&i.originTangentBufferInfo.push(c[pn+f]);i.originPositionBufferInfo.length<1&&delete i.originPositionBufferInfo,i.originNormalBufferInfo.length<1&&delete i.originNormalBufferInfo,i.originTangentBufferInfo.length<1&&delete i.originTangentBufferInfo,e.morphInfo=i}console.warn("model '"+e.name+"' use "+u+" morph targets instead of origin's "+s+" morph targets, so animate maybe get strange behaver.")}e.makeSafeGLTF=!0}return this},resortMorph:function(){function e(e,t){return t.weight-e.weight}function t(e,t){return t-e}return function(n){if(n.morphInfo){var r=n.morphInfo,i={},o=r.lastWeight,a=r.morphTargetNum,s=r.originPositionBufferInfo,u=r.originNormalBufferInfo,h=r.originTangentBufferInfo,l=n.uniformObj.u_morphWeights;if(!o||!Lt.arrayEquals(l,o)){r.lastWeight=l.slice();var c=l.slice().sort(t),f={};f.u_morphWeights=c,n.setUniformObj(f);for(var d=[],m=0;m<l.length;m++)d[m]={weight:l[m]};for(var p=d.slice().sort(e).map(function(e){return d.indexOf(e)}),v=0;v<a;v++)s&&(i[dn+v]=s[p[v]]),u&&(i[mn+v]=u[p[v]]),h&&(i[pn+v]=h[p[v]]);n.mesh.updateBufferInfo(i)}}return this}}(),renderModel:function(e){var t;return e.defines&&(t=this.makeSafe(e).resortMorph(e)).setDefines.apply(t,Zt(e.defines)),q.prototype.renderModel.call(this,e)}}),Object.assign(de,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\n\n#ifdef UV_NUM\nin vec2 a_uv;\n#endif\n\n#ifdef HAS_VERTEXCOLOR\nin vec4 a_color;\nout vec4 v_color;\n#endif\n\nuniform mat4 u_mvpMat;\nuniform mat4 u_worldMat;\n\nout vec2 v_uv;\nout vec3 v_pos;\n\n#ifdef HAS_NORMAL\nin vec3 a_normal;\n    #ifdef HAS_TANGENT\n    in vec4 a_tangent;\n    #endif\nuniform mat3 u_normMat;\n#endif\n#ifdef HAS_NORMAL\n    #ifdef HAS_TANGENT\n    out mat3 v_TBN;\n    #else\n    out vec3 v_normal;\n    #endif\n#endif\n\n#ifdef JOINTS_NUM\nin vec4 a_joint;\nin vec4 a_weight;\n\n    #ifdef JOINT_VEC8\n    in vec4 a_joint1;\n    in vec4 a_weight1;\n    #endif\n\nuniform mat4 u_jointMatrix[JOINTS_NUM];\n#endif\n\n// max targets num is 8\n#ifdef MORPH_TARGET_NUM\n    uniform float u_morphWeights[MORPH_TARGET_NUM];\n    #ifdef HAS_MORPH_POSITION\n    in vec3 a_morphPositions_0;\n        #if MORPH_TARGET_NUM > 1\n        in vec3 a_morphPositions_1;\n        #endif\n        #if MORPH_TARGET_NUM > 2\n        in vec3 a_morphPositions_2;\n        #endif\n        #if MORPH_TARGET_NUM > 3\n        in vec3 a_morphPositions_3;\n        #endif\n        #if MORPH_TARGET_NUM > 4\n        in vec3 a_morphPositions_4;\n        #endif\n        #if MORPH_TARGET_NUM > 5\n        in vec3 a_morphPositions_5;\n        #endif\n        #if MORPH_TARGET_NUM > 6\n        in vec3 a_morphPositions_6;\n        #endif\n        #if MORPH_TARGET_NUM > 7\n        in vec3 a_morphPositions_7;\n        #endif\n    #endif\n\n    #ifdef HAS_MORPH_NORMAL\n    in vec3 a_morphNromals_0;\n        #if MORPH_TARGET_NUM > 1\n        in vec3 a_morphNromals_1;\n        #endif\n        #if MORPH_TARGET_NUM > 2\n        in vec3 a_morphNromals_2;\n        #endif\n        #if MORPH_TARGET_NUM > 3\n        in vec3 a_morphNromals_3;\n        #endif\n        #if MORPH_TARGET_NUM > 4\n        in vec3 a_morphNromals_4;\n        #endif\n        #if MORPH_TARGET_NUM > 5\n        in vec3 a_morphNromals_5;\n        #endif\n        #if MORPH_TARGET_NUM > 6\n        in vec3 a_morphNromals_6;\n        #endif\n        #if MORPH_TARGET_NUM > 7\n        in vec3 a_morphNromals_7;\n        #endif\n    #endif\n    #ifdef HAS_MORPH_TANGENT\n    in vec3 a_morphTangents_0;\n        #if MORPH_TARGET_NUM > 1\n        in vec3 a_morphTangents_1;\n        #endif\n        #if MORPH_TARGET_NUM > 2\n        in vec3 a_morphTangents_2;\n        #endif\n        #if MORPH_TARGET_NUM > 3\n        in vec3 a_morphTangents_3;\n        #endif\n        #if MORPH_TARGET_NUM > 4\n        in vec3 a_morphTangents_4;\n        #endif\n        #if MORPH_TARGET_NUM > 5\n        in vec3 a_morphTangents_5;\n        #endif\n        #if MORPH_TARGET_NUM > 6\n        in vec3 a_morphTangents_6;\n        #endif\n        #if MORPH_TARGET_NUM > 7\n        in vec3 a_morphTangents_7;\n        #endif\n    #endif\n#endif\n\nvoid main() {\n\n    vec3 position = a_position;\n\n    #ifdef HAS_NORMAL\n    vec3 normal = a_normal;\n        #ifdef HAS_TANGENT\n        vec3 tangent3 = a_tangent.xyz;\n        #endif\n    #endif\n\n    #ifdef MORPH_TARGET_NUM\n        #ifdef HAS_MORPH_POSITION\n        position += u_morphWeights[0] * a_morphPositions_0;\n            #if MORPH_TARGET_NUM > 1\n            position += u_morphWeights[1] * a_morphPositions_1;\n            #endif\n            #if MORPH_TARGET_NUM > 2\n            position += u_morphWeights[2] * a_morphPositions_2;\n            #endif\n            #if MORPH_TARGET_NUM > 3\n            position += u_morphWeights[3] * a_morphPositions_3;\n            #endif\n            #if MORPH_TARGET_NUM > 4\n            position += u_morphWeights[4] * a_morphPositions_4;\n            #endif\n            #if MORPH_TARGET_NUM > 5\n            position += u_morphWeights[5] * a_morphPositions_5;\n            #endif\n            #if MORPH_TARGET_NUM > 6\n            position += u_morphWeights[6] * a_morphPositions_6;\n            #endif\n            #if MORPH_TARGET_NUM > 7\n            position += u_morphWeights[7] * a_morphPositions_7;\n            #endif\n        #endif\n\n        #ifdef HAS_NORMAL\n            #ifdef HAS_MORPH_NORMAL\n            normal += u_morphWeights[0] * a_morphNromals_0;\n                #if MORPH_TARGET_NUM > 1\n                normal += u_morphWeights[1] * a_morphNromals_1;\n                #endif\n                #if MORPH_TARGET_NUM > 2\n                normal += u_morphWeights[2] * a_morphNromals_2;\n                #endif\n                #if MORPH_TARGET_NUM > 3\n                normal += u_morphWeights[3] * a_morphNromals_3;\n                #endif\n                #if MORPH_TARGET_NUM > 4\n                normal += u_morphWeights[4] * a_morphNromals_4;\n                #endif\n                #if MORPH_TARGET_NUM > 5\n                normal += u_morphWeights[5] * a_morphNromals_5;\n                #endif\n                #if MORPH_TARGET_NUM > 6\n                normal += u_morphWeights[6] * a_morphNromals_6;\n                #endif\n                #if MORPH_TARGET_NUM > 7\n                normal += u_morphWeights[7] * a_morphNromals_7;\n                #endif\n            #endif\n\n            #ifdef HAS_TANGENT\n                #ifdef HAS_MORPH_TANGENT\n                tangent3 += u_morphWeights[0] * a_morphTangents_0;\n                    #if MORPH_TARGET_NUM > 1\n                    tangent3 += u_morphWeights[1] * a_morphTangents_1;\n                    #endif\n                    #if MORPH_TARGET_NUM > 2\n                    tangent3 += u_morphWeights[2] * a_morphTangents_2;\n                    #endif\n                    #if MORPH_TARGET_NUM > 3\n                    tangent3 += u_morphWeights[3] * a_morphTangents_3;\n                    #endif\n                    #if MORPH_TARGET_NUM > 4\n                    tangent3 += u_morphWeights[4] * a_morphTangents_4;\n                    #endif\n                    #if MORPH_TARGET_NUM > 5\n                    tangent3 += u_morphWeights[5] * a_morphTangents_5;\n                    #endif\n                    #if MORPH_TARGET_NUM > 6\n                    tangent3 += u_morphWeights[6] * a_morphTangents_6;\n                    #endif\n                    #if MORPH_TARGET_NUM > 7\n                    tangent3 += u_morphWeights[7] * a_morphTangents_7;\n                    #endif\n                #endif\n            #endif\n        #endif\n    #endif\n\n    #ifdef JOINTS_NUM\n    mat4 skinMatrix =\n        a_weight.x * u_jointMatrix[int(a_joint.x)] +\n        a_weight.y * u_jointMatrix[int(a_joint.y)] +\n        a_weight.z * u_jointMatrix[int(a_joint.z)] +\n        a_weight.w * u_jointMatrix[int(a_joint.w)];\n\n        #ifdef JOINT_VEC8\n        skinMatrix +=\n            a_weight1.x * u_jointMatrix[int(a_joint1.x)] +\n            a_weight1.y * u_jointMatrix[int(a_joint1.y)] +\n            a_weight1.z * u_jointMatrix[int(a_joint1.z)] +\n            a_weight1.w * u_jointMatrix[int(a_joint1.w)];\n        #endif\n    #endif\n\n    #ifdef HAS_NORMAL\n        #ifdef HAS_TANGENT\n            #ifdef JOINTS_NUM\n            mat3 skinInf = mat3(transpose(inverse(skinMatrix)));\n            vec3 normalW = normalize(u_normMat * skinInf * normal);\n            vec3 tangentW = normalize(u_normMat * skinInf * tangent3);\n            #else\n            vec3 normalW = normalize(u_normMat * normal);\n            vec3 tangentW = normalize(u_normMat * tangent3);\n            #endif\n        vec3 bitangentW = cross(normalW, tangentW) * a_tangent.w;\n        v_TBN = mat3(tangentW, bitangentW, normalW);\n        #else\n            #ifdef JOINTS_NUM\n            v_normal = u_normMat * transpose(inverse(mat3(skinMatrix))) * normal;\n            #else\n            v_normal = u_normMat * normal;\n            #endif\n        #endif\n    #endif\n\n    #ifdef JOINTS_NUM\n    vec4 worldPos = u_worldMat * skinMatrix * vec4(position, 1.0);\n    gl_Position = u_mvpMat * skinMatrix * vec4(position, 1.0);\n    #else\n    vec4 worldPos = u_worldMat * vec4(position, 1.0);\n    gl_Position = u_mvpMat * vec4(position, 1.0);\n    #endif\n    v_pos = worldPos.xyz / worldPos.w;\n    #ifdef UV_NUM\n    v_uv = a_uv;\n    #else\n    v_uv = vec2(0.0);\n    #endif\n\n    #ifdef HAS_VERTEXCOLOR\n    v_color = a_color;\n    #endif\n}\n",fs:"#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\n#define USE_IBL\nuniform vec3 u_lightDirection;\nuniform vec3 u_lightColor;\n\n#ifdef HAS_VERTEXCOLOR\nin vec4 v_color;\n#endif\n\n#ifdef ALPHA_MASK\nuniform float u_alphaCutoff;\n#endif\n\n#ifdef USE_IBL\nuniform samplerCube u_diffuseEnvMap;\nuniform samplerCube u_specularEnvMap;\nuniform sampler2D u_brdfLUT;\n#endif\n\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_baseColorSampler;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_metallicRoughnessSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform float u_normalScale;\nuniform sampler2D u_normalSampler;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_emissiveSampler;\nuniform vec3 u_emissiveFactor;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_occlusionSampler;\nuniform float u_occlusionFactor;\n#endif\n\nuniform vec4 u_baseColorFactor;\nuniform vec2 u_metallicRoughnessValues;\n\nuniform vec3 u_camPos;\nin vec3 v_pos;\nin vec2 v_uv;\n\n#ifdef HAS_NORMAL\n    #ifdef HAS_TANGENT\n    in mat3 v_TBN;\n    #else\n    in vec3 v_normal;\n    #endif\n#endif\n\nstruct PBRInfo\n{\n    float NdotL;\n    float NdotV;\n    float NdotH;\n    float LdotH;\n    float VdotH;\n    float perceptualRoughness;\n    float metalness;\n    vec3 reflectance0;\n    vec3 reflectance90;\n    float alphaRoughness;\n    vec3 diffuseColor;\n    vec3 specularColor;\n};\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n    #ifdef MANUAL_SRGB\n        #ifdef SRGB_FAST_APPROXIMATION\n        vec3 linOut = pow(srgbIn.xyz, vec3(2.2));\n        #else\n        vec3 bLess = step(vec3(0.04045), srgbIn.xyz);\n        vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055), vec3(2.4)), bLess);\n        #endif\n    return vec4(linOut, srgbIn.w);\n    #else\n    return srgbIn;\n    #endif\n}\n\nvec3 getNormal()\n{\n    #ifndef HAS_TANGENT\n    vec3 pos_dx = dFdx(v_pos);\n    vec3 pos_dy = dFdy(v_pos);\n    vec3 tex_dx = dFdx(vec3(v_uv, 0.0));\n    vec3 tex_dy = dFdy(vec3(v_uv, 0.0));\n    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n        #ifdef HAS_NORMAL\n        vec3 ng = normalize(v_normal);\n        #else\n        vec3 ng = cross(pos_dx, pos_dy);\n        #endif\n    t = normalize(t - ng * dot(ng, t));\n    vec3 b = normalize(cross(ng, t));\n    mat3 tbn = mat3(t, b, ng);\n    #else\n    mat3 tbn = v_TBN;\n    #endif\n\n    #ifdef HAS_NORMALMAP\n    vec3 n = texture(u_normalSampler, v_uv).rgb;\n    n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_normalScale, u_normalScale, 1.0)));\n    #else\n    vec3 n = normalize(tbn[2].xyz);\n    #endif\n\n    return n;\n}\n\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)\n{\n    float mipCount = 9.0;\n    float lod = (pbrInputs.perceptualRoughness * mipCount);\n    vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT, vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;\n    vec3 diffuseLight = SRGBtoLINEAR(texture(u_diffuseEnvMap, n)).rgb;\n\n    #ifdef USE_TEX_LOD\n    vec3 specularLight = SRGBtoLINEAR(texture(u_specularEnvMap, reflection, lod)).rgb;\n    #else\n    vec3 specularLight = SRGBtoLINEAR(texture(u_specularEnvMap, reflection)).rgb;\n    #endif\n\n    vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;\n    vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);\n\n    return diffuse + specular;\n}\n#endif\n\nvec3 diffuse(PBRInfo pbrInputs)\n{\n    return pbrInputs.diffuseColor / M_PI;\n}\n\nvec3 specularReflection(PBRInfo pbrInputs)\n{\n    return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n}\n\nfloat geometricOcclusion(PBRInfo pbrInputs)\n{\n    float NdotL = pbrInputs.NdotL;\n    float NdotV = pbrInputs.NdotV;\n    float r = pbrInputs.alphaRoughness;\n\n    float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n    float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n    return attenuationL * attenuationV;\n}\n\nfloat microfacetDistribution(PBRInfo pbrInputs)\n{\n    float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n    float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n    return roughnessSq / (M_PI * f * f);\n}\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nvoid main() {\n\n    float perceptualRoughness = u_metallicRoughnessValues.y;\n    float metallic = u_metallicRoughnessValues.x;\n\n    #ifdef HAS_METALROUGHNESSMAP\n    vec4 mrSample = texture(u_metallicRoughnessSampler, v_uv);\n    perceptualRoughness = mrSample.g * perceptualRoughness;\n    metallic = mrSample.b * metallic;\n    #endif\n\n    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n    metallic = clamp(metallic, 0.0, 1.0);\n    float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n    #ifdef HAS_BASECOLORMAP\n    vec4 baseColor = SRGBtoLINEAR(texture(u_baseColorSampler, v_uv)) * u_baseColorFactor;\n    #else\n    vec4 baseColor = u_baseColorFactor;\n    #endif\n    #ifdef HAS_VERTEXCOLOR\n    baseColor.rgb *= v_color.rgb;\n    #endif\n\n    float alpha = baseColor.a;\n    #ifdef ALPHA_MASK\n    if(alpha < u_alphaCutoff){\n        discard;\n    }\n    #endif\n    #ifndef ALPHA_BLEND\n    alpha = 1.0;\n    #endif\n\n    vec3 f0 = vec3(0.04);\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n    diffuseColor *= 1.0 - metallic;\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n    vec3 specularEnvironmentR0 = specularColor.rgb;\n    vec3 specularEnvironmentR90 = vec3(1.0) * reflectance90;\n\n    vec3 n = getNormal();\n    vec3 v = normalize(u_camPos - v_pos);\n    vec3 l = normalize(u_lightDirection);\n    vec3 h = normalize(l+v);\n    vec3 reflection = -normalize(reflect(v, n));\n\n    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n    float NdotV = abs(dot(n, v)) + 0.001;\n    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n\n    PBRInfo pbrInputs = PBRInfo(\n        NdotL,\n        NdotV,\n        NdotH,\n        LdotH,\n        VdotH,\n        perceptualRoughness,\n        metallic,\n        specularEnvironmentR0,\n        specularEnvironmentR90,\n        alphaRoughness,\n        diffuseColor,\n        specularColor\n    );\n\n    vec3 F = specularReflection(pbrInputs);\n    float G = geometricOcclusion(pbrInputs);\n    float D = microfacetDistribution(pbrInputs);\n\n    vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n    vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);\n    vec3 color = NdotL * u_lightColor * (diffuseContrib + specContrib);\n\n    #ifdef USE_IBL\n    color += getIBLContribution(pbrInputs, n, reflection);\n    #endif\n\n    #ifdef HAS_OCCLUSIONMAP\n    float ao = texture(u_occlusionSampler, v_uv).r;\n    color = mix(color, color * ao, u_occlusionFactor);\n    #endif\n\n    #ifdef HAS_EMISSIVEMAP\n    vec3 emissive = SRGBtoLINEAR(texture(u_emissiveSampler, v_uv)).rgb * u_emissiveFactor;\n    color += emissive;\n    #endif\n\n    finalColor = vec4(color, alpha);\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n}\n"}),me.prototype=Object.assign(Object.create(Q.prototype),{constructor:me,comparePos:function(e,t){var n=6*e,r=6*t;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]},copyPos:function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},process:function(e,t){this.positions=[],this.conters=[];for(var n=0;n<e.length;n+=3){var r=n/(e.length-3);this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.conters.push(r),this.conters.push(r)}var i=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices=[],this.uv=[];for(var o=0;o<i;o++)this.side.push(1),this.side.push(-1);for(var a=void 0,s=0;s<i;s++)a=this.widthCallback?this.widthCallback(s/i-1):1,this.width.push(a),this.width.push(a);for(var u=0;u<i;u++)this.uv.push(u/(i-1),0),this.uv.push(u/(i-1),1);var h=void 0;h=this.comparePos(0,i-1)?this.copyPos(i-2):this.copyPos(0),this.previous.push(h[0],h[1],h[2]),this.previous.push(h[0],h[1],h[2]);for(var l=0;l<i-1;l++)h=this.copyPos(l),this.previous.push(h[0],h[1],h[2]),this.previous.push(h[0],h[1],h[2]);for(var c=1;c<i;c++)h=this.copyPos(c),this.next.push(h[0],h[1],h[2]),this.next.push(h[0],h[1],h[2]);h=this.comparePos(i-1,0)?this.copyPos(1):this.copyPos(i-1),this.next.push(h[0],h[1],h[2]),this.next.push(h[0],h[1],h[2]);for(var f=0;f<i-1;f++){var d=2*f;this.indices.push(d,d+1,d+2),this.indices.push(d+1,d+3,d+2)}this.positionArray=[],this.positionArray.push(this.previous[0],this.previous[1],this.previous[2],0,this.previous[0],this.previous[1],this.previous[2],0);for(var m=0;m<this.positions.length/3;m++)this.positionArray.push(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2],this.side[m]);this.positionArray.push(this.next[this.next.length-3],this.next[this.next.length-2],this.next[this.next.length-1],0,this.next[this.next.length-3],this.next[this.next.length-2],this.next[this.next.length-1],0);var p={indices:{data:this.indices},a_previous:{data:this.previous,numComponents:3,stride:4*Float32Array.BYTES_PER_ELEMENT},a_next:{data:this.next,numComponents:3,offset:16*Float32Array.BYTES_PER_ELEMENT,stride:4*Float32Array.BYTES_PER_ELEMENT},a_side:{data:this.side,numComponents:1,offset:11*Float32Array.BYTES_PER_ELEMENT,stride:4*Float32Array.BYTES_PER_ELEMENT},a_width:{data:this.width,numComponents:1},a_counters:{data:this.conters,numComponents:1}};return p[_t]={data:this.positions,offset:8*Float32Array.BYTES_PER_ELEMENT,stride:4*Float32Array.BYTES_PER_ELEMENT},p[bt]={data:this.uv},new te(t,p)},createBufferInfo:function(e){if(!this.mesh.bufferInfo){var t=G(e,this.positionArray,"position");this.mesh.attribArrays[_t].buffer=t,this.mesh.attribArrays.a_previous.buffer=t,this.mesh.attribArrays.a_next.buffer=t,this.mesh.attribArrays.a_side.buffer=t}return Q.prototype.createBufferInfo.call(this,e),this}});var vn={textureColor:new Uint8Array([255,105,180,255]),textureOptions:{}},_n={},gn=_n;gn[6406]={textureFormat:6406,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},gn[6409]={textureFormat:6409,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},gn[6410]={textureFormat:6410,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[5121,5131,36193,5126]},gn[6407]={textureFormat:6407,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[5121,5131,36193,5126,33635]},gn[6408]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[5121,5131,36193,5126,32819,32820]},gn[33321]={textureFormat:6403,colorRenderable:!0,textureFilterable:!0,bytesPerElement:1,type:5121},gn[36756]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:1,type:5120},gn[33325]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[5126,5131]},gn[33326]={textureFormat:6403,colorRenderable:!1,textureFilterable:!1,bytesPerElement:4,type:5126},gn[33330]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:1,type:5121},gn[33329]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:1,type:5120},gn[33332]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:2,type:5123},gn[33331]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:2,type:5122},gn[33334]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:5125},gn[33333]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:5124},gn[33323]={textureFormat:33319,colorRenderable:!0,textureFilterable:!0,bytesPerElement:2,type:5121},gn[36757]={textureFormat:33319,colorRenderable:!1,textureFilterable:!0,bytesPerElement:2,type:5120},gn[33327]={textureFormat:33319,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[5126,5131]},gn[33328]={textureFormat:33319,colorRenderable:!1,textureFilterable:!1,bytesPerElement:8,type:5126},gn[33336]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:2,type:5121},gn[33335]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:2,type:5120},gn[33338]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:5123},gn[33337]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:5122},gn[33340]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:8,type:5125},gn[33339]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:8,type:5124},gn[32849]={textureFormat:6407,colorRenderable:!0,textureFilterable:!0,bytesPerElement:3,type:5121},gn[35905]={textureFormat:6407,colorRenderable:!1,textureFilterable:!0,bytesPerElement:3,type:5121},gn[36194]={textureFormat:6407,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[5121,33635]},gn[36758]={textureFormat:6407,colorRenderable:!1,textureFilterable:!0,bytesPerElement:3,type:5120},gn[35898]={textureFormat:6407,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35899]},gn[35901]={textureFormat:6407,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35902]},gn[34843]={textureFormat:6407,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[5126,5131]},gn[34837]={textureFormat:6407,colorRenderable:!1,textureFilterable:!1,bytesPerElement:12,type:5126},gn[36221]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:3,type:5121},gn[36239]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:3,type:5120},gn[36215]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:6,type:5123},gn[36233]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:6,type:5122},gn[36209]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:12,type:5125},gn[36227]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:12,type:5124},gn[32856]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:4,type:5121},gn[35907]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:4,type:5121},gn[36759]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:4,type:5120},gn[32855]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[5121,32820,33640]},gn[32854]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[5121,32819]},gn[32857]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:4,type:33640},gn[34842]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[5126,5131]},gn[34836]={textureFormat:6408,colorRenderable:!1,textureFilterable:!1,bytesPerElement:16,type:5126},gn[36220]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:5121},gn[36238]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:5120},gn[36975]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:33640},gn[36214]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:8,type:5123},gn[36232]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:8,type:5122},gn[36226]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:16,type:5124},gn[36208]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:16,type:5125},gn[33189]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[5123,5125]},gn[33190]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:5125},gn[36012]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:5126},gn[35056]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:34042},gn[36013]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:4,type:36269},Object.keys(gn).forEach(function(e){var t=gn[e];if(t.bytesPerElementMap={},Array.isArray(t.bytesPerElement))t.bytesPerElement.forEach(function(e,n){var r=t.type[n];t.bytesPerElementMap[r]=e});else{var n=t.type;t.bytesPerElementMap[n]=t.bytesPerElement}});var bn=function(){var e=new RegExp(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);return function(t){if(t.match(e)&&new URL(t).origin!==window.location.origin)return"anonymous"}}(),yn={},En=window.WebGLSampler||function(){},Mn=document.createElement("canvas").getContext("2d"),An=function(){function e(t,n){Xt(this,e),this.context=function(e,t){var n=void 0;n="string"==typeof e?document.getElementById(e):e;for(var r=["webgl2","experimental-webgl2","webgl","experimental-webgl"],i=null,o=0;o<r.length;o++)if(i=n.getContext(r[o],t)){console.log("renderer: "+(i.getParameter(i.VERSION)||r[o]));break}if(!i)throw new Error("Please use a decent browser, this browser not support WebglContext.");return i}(t,n),this.canvas=this.context.canvas,this.multiplier=1,this.context.cullFace(this.context.BACK),this.context.frontFace(this.context.CCW),this.context.enable(this.context.CULL_FACE),this.context.enable(this.context.DEPTH_TEST),this.context.depthFunc(this.context.LEQUAL),this.context.blendFunc(this.context.SRC_ALPHA,this.context.ONE_MINUS_SRC_ALPHA)}return Yt(e,[{key:"clear",value:function(e,t,n,r){if(Array.isArray(e)){if(3===e.length)return Le(this.context,e[0],e[1],e[2],1),this;if(4===e.length)return Le(this.context,e[0],e[1],e[2],e[3]),this}return Le(this.context,e,t,n,r),this}},{key:"setSize",value:function(e,t){return this.canvas.style.width=e,this.canvas.style.height=t,this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.context.viewport(0,0,this.canvas.width,this.canvas.height),this}},{key:"fixCanvasToDisplay",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"number"==typeof e&&e>0&&this.multiplier!==e&&(this.multiplier=e),!!function(e,t){var n=t||1;n=Math.max(0,n);var r=e.clientWidth*n|0,i=e.clientHeight*n|0;return(e.width!==r||e.height!==i)&&(e.width=r,e.height=i,!0)}(this.canvas,this.multiplier)&&(t&&this.context.viewport(0,0,this.canvas.width,this.canvas.height),!0)}}]),e}();Object.defineProperties(Ue.prototype,{position:{get:function(){return this.transform.position},set:function(e){this.transform.position=e}}}),Object.assign(Ue.prototype,{getOrientMatrix:function(){var e=new Float32Array(this.viewMat);return e[12]=e[13]=e[14]=0,e},getVec3Position:function(){return this.transform.getVec3Position()},updateViewMatrix:function(e){e&&(this.target=e),r.lookAt(this.viewMat,this.transform.position,this.target.getArray(),this.up),r.invert(this.matrix,this.viewMat),this.getVec3Position().set(this.matrix[12],this.matrix[13],this.matrix[14])}}),ke.prototype=Object.assign(Object.create(Ue.prototype),{isPerspectiveCamera:!0,updateProjMatrix:function(e){e&&e!==this.aspect&&(this.aspect=e),r.perspective(this.projMat,this.fovRadian,this.aspect,this.near,this.far)}}),Object.defineProperties(ke.prototype,{fov:{get:function(){return this._fov},set:function(e){this._fov=e,this.fovRadian=Lt.degree2Radian(this._fov)}}}),Be.prototype=Object.assign(Object.create(Ue.prototype),{isOrthographicCamera:!0,updateProjMatrix:function(e){e&&e!==this.aspect&&(this.aspect=e),this.left=this.size*this.aspect/-2,this.right=this.size*this.aspect/2,r.ortho(this.projMat,this.left/this.zoom,this.right/this.zoom,this.bottom/this.zoom,this.top/this.zoom,this.near/this.zoom,this.far/this.zoom)}}),Object.defineProperties(De.prototype,{x:{get:function(){return this.raw[0]},set:function(e){this.raw[0]=e}},y:{get:function(){return this.raw[1]},set:function(e){this.raw[1]=e}},width:{get:function(){return this.raw[0]},set:function(e){this.raw[0]=e}},height:{get:function(){return this.raw[1]},set:function(e){this.raw[1]=e}}}),Object.assign(De.prototype,{set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},clone:function(){return new De(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.min(e.y,Math.min(t.y,this.y)),this}}),Object.assign(ze.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new ze).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVecor3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(Lt.clamp(e.y/this.radius,-1,1))),this}});var Tn=function(){function e(n,r,i){Xt(this,e),this.controler=i,this.camera=n,this.domElement=void 0!==r?r:document,this.enable=!0,this.target=new t,this.minDistance=.1,this.maxDistance=1/0,this.minZoom=.01,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.08,this.zoomFactor=.2,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=.8,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2},this._offset=new t,this._spherical=new ze,this._sphericalDelta=new ze,this._sphericalDump=new ze,this._zoomFrag=0,this._scale=1,this._panOffset=new t,this._isMouseUp=!0,this._vPan=new t,this._rotateStart=new De,this._rotateEnd=new De,this._rotateDelta=new De,this._panStart=new De,this._panEnd=new De,this._panDelta=new De,this._zoomStart=new De,this._zoomEnd=new De,this._zoomDelta=new De,this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},this._state=this.STATE.NONE,this.eventListeners=[{type:"mousedown",listener:this.onMouseDown.bind(this)},{type:"wheel",listener:this.onMouseWheel.bind(this)},{type:"keydown",listener:this.onKeyDown.bind(this)},{type:"touchstart",listener:this.onTouchStart.bind(this)},{type:"touchend",listener:this.onTouchEnd.bind(this)},{type:"touchmove",listener:this.onTouchMove.bind(this)}],this.mouseMoveUpListeners=[{type:"mousemove",listener:this.onMouseMove.bind(this)},{type:"mouseup",listener:this.onMouseUp.bind(this)}],this.controler.addListeners(this.eventListeners),this.update()}return Yt(e,[{key:"dispose",value:function(){this.controler.removeListeners(this.eventListeners,this.mouseMoveUpListeners)}},{key:"update",value:function(){var e=this.camera.getVec3Position();this._offset.copy(e).sub(this.target),this._spherical.setFromVecor3(this._offset),this.autoRotate&&this._state===this.STATE.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi,this._spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),1!==this._scale&&(this._zoomFrag=this._spherical.radius*(this._scale-1)),this._spherical.radius+=this._zoomFrag,this._spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this._spherical.radius)),this.target.add(this._panOffset),this._offset.setFromSpherical(this._spherical),e.copy(this.target).add(this._offset),this.camera.updateViewMatrix(this.target),!0===this.enableDamping?(this._sphericalDump.theta*=1-this.dampingFactor,this._sphericalDump.phi*=1-this.dampingFactor,this._zoomFrag*=1-this.zoomFactor,this._isMouseUp?(this._sphericalDelta.theta=this._sphericalDump.theta,this._sphericalDelta.phi=this._sphericalDump.phi):this._sphericalDelta.set(0,0,0)):(this._sphericalDelta.set(0,0,0),this._zoomFrag=0),this._scale=1,this._panOffset.set(0,0,0)}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60/this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this._sphericalDelta.theta-=e,this.enableDamping&&(this._sphericalDump.theta=-e)}},{key:"rotateUp",value:function(e){this._sphericalDelta.phi-=e,this.enableDamping&&(this._sphericalDump.phi=-e)}},{key:"panLeft",value:function(e,t){this._vPan.setFromArray(t,0),this._vPan.multiScalar(-e),this._panOffset.add(this._vPan)}},{key:"panUp",value:function(e,t){this._vPan.setFromArray(t,4),this._vPan.multiScalar(e),this._panOffset.add(this._vPan)}},{key:"pan",value:function(e,t){var n=this.domElement===document?this.domElement.body:this.domElement;if(this.camera.isPerspectiveCamera){var r=this.camera.getVec3Position();this._vPan.copy(r).sub(this.target);var i=this._vPan.length();i*=this.camera.fov/2*(Math.PI/180),this.panLeft(2*e*(i/n.clientHeight),this.camera.matrix),this.panUp(2*t*(i/n.clientHeight),this.camera.matrix)}else this.camera.isOrthographicCamera&&(this.panLeft(e*(this.camera.right-this.camera.left)/this.camera.zoom/n.clientHeight,this.camera.matrix),this.panUp(t*(this.camera.top-this.camera.bottom)/this.camera.zoom/n.clientHeight,this.camera.matrix))}},{key:"zoomIn",value:function(e){this.camera.isPerspectiveCamera?this._scale/=e:this.camera.isOrthographicCamera&&(this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom*e)),this.camera.updateProjMatrix())}},{key:"zoomOut",value:function(e){this.camera.isPerspectiveCamera?this._scale*=e:this.camera.isOrthographicCamera&&(this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom/e)),this.camera.updateProjMatrix())}},{key:"handleMouseDownRotate",value:function(e){this._rotateStart.set(e.clientX,e.clientY)}},{key:"handleMouseDownZoom",value:function(e){this._zoomStart.set(e.clientX,e.clientY)}},{key:"handleMouseDownPan",value:function(e){this._panStart.set(e.clientX,e.clientY)}},{key:"handleMouseMoveRotate",value:function(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart);var t=this.domElement===document?document.body:this.domElement;this.rotateLeft(2*Math.PI*(this._rotateDelta.x/t.clientWidth)*this.rotateSpeed),this.rotateUp(2*Math.PI*(this._rotateDelta.y/t.clientHeight)*this.rotateSpeed),this._rotateStart.copy(this._rotateEnd),this.update()}},{key:"handleMouseMoveZoom",value:function(e){this._zoomEnd.set(e.clientX,e.clientY),this._zoomDelta.subVectors(this._zoomEnd,this._zoomStart),this._zoomDelta.y>0?this.zoomIn(this.getZoomScale()):this._zoomDelta.y<0&&this.zoomOut(this.getZoomScale()),this._zoomStart.copy(this._zoomEnd),this.update()}},{key:"handleMouseMovePan",value:function(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart),this.pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}},{key:"handleMouseWheel",value:function(e){e.deltaY<0?this.zoomOut(this.getZoomScale()):e.deltaY>0&&this.zoomIn(this.getZoomScale()),this.update()}},{key:"handleKeyDown",value:function(e){switch(e.keyCode){case this.keys.UP:this.pan(0,this.keyPanSpeed),this.update();break;case this.keys.BOTTOM:this.pan(0,-this.keyPanSpeed),this.update();break;case this.keys.LEFT:this.pan(this.keyPanSpeed,0),this.update();break;case this.keys.RIGHT:this.pan(-this.keyPanSpeed,0),this.update()}}},{key:"handleTouchStartRotate",value:function(e){this._rotateStart.set(e.touches[0].pageX,e.touches[0].pageY)}},{key:"handleTouchStartZoom",value:function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);this._zoomStart.set(0,r)}},{key:"handleTouchStartPan",value:function(e){this._panStart.set(e.touches[0].pageX,e.touches[0].pageY)}},{key:"handleTouchMoveRotate",value:function(e){this._rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart);var t=this.domElement===document?this.domElement.body:this.domElement;this.rotateLeft(2*Math.PI*this._rotateDelta.x/t.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this._rotateDelta.y/t.clientHeight*this.rotateSpeed),this._rotateStart.copy(this._rotateEnd),this.update()}},{key:"handleTouchMoveZoom",value:function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);this._zoomEnd.set(0,r),this._zoomDelta.subVectors(this._zoomEnd,this._zoomStart),this._zoomDelta.y>0?this.zoomOut(this.getZoomScale()):this._zoomDelta.y<0&&this.zoomIn(this.getZoomScale()),this._zoomStart.copy(this._zoomEnd),this.update()}},{key:"handleTouchMovePan",value:function(e){this._panEnd.set(e.touches[0].pageX,e.touches[0].pageY),this._panDelta.subVectors(this._panEnd,this._panStart),this.pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}},{key:"onMouseDown",value:function(e){if(!1!==this.enable){switch(e.preventDefault(),this._isMouseUp=!1,e.button){case this.mouseButtons.ORBIT:if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this._state=this.STATE.ROTATE;break;case this.mouseButtons.ZOOM:if(!1===this.enableZoom)return;this.handleMouseDownZoom(e),this._state=this.STATE.ZOOM;break;case this.mouseButtons.PAN:if(!1===this.enablePan)return;this.handleMouseDownPan(e),this._state=this.STATE.PAN}this._state!==this.STATE.NONE&&this.controler.addListeners(this.mouseMoveUpListeners)}}},{key:"onMouseMove",value:function(e){if(!1!==this.enable)switch(e.preventDefault(),this._state){case this.STATE.ROTATE:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(e);break;case this.STATE.ZOOM:if(!1===this.enableZoom)return;this.handleMouseMoveZoom(e);break;case this.STATE.PAN:if(!1===this.enablePan)return;this.handleMouseMovePan(e)}}},{key:"onMouseUp",value:function(){!1!==this.enable&&(this._isMouseUp=!0,this.controler.removeListeners(this.mouseMoveUpListeners),this._state=this.STATE.NONE)}},{key:"onMouseWheel",value:function(e){!1===this.enable||!1===this.enableZoom||this._state!==this.STATE.NONE&&this._state!==this.STATE.ROTATE||(e.preventDefault(),e.stopPropagation(),this.handleMouseWheel(e))}},{key:"onKeyDown",value:function(e){!1!==this.enable&&!1!==this.enableKeys&&!1!==this.enablePan&&this.handleKeyDown(e)}},{key:"onTouchStart",value:function(e){if(!1!==this.enable)switch(this._isMouseUp=!1,e.touches.length){case 1:if(!1===this.enableRotate)return;this.handleTouchStartRotate(e),this._state=this.STATE.TOUCH_ROTATE;break;case 2:if(!1===this.enableZoom)return;this.handleTouchStartZoom(e),this._state=this.STATE.TOUCH_ZOOM;break;case 3:if(!1===this.enablePan)return;this.handleTouchStartPan(e),this._state=this.STATE.TOUCH_PAN;break;default:this._state=this.STATE.NONE}}},{key:"onTouchMove",value:function(e){if(!1!==this.enable)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===this.enableRotate)return;if(this._state!==this.STATE.TOUCH_ROTATE)return;this.handleTouchMoveRotate(e);break;case 2:if(!1===this.enableZoom)return;if(this._state!==this.STATE.TOUCH_ZOOM)return;this.handleTouchMoveZoom(e);break;case 3:if(!1===this.enablePan)return;if(this._state!==this.STATE.TOUCH_PAN)return;this.handleTouchMovePan(e);break;default:this._state=this.STATE.NONE}}},{key:"onTouchEnd",value:function(){!1!==this.enable&&(this._isMouseUp=!0,this._state=this.STATE.NONE)}},{key:"onContextMenu",value:function(e){!1!==this.enable&&e.preventDefault()}}]),e}();Object.assign(je,{getFilename:function(e){if(e){var t=e.toString().match(/.*\/(.+?)\./);if(t&&t.length>1)return t[1]}return""},getExtension:function(e){return e.split(".").pop().toLowerCase()},getBasename:function(e){return e.split(/[\\/]/).pop()},getBasepath:function(e){var t=je.getBasename(e);return e.slice(0,e.length-t.length)}}),Object.assign(je.prototype,{addFiles:function(e){var t=this;return e&&!Array.isArray(e)?this.addFile(e):e&&e.forEach(function(e){return Array.isArray(e)?t.addFiles(e):t.addFile(e)})},addFile:function(e){var t=e.file||e,n=e.type||je.getExtension(t),r=e.name||je.getFilename(t);this.files.indexOf(t)<0&&(this.files.push(t),this.items.push({file:t,type:n,name:r}))},load:function(){var e=[],t=[];return this.items.forEach(function(n){var r=n.name,i=n.file,o=n.type;if(!je.types[o])throw new Error('unsupport file format ".'+o+'", file path: '+i);var a=je.types[o](i);e.push(a),t.push(r)}),Promise.all(e).then(function(e){var n={};return e.forEach(function(e,r){n[t[r]]=e}),Promise.resolve(n)})}}),Object.assign(je,{decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);return decodeURIComponent(escape(t))},types:{obj:function(e){return fetch(e).then(function(e){return e.text()})},gltf:function(e){return fetch(e).then(function(e){return e.json()}).then(function(t){for(var n=t.buffers,r=new je,i=je.getBasepath(e),o=0;o<n.length;o++){var a=n[o].uri;if(!a.startsWith("data:")){var s=i+a;r.addFile({file:s,type:"gltf_bin",name:a})}}for(var u=t.images||[],h={},l=0;l<u.length;l++){var c=u[l].uri;if(c&&!c.startsWith("data:")){var f=i+c;h[c]=f}}return r.load().then(function(e){return Object.assign(e,h),t.resources=e,t})})},gltf_bin:function(e){return fetch(e).then(function(e){return e.arrayBuffer()})},glb:function(e){var t=this;return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(n){var r=1313821514,i=5130562,o=null,a=null,s=new DataView(n,0,12);if(t.header={magic:je.decodeText(new Uint8Array(n.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},"glTF"!==t.header.magic)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(t.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var u=new DataView(n,12),h=0;h<u.byteLength;){var l=u.getUint32(h,!0);h+=4;var c=u.getUint32(h,!0);if(h+=4,c===r){var f=new Uint8Array(n,12+h,l);o=je.decodeText(f)}else if(c===i){var d=12+h;a=n.slice(d,d+l)}h+=l}if(o){var m=JSON.parse(o);if(m.buffers&&a)for(var p=0;p<m.buffers.length;p++){var v=m.buffers[p];void 0===v.uri&&(v.isParsed=!0,v.dbuffer=a)}for(var _=m.buffers,g=new je,b=je.getBasepath(e),y=0;y<_.length;y++)if(!_[y].isParsed){var E=_[y].uri;if(!E.startsWith("data:")){var M=b+E;g.addFile({file:M,type:"gltf_bin",name:E})}}for(var A=m.images||[],T={},x=0;x<A.length;x++){var R=A[x].uri;if(R&&!R.startsWith("data:")){var O=b+R;T[R]=O}}return g.load().then(function(e){return Object.assign(e,T),m.resources=e,m})}throw new Error("GLTFLoader: bin file do not have gltf json.")})}}}),Object.assign(He.prototype,{init:function(e){this.line=e.trim().split(" ")},getType:function(){return this.line[0]},getFloatData:function(e){var t=e;for(this.cArray=[];t>0;)this.cArray.unshift(parseFloat(this.line[t--]));return this.cArray}});var xn={flipYUV:!0};Object.assign(xn,{load:function(e){return new je({file:e,name:"OBJLOADER"}).load().then(function(e){return xn.parse(e.OBJLOADER)})},parse:function(e,t){var n=void 0===t?xn.flipYUV:t,r=e.split("\n");r.push(null);var i=void 0,o=0,a=null,s=[],u=[],h=[],l=[],c=[],f=[],d=[],m=[],p={},v=0,_=!1,g=void 0,b=void 0,y=void 0;i=r[o++];for(var E=new He;null!==i;)switch(E.init(i),i=r[o++],E.getType()){case"v":u=u.concat(E.getFloatData(3));continue;case"vt":h=h.concat(E.getFloatData(2));continue;case"vn":l=l.concat(E.getFloatData(3));continue;case"f":if(E.line.shift(),E.line.length<3)continue;for(_=!1,g=0;g<E.line.length;g++){if(g>3){console.error("OBJ Loader not support multiple vertices face!");break}3!==g||_||(g=2,_=!0),E.line[g]in p?m.push(p[E.line[g]]):(b=E.line[g].split("/"),y=3*(parseInt(b[0],10)-1),c.push(u[y],u[y+1],u[y+2]),y=3*(parseInt(b[2],10)-1),d.push(l[y],l[y+1],l[y+2]),""!==b[1]&&(y=2*(parseInt(b[1],10)-1),f.push(h[y],n?1-h[y+1]:h[y+1])),p[E.line[g]]=v,m.push(v),v++),3===g&&_&&m.push(p[E.line[0]])}continue;case"o":case"g":if(null!==a){var M={a_position:{data:c.slice()},indices:{data:m.slice()}};f.length>0&&(M.a_uv={data:f.slice()}),d.length>0&&(M.a_normal={data:d.slice()}),s.push(new te(a,M))}a=E.line[1],c.length=0,m.length=0,f.length=0,d.length=0,v=0;continue;default:continue}if(null!==a){var A={a_position:{data:c},indices:{data:m}};f.length>0&&(A.a_uv={data:f}),d.length>0&&(A.a_normal={data:d}),s.push(new te(a,A))}return s}});var Rn=0;Object.defineProperties(Ge.prototype,{position:{get:function(){return this.transform.position},set:function(e){this.setPosition(e)}},quaternion:{get:function(){return this.transform.quaternion},set:function(e){this.setQuaternion(e)}},scale:{get:function(){return this.transform.scale},set:function(e){return this.setScale(e)}}}),Object.assign(Ge,{remove:function(e){if(e.parent){var t=e.parent.children.indexOf(e);t>-1&&e.parent.children.splice(t,1),e.parent=null}else e=void 0},updateWorldMatrix:function(e,t){e.needUpdateWorldMatrix&&(t?(e.transform.updateMatrix(),r.mult(e.worldMatrix.raw,t.worldMatrix.raw,e.matrix.raw)):r.copy(e.worldMatrix.raw,e.matrix.raw))},updateNormalAndDirection:function(e){e.needUpdateWorldMatrix&&(e.transform.updateNormalMatrix().updateDirection(),e.needUpdateWorldMatrix=!1)},updateMatrixMarker:function(e,t){(e.transform._needUpdateMatrix||t&&t.needUpdateWorldMatrix)&&(e.needUpdateWorldMatrix=!0)},afterUpdateMatrix:function(e,t){"function"==typeof e.afterUpdateMatrix&&e.afterUpdateMatrix(e,t)}}),Object.assign(Ge.prototype,{traverse:function(e){e(this,this.parent);for(var t=0;t<this.children.length;t++)this.children[t].traverse(e)},traversePostOrder:function(e){for(var t=0;t<this.children.length;t++)this.children[t].traversePostOrder(e);e(this,this.parent)},traverseTwoExeFun:function(e,t){e(this,this.parent);for(var n=0;n<this.children.length;n++)this.children[n].traverseTwoExeFun(e,t);t(this,this.parent)},remove:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return Ge.remove(e),this},addToParent:function(e){return this.parent&&Ge.remove(this),e.children.push(this),node.parent=this,this},addChild:function(e){var t=e;return("string"==typeof e||e.isModel)&&(t=new Ge(e)),t.parent&&Ge.remove(t),this.children.push(t),t.parent=this,this},setPosition:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n[0]instanceof Ge?this.setPosition.apply(this,Zt(n[0].position)):((e=this.transform).setPosition.apply(e,n),this)},setQuaternion:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n[0]instanceof Ge?this.setQuaternion.apply(this,Zt(n[0].quaternion)):((e=this.transform).setQuaternion.apply(e,n),this)},setScale:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n[0]instanceof Ge?this.setScale.apply(this,Zt(n[0].scale)):((e=this.transform).setScale.apply(e,n),this)},updateMatrix:function(){return this.traverse(Ge.updateMatrixMarker),this.traverseTwoExeFun(Ge.updateWorldMatrix,Ge.updateNormalAndDirection),this.traverse(Ge.afterUpdateMatrix),this},setModel:function(e){return this.transform&&e.setTransform(this.transform.clone()),e.node=this,this.model=e,this.name=this.model.name,this.transform=this.model.transform,this.matrix=this.transform.matrix,this.worldMatrix=this.transform.worldMatrix,this.needUpdateWorldMatrix=this.transform.needUpdateWorldMatrix,this},findInChildren:function(e,t){var n=!1;return this.traverse(function(r){n||void 0!==r[e]&&r[e]===t&&(n=r)}),n}}),Object.defineProperties(Ve,{version:{get:function(){return this.version?this.version:this.json?this.json.asset?(this.version=this.json.asset.version,this.json.asset.minVersion&&(this.version+="\r minVersion"+this.json.asset.minVersion),this.version):We("asset"):(console.warn("glTF not loaded."),null)}},generator:{get:function(){return this._generator}}}),Object.assign(Ve.prototype,{load:function(e,t){var n=this;return new je({file:e,name:"GLTFLOADER"}).load().then(function(e){return n.parse(e.GLTFLOADER,t)})},parse:function(e,t){this.gltf=e;var n=this.gltf.asset,r=n.version,i=n.generator;if(this._generator=i,"2.0"!==r)return console.error("GlTFLoader only support glTF 2.0 for now! Received glTF version: "+this.version),!1;var o={nodes:this.parseScene(t),animations:this.parseAnimations(),name:this.currentSceneName};return this.convertToNode(o)},parseAnimations:function(){var e=[],t=this.gltf.animations;if(t)for(var n=0;n<t.length;n++){var r=t[n],i=r.name,o=r.channels,a=r.samplers,s=[];if(o&&a)for(var u=0;u<o.length;u++){var h=o[u],l=a[h.sampler];if(l){var c=this.parseAccessor(l.input).data,f=this.parseAccessor(l.output),d=f.data,m=f.numComponents,p=l.interpolation||"LINEAR",v=h.target.node,_=h.target.path;if(c&&d){var g=d;if(1!==m||c.length!==d.length){var b=d.length/c.length;g=[];for(var y=0;y<c.length;y++)g.push(d.slice(b*y,b*(y+1)))}var E=_,M={};switch(_){case"translation":E="position";break;case"rotation":E="quaternion";break;case"scale":E="scale";break;case"weights":E="weights",M.uniformName=Ve.MORPH_WEIGHT_UNIFORM;break;default:console.error("unsupported animation sampler path "+_),E=!1}if(E){var A={times:c,values:g,findFlag:Ve.GLTF_NODE_INDEX_PROPERTY,findValue:v,targetProp:E,method:p,extras:M};s.push(A)}}}else We("animations["+n+"].channels["+u+"].sampler",h.sampler)}e.push({name:i||String(n),clips:s})}return e},parseScene:function(e){var t=e||this.gltf.scene||0,n=this.gltf.scenes[t];if(void 0===n)return We("scene",t);this.currentSceneName=n.name||"GLTF_NO_NAME_SCENE";for(var r=[],i=n.nodes,o=0;o<i.length;o++){var a=this.parseNode(i[o]);a&&r.push(a)}return r},convertToNode:function(e){function t(e,n,r){for(var i=0;i<r.length;i++){t(e,e(r[i],n),r[i].children)}}var n=new Ge(e.name),i=e.nodes,o=e.animations,a=[],s=[];if(t(function(e,t){var n=new Ge(e.name);if(n[Ve.GLTF_NODE_INDEX_PROPERTY]=e.nodeId,e.matrix&&(e.translation=[0,0,0],e.rotation=[0,0,0,1],e.scale=[1,1,1],r.decompose(e.matrix,e.translation,e.rotation,e.scale)),e.translation&&(n.position=e.translation),e.rotation&&(n.quaternion=e.rotation),e.scale&&(n.scale=e.scale),t.addChild(n),e.primitives){for(var i,o=[],u=0;u<e.primitives.length;u++){var h=e.primitives[u],l=h.attribArrays,c=h.modelName,f=h.drawMode;if(!h.attribArrays.mesh){var d=new te(h.meshName,l);h.attribArrays={attribArrays:l,mesh:d}}var m=new Q(h.attribArrays.mesh);m.name=c,m.drawMode=f;var p={},v=e.skin&&e.skin.defines||[];if(m.defines=h.defines.concat(v),h.material){var _=h.material,g=_.baseColorTexture,b=_.baseColorFactor,y=_.metallicFactor,E=_.roughnessFactor,M=_.doubleSided,A=_.metallicRoughnessTexture,T=_.normalTexture,x=_.occlusionTexture,R=_.emissiveTexture,O=_.enableBlend,P=_.alphaCutoff;if(m.mesh.cullFace=!M,m.mesh.sampleBlend=!!O,void 0!==P&&(p[Ve.ALPHA_CUTOFF_UNIFORM]=P),p[Ve.BASE_COLOR_UNIFORM]=b,p[Ve.METALROUGHNESS_UNIFORM]=[y,E],g&&g.texture){var w=a.indexOf(g.texture);w<0&&(a.push(g.texture),g.textureIdx=a.length-1),m.textures||(m.textures={}),void 0===g.textureIdx&&(g.textureIdx=w),m.textures[Ve.BASE_COLOR_TEXTURE_UNIFORM]=g.textureIdx}if(A&&A.texture){var I=a.indexOf(A.texture);I<0&&(a.push(A.texture),A.textureIdx=a.length-1),m.textures||(m.textures={}),void 0===A.textureIdx&&(A.textureIdx=I),m.textures[Ve.METALROUGHNESS_TEXTURE_UNIFORM]=A.textureIdx}if(T&&T.texture){var F=a.indexOf(T.texture);F<0&&(a.push(T.texture),T.textureIdx=a.length-1),m.textures||(m.textures={}),void 0===T.textureIdx&&(T.textureIdx=F),m.textures[Ve.NORMAL_TEXTURE_UNIFORM]=T.textureIdx,p[Ve.NORMAL_SCALE_UNIFORM]=T.scale}if(x&&x.texture){var S=a.indexOf(x.texture);S<0&&(a.push(x.texture),x.textureIdx=a.length-1),m.textures||(m.textures={}),void 0===x.textureIdx&&(x.textureIdx=S),m.textures[Ve.OCCLUSION_TEXTURE_UNIFORM]=x.textureIdx,p[Ve.OCCLUSION_FACTOR_UNIFORM]=x.strength}if(R&&R.texture){var N=a.indexOf(R.texture);N<0&&(a.push(R.texture),R.textureIdx=a.length-1),m.textures||(m.textures={}),void 0===R.textureIdx&&(R.textureIdx=N),m.textures[Ve.EMISSIVE_TEXTURE_UNIFORM]=R.textureIdx,p[Ve.EMISSIVE_FACTOR_UNIFORM]=R.emissiveFactor}}h.weights&&(p[Ve.MORPH_WEIGHT_UNIFORM]=h.weights),m.setUniformObj(p),e.primitives.length<2?n.setModel(m):n.addChild(m),o.push(m)}n.children.length>0&&(n.gltfPrimitives=n.children),e.skin&&(s.indexOf(e.skin)>-1?(i=e.skin.models).push.apply(i,o):(n.skin=Object.assign(e.skin,{models:o}),s.push(n.skin)))}return n},n,i),s.length){for(var u=s.length,h=[],l=function(e){for(var t=s[e],i=t.joints,o=t.skeleton,a=t.inverseBindMatrices,u=t.models,l=i.length,c=[],f=0;f<l;f++)c[f]=n.findInChildren(Ve.GLTF_NODE_INDEX_PROPERTY,i[f]);var d=!1;o!==Ve.SCENE_ROOT_SKELETON?(d=n.findInChildren(Ve.GLTF_NODE_INDEX_PROPERTY,o)).parent!==n&&(d=d.parent):d=n;var m=new Array(16),p=new Array(16);h[e]=function(){var e=[];r.invert(p,d.transform.getWorldMatrix());for(var t=0;t<l;t++)r.mult(m,p,c[t].transform.getWorldMatrix()),a[t]!==Ve.IDENTITY_INVERSE_BIND_MATRICES&&r.mult(m,m,a[t]),e=e.concat(m);var n={};n[Ve.JOINT_MATRICES_UNIFORM]=e,u.forEach(function(e){return e.setUniformObj(n)})}},c=0;c<s.length;c++)l(c);n.afterUpdateMatrix=function(){for(var e=0;e<u;e++)h[e]()}}return{rootNode:n,textures:a,animations:{animations:o,rootNode:n,type:"gltf"}}},parseNode:function(e){var t=this.gltf.nodes[e];if(!t)return We("node",e);if(t.isParsed)return t.dnode;var n={name:t.name,matrix:t.matrix,translation:t.translation,rotation:t.rotation,scale:t.scale,nodeId:e};if(void 0!==t.mesh&&(n.primitives=this.parseMesh(t.mesh)),void 0!==t.skin){var r=this.parseSkin(t.skin);r&&(n.skin=r)}if(n.children=[],t.children)for(var i=0;i<t.children.length;i++)n.children.push(this.parseNode(t.children[i]));return t.dnode=n,t.isParsed=!0,t.dnode},parseSkin:function(e){var t=this.gltf.skins[e];if(!t)return We("skin",e);if(t.isParsed)return t.dskin;var n=t.name,r=t.joints,i=t.inverseBindMatrices,o=t.skeleton;if(!r)return We("skin.joints",e);t.isParsed=!0,t.dskin=!1;var a={name:n,joints:r,defines:[Ve.getJointsNumDefine(r.length)]};if(a.skeleton=void 0===o?Ve.SCENE_ROOT_SKELETON:o,a.inverseBindMatrices=Ve.IDENTITY_INVERSE_BIND_MATRICES,void 0!==i){var s=this.parseAccessor(i);if(s){for(var u=s.data,h=[],l=0;l<u.length;l+=16)h.push(u.slice(l,l+16));a.inverseBindMatrices=h}else a=!1}return t.dskin=a,t.dskin},parseMesh:function(e){var t=this,n=this.gltf.meshes[e];if(!n)return We("mesh",e);if(n.isParsed)return n.dprimitives;for(var r=n.primitives,i=[],o=function(e){var o=r[e],a=o.attributes,s=o.indices,u=o.material,h=o.mode,l=o.name,c=o.targets,f={attribArrays:{},defines:[]},d=!1,m=!1,p=0,v=!1,_=0;if(Object.keys(a).forEach(function(e){var n=t.parseAccessor(a[e]);if(n){var r=void 0;switch(e){case"POSITION":r=_t;break;case"NORMAL":r=Et,d=!0;break;case"TANGENT":r="a_tangent",m=!0;break;case"TEXCOORD_0":r=bt,p++;break;case"TEXCOORD_1":r="a_uv1",p++;break;case"JOINTS_0":r="a_joint";break;case"JOINTS_1":r="a_joint1",v=!0;break;case"WEIGHTS_0":r="a_weight";break;case"WEIGHTS_1":r="a_weight1";break;case"COLOR_0":r="a_color",_=n.numComponents;break;default:r=e}f.attribArrays[r]=n}}),d&&f.defines.push(Ve.getHasNormalDefine()),m&&f.defines.push(Ve.getHasTangentDefine()),p&&f.defines.push(Ve.getTexCoordDefine(p)),v&&f.defines.push(Ve.getJointVec8Define()),_&&f.defines.push(Ve.getVertexColorDefine(_)),void 0!==s){var g=t.parseAccessor(s);g&&(f.attribArrays.indices=g)}var b=t.parseMaterial(u);if(b&&(f.material=b,f.defines=f.defines.concat(b.defines)),f.drawMode=void 0===h?4:h,f.meshName=l||Ve.getMeshNameCounter(),f.modelName=n.name||Ve.getModelNameCounter(),c){f.defines.push(Ve.getMorphTargetsDefine(c.length));for(var y=!1,E=!1,M=!1,A=function(e){var n=c[e];Object.keys(n).forEach(function(r){var i=t.parseAccessor(n[r]);if(i){var o=void 0;switch(r){case"POSITION":o=Ve.MORPH_POSITION_PREFIX+e,y=!0;break;case"NORMAL":o=Ve.MORPH_NORMAL_PREFIX+e,E=!0;break;case"TANGENT":o=Ve.MORPH_TANGENT_PREFIX+e,M=!0;break;default:o=!1}o?f.attribArrays[o]=i:console.error("glTF has unsupported morph target attribute "+r)}})},T=0;T<c.length;T++)A(T);y&&f.defines.push(Ve.getMorphtargetPositionDefine()),E&&f.defines.push(Ve.getMorphtargetNormalDefine()),M&&f.defines.push(Ve.getMorphtargetTangentDefine()),f.weights=n.weights||new Array(c.length).fill(0)}i.push(f)},a=0;a<r.length;a++)o(a);return n.dprimitives=i,n.isParsed=!0,n.dprimitives},parseAccessor:function(e){var t=this.gltf.accessors[e];if(!t)return We("accessor",e);if(t.isParsed)return t.daccessor;t.isParsed=!0,t.daccessor=!1;var n=!!t.normalized,r=this.gltf.bufferViews[t.bufferView],i=r&&r.byteStride,a=o(t.componentType),s=1;switch(t.type){case"SCALAR":s=1;break;case"VEC2":s=2;break;case"VEC3":s=3;break;case"VEC4":case"MAT2":s=4;break;case"MAT3":s=9;break;case"MAT4":s=16;break;default:s=0}if(0===s)return console.error("glTF has unknown data type in accessor: "+t.type),!1;var u=s*a.BYTES_PER_ELEMENT,h=void 0;if(void 0!==r){if(!(h=this.parseBufferView(t.bufferView)))return t.daccessor}else h=new Uint8Array(u*t.count).buffer;var l=this.getTypedArrayFromArrayBuffer(h,i,t.byteOffset||0,a,s,t.count);if(t.sparse){var c=t.sparse,f=c.count,d=c.indices,m=c.values;l=new a(l);for(var p=d.byteOffset||0,v=this.gltf.bufferViews[d.bufferView],_=o(d.componentType),g=this.parseBufferView(d.bufferView),b=this.getTypedArrayFromArrayBuffer(g,v.byteStride,p,_,1,f),y=m.byteOffset||0,E=this.gltf.bufferViews[m.bufferView],M=this.parseBufferView(m.bufferView),A=this.getTypedArrayFromArrayBuffer(M,E.byteStride,y,a,s,f),T=0;T<b.length;T++)l.set(A.slice(T*s,T*s+s),b[T]*s)}return t.computeResult={typedArray:l,arrayType:a,numComponents:s},t.daccessor={data:l,numComponents:s,normalize:n},t.daccessor},getTypedArrayFromArrayBuffer:function(e,t,n,r,i,o){var a=void 0,s=i*r.BYTES_PER_ELEMENT;if(t&&s!==t){a=new r(i*o);for(var u=0;u<o;u++)for(var h=new r(e,n+u*t,i),l=0;l<i;l++)a[u*i+l]=h[l]}else a=new r(e,n,o*i);return a},parseBufferView:function(e){var t=this.gltf.bufferViews[e];if(!t)return We("bufferView",e);if(t.isParsed)return t.dbufferView;t.isParsed=!0,t.dbufferView=!1;var n=this.parseBuffer(t.buffer);if(n){var r=t.byteOffset,i=t.byteLength,o=new Uint8Array(n,r||0,i);t.dbufferView=new Uint8Array(o).buffer}return t.dbufferView},BASE64_MARKER:";base64,",parseBuffer:function(e){var t=this.gltf.buffers[e];if(!t)return We("buffer",e);if(t.isParsed)return t.dbuffer;if(t.isParsed=!0,t.dbuffer=!1,"data:"!==t.uri.substr(0,5)){var n=t.uri,r=this.gltf.resources[n];r?r.byteLength===t.byteLength?t.dbuffer=this.gltf.resources[n]:console.error('load gltf resource "'+n+'" at buffers['+e+" failed, ArrayBuffer.byteLength not equals buffer's byteLength]"):console.error('load gltf resource "'+n+'" at buffers['+e+"] failed")}else{for(var i=t.uri.indexOf(this.BASE64_MARKER)+this.BASE64_MARKER.length,o=window.atob(t.uri.substr(i)),a=new Uint8Array(o.length),s=0;s<o.length;s++)a[s]=o.charCodeAt(s);t.dbuffer=a.buffer}return t.dbuffer},parseMaterial:function(e){var t=void 0;if(!(t=void 0===e?Ve.defaultMaterial:this.gltf.materials[e]))return We("material",e);if(t.isParsed)return t.dmaterial;var n=t,r=n.name,i=n.pbrMetallicRoughness,o=n.normalTexture,a=n.occlusionTexture,s=n.emissiveTexture,u=n.emissiveFactor,h=n.alphaMode,l=n.alphaCutoff,c={name:r,defines:[],doubleSided:!!n.doubleSided};if(h&&"OPAQUE"!==h&&("MASK"===h&&(c.defines.push(Ve.getAlphaMaskDefine()),c.alphaCutoff=void 0===l?.5:l),"BLEND"===h&&(c.defines.push(Ve.getAlphaBlendDdefine()),c.enableBlend=!0)),i){var f=i.baseColorFactor,d=i.metallicFactor,m=i.roughnessFactor,p=i.baseColorTexture,v=i.metallicRoughnessTexture;if(Object.assign(c,{baseColorFactor:f||[1,1,1,1],metallicFactor:void 0===d?1:d,roughnessFactor:void 0===m?1:m}),p){var _=this.parseTexture(p.index);_&&(c.baseColorTexture={texture:_,texCoord:p.texCoord||0},c.defines.push(Ve.getBaseColorTextureDefine()))}if(v){var g=this.parseTexture(v.index);g&&(c.metallicRoughnessTexture={texture:g,texCoord:v.texCoord||0},c.defines.push(Ve.getMetalRoughnessDefine()))}}else Object.assign(c,{baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1});if(o){var b=this.parseTexture(o.index);b&&(c.normalTexture={texture:b,texCoord:o.texCoord||0,scale:o.scale||1},c.defines.push(Ve.getNormalMapDefine()))}if(a){var y=this.parseTexture(a.index);y&&(c.occlusionTexture={texture:y,texCoord:a.texCoord||0,strength:a.strength||1},c.defines.push(Ve.getOcclusionMapDefine()))}if(s&&u){var E=this.parseTexture(s.index);E&&(c.emissiveTexture={texture:E,texCoord:s.texCoord||0,emissiveFactor:u},c.defines.push(Ve.getEmissiveMapDefine()))}return t.isParsed=!0,t.dmaterial=c,c},parseTexture:function(e){var t=this.gltf.textures[e];if(!t)return We("texture",e);if(t.isParsed)return t.dtexture;var n=t.source,r=t.sampler,i={},o=this.parseImage(n),a=this.parseSampler(r);return o&&a?(Object.assign(i,{src:o},a),t.isParsed=!0,t.dtexture=i,i):(i=!1,!1)},parseImage:function(e){var t=this.gltf.images[e];if(!t)return We("image",e);if(t.isParsed)return t.dimage;if(t.isParsed=!0,t.dimage=!1,!t.uri&&void 0!==t.bufferView){var n=this.parseBufferView(t.bufferView);if(n){var r=t.mimeType||"image/jpeg",i=new Uint8Array(n),o=new Blob([i],{type:r}),a=(window.URL||window.webkitURL).createObjectURL(o);t.dimage=a}}if(t.uri)if("data:"!==t.uri.substr(0,5)){var s=t.uri,u=this.gltf.resources[s];u&&(t.dimage=u)}else{var h=new window.Image;h.src=t.uri,t.dimage=h}return t.dimage},parseSampler:function(e){if(void 0===e)return{wrap:10497};var t=this.gltf.samplers[e];if(!t)return We("sampler",e);if(t.isParsed)return t.dsampler;var n=t.magFilter,r=t.minFilter,i=t.wrapS,o=t.wrapT,a={wrapS:i||10497,wrapT:o||10497};return r&&(a.min=r),n&&(a.mag=n),t.dsampler=a,t.isParsed=!0,a}}),Object.assign(Ve,{getMeshNameCounter:function(){var e=0;return function(){return"GLTF_NO_NAME_PRIMITIVE_"+e++}}(),getModelNameCounter:function(){var e=0;return function(){return"GLTF_NO_NAME_MESH_"+e++}}(),GLTF_NODE_INDEX_PROPERTY:"GLTF_NODE_INDEX",getTexCoordDefine:function(e){return"UV_NUM "+e},BASE_COLOR_UNIFORM:"u_baseColorFactor",BASE_COLOR_TEXTURE_UNIFORM:"u_baseColorSampler",METALROUGHNESS_UNIFORM:"u_metallicRoughnessValues",METALROUGHNESS_TEXTURE_UNIFORM:"u_metallicRoughnessSampler",NORMAL_TEXTURE_UNIFORM:"u_normalSampler",NORMAL_SCALE_UNIFORM:"u_normalScale",EMISSIVE_TEXTURE_UNIFORM:"u_emissiveSampler",EMISSIVE_FACTOR_UNIFORM:"u_emissiveFactor",OCCLUSION_TEXTURE_UNIFORM:"u_occlusionSampler",OCCLUSION_FACTOR_UNIFORM:"u_occlusionFactor",getVertexColorDefine:function(e){return"HAS_VERTEXCOLOR "+e},getBaseColorTextureDefine:function(){return"HAS_BASECOLORMAP"},getMetalRoughnessDefine:function(){return"HAS_METALROUGHNESSMAP"},getNormalMapDefine:function(){return"HAS_NORMALMAP"},getEmissiveMapDefine:function(){return"HAS_EMISSIVEMAP"},getOcclusionMapDefine:function(){return"HAS_OCCLUSIONMAP"},MAX_MORPH_TARGETS:8,MORPH_POSITION_PREFIX:"a_morphPositions_",MORPH_NORMAL_PREFIX:"a_morphNromals_",MORPH_TANGENT_PREFIX:"a_morphTangents_",MORPH_WEIGHT_UNIFORM:"u_morphWeights",getMorphTargetsDefine:function(e){return"MORPH_TARGET_NUM "+e},getMorphtargetPositionDefine:function(){return"HAS_MORPH_POSITION"},getMorphtargetNormalDefine:function(){return"HAS_MORPH_NORMAL"},getMorphtargetTangentDefine:function(){return"HAS_MORPH_TANGENT"},SCENE_ROOT_SKELETON:"SCENE_ROOT",IDENTITY_INVERSE_BIND_MATRICES:"IDENTITY_IBM",getJointsNumDefine:function(e){return"JOINTS_NUM "+e},getJointVec8Define:function(){return"JOINT_VEC8"},JOINT_MATRICES_UNIFORM:"u_jointMatrix",getHasNormalDefine:function(){return"HAS_NORMAL"},getHasTangentDefine:function(){return"HAS_TANGENT"},getHasNormalMapDefine:function(){return"HAS_NORMAL_MAP"},ALPHA_CUTOFF_UNIFORM:"u_alphaCutoff",getAlphaMaskDefine:function(){return"ALPHA_MASK"},getAlphaBlendDdefine:function(){return"ALPHA_BLEND"},defaultMaterial:{name:"GLTF_DEFAULT_MATERIAL",emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,isParsed:!0,dmaterial:{name:"GLTF_DEFAULT_MATERIAL",defines:[],doubleSided:!1,baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1,emissiveFactor:[0,0,0]}}}),Object.assign(Xe.prototype,{render:function(){return this.model.transform.updateMatrix().copyToWorldMatrix(),this.shader.renderModel(this.model),this},setData:function(e){var t=e;if(e.data&&(t=e.data,e.numComponents&&3!==e.numComponents)){if(4!==e.numComponents)return console.error("array data numElement nor 3 or 4 for PointHelper."),null;t=[];for(var n=0;n<e.data.length/4;n++)t.push(e.data[4*n],e.data[4*n+1],e.data[4*n+2])}t=a(t),this.mesh.attribArrays[_t].data=t;var r=this.mesh.bufferInfo;if(r){var i=r.attribs[_t].buffer;X(this.gl,i,t),r.numElements=t.length/3}return this}});Ye.prototype=Object.assign(Object.create(q.prototype),{constructor:Ye,setColors:function(e){return this.setUniformObj({u_colors:e}),1!==e[3]||1!==e[7]?this.blend=!0:this.blend=!1,this}}),Object.assign(Ye,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\n\nuniform mat4 u_mvpMat;\nuniform vec4 u_colors[2];\n\nout vec4 v_color;\n\nvoid main() {\n    v_color = u_colors[gl_VertexID % 2];\n    gl_Position = u_mvpMat * vec4(a_position, 1.0);\n}\n",fs:"#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\n\nin vec4 v_color;\n\nlayout(location = 0) out vec4 finalColor;\n\n#ifdef ColorPick\nuniform vec3 u_colorId;\nlayout(location = 1) out vec4 pickColor;\n#endif\n\nvoid main() {\n    finalColor = v_color;\n\n    #ifdef ColorPick\n    pickColor = vec4(u_colorId, 1.0);\n    #endif\n}\n"}),Object.assign(qe.prototype,{_getdata:function(e){var t=this,n=e;if(e.isModel&&(n=[e.positionInfo.data,e.normalInfo.data],this.setTransform(e.transform),this.copyToWorldMatrix=!1),e.isMesh&&(n=[e.attribArrays[_t].data,e.attribArrays[Et].data],this.copyToWorldMatrix=!1),n.length&&2===n.length){var r=[],i=n[0],o=n[1].map(function(e){return e*t.normalLength}),a=i.length,s=3;if(i.length===o.length){if(a%3==0)s=3;else{if(a%4!=0)return console.error("can not guess the vertex data for LineHelper !"),null;s=4}for(var u=0;u<a/s;u++)r.push(i[u*s],i[u*s+1],i[u*s+2]),r.push(i[u*s]+o[u*s],i[u*s+1]+o[u*s+1],i[u*s+2]+o[u*s+2]);return r}if(Math.max(i.length,o.length)%4==0&&Math.min(i.length,o.length)%3==0&&Math.max(i.length,o.length)/4==Math.min(i.length,o.length)/3){for(var h=Math.max(i.length,o.length)/4,l=i.length>o.length?4:3,c=4===l?3:4,f=0;f<h;f++)r.push(i[f*l],i[f*l+1],i[f*l+2]),r.push(i[f*l]+o[f*c],i[f*l+1]+o[f*c+1],i[f*l+2]+o[f*c+2]);return r}}return e},render:function(){return this.model.transform.updateMatrix(),this.copyToWorldMatrix&&this.model.transform.copyToWorldMatrix(),this.shader.renderModel(this.model),this},setTransform:function(e){return this.model&&this.model.setTransform(e),this},setData:function(e){this.copyToWorldMatrix=!0;var t=this._getdata(e),n=a(t),r=this.mesh.bufferInfo;if(this.mesh.attribArrays[_t].data=n,r){var i=r.attribs[_t].buffer;X(this.gl,i,n),r.numElements=t.length/3}return this}}),Object.assign(Ze.prototype,{dot2:function(e,t){return this.x*e+this.y*t},dot3:function(e,t,n){return this.x*e+this.y*t+this.z*n}});var On=[new Ze(1,1,0),new Ze(-1,1,0),new Ze(1,-1,0),new Ze(-1,-1,0),new Ze(1,0,1),new Ze(-1,0,1),new Ze(1,0,-1),new Ze(-1,0,-1),new Ze(0,1,1),new Ze(0,-1,1),new Ze(0,1,-1),new Ze(0,-1,-1)],Pn=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],wn=new Array(512),In=new Array(512),Fn=.5*(Math.sqrt(3)-1),Sn=(3-Math.sqrt(3))/6,Nn={};Object.assign(Nn,{seed:function(e){e>0&&e<1&&(e*=65536);for(var t=void 0,n=0;n<256;n++)t=1&n?Pn[n]^255&e:Pn[n]^e>>8&255,wn[n]=wn[n+256]=t,In[n]=In[n+256]=On[t%12]},simplex2:function(e,t){var n=void 0,r=void 0,i=void 0,o=(e+t)*Fn,a=Math.floor(e+o),s=Math.floor(t+o),u=(a+s)*Sn,h=e-a+u,l=t-s+u,c=void 0,f=void 0;h>l?(c=1,f=0):(c=0,f=1);var d=h-c+Sn,m=l-f+Sn,p=h-1+2*Sn,v=l-1+2*Sn,_=In[(a&=255)+wn[s&=255]],g=In[a+c+wn[s+f]],b=In[a+1+wn[s+1]],y=.5-h*h-l*l;n=y<0?0:(y*=y)*y*_.dot2(h,l);var E=.5-d*d-m*m;r=E<0?0:(E*=E)*E*g.dot2(d,m);var M=.5-p*p-v*v;return i=M<0?0:(M*=M)*M*b.dot2(p,v),70*(n+r+i)},simplex3:function(e,t,n){var r=void 0,i=void 0,o=void 0,a=void 0,s=(e+t+n)*(1/3),u=Math.floor(e+s),h=Math.floor(t+s),l=Math.floor(n+s),c=(u+h+l)*(1/6),f=e-u+c,d=t-h+c,m=n-l+c,p=void 0,v=void 0,_=void 0,g=void 0,b=void 0,y=void 0;f>=d?d>=m?(p=1,v=0,_=0,g=1,b=1,y=0):f>=m?(p=1,v=0,_=0,g=1,b=0,y=1):(p=0,v=0,_=1,g=1,b=0,y=1):d<m?(p=0,v=0,_=1,g=0,b=1,y=1):f<m?(p=0,v=1,_=0,g=0,b=1,y=1):(p=0,v=1,_=0,g=1,b=1,y=0);var E=f-p+1/6,M=d-v+1/6,A=m-_+1/6,T=f-g+1/6*2,x=d-b+1/6*2,R=m-y+1/6*2,O=f-1+.5,P=d-1+.5,w=m-1+.5,I=In[(u&=255)+wn[(h&=255)+wn[l&=255]]],F=In[u+p+wn[h+v+wn[l+_]]],S=In[u+g+wn[h+b+wn[l+y]]],N=In[u+1+wn[h+1+wn[l+1]]],C=.6-f*f-d*d-m*m;r=C<0?0:(C*=C)*C*I.dot3(f,d,m);var L=.6-E*E-M*M-A*A;i=L<0?0:(L*=L)*L*F.dot3(E,M,A);var U=.6-T*T-x*x-R*R;o=U<0?0:(U*=U)*U*S.dot3(T,x,R);var k=.6-O*O-P*P-w*w;return a=k<0?0:(k*=k)*k*N.dot3(O,P,w),32*(r+i+o+a)},perlin2:function(e,t){var n=Math.floor(e),r=Math.floor(t);e-=n,t-=r;var i=In[(n&=255)+wn[r&=255]].dot2(e,t),o=In[n+wn[r+1]].dot2(e,t-1),a=In[n+1+wn[r]].dot2(e-1,t),s=In[n+1+wn[r+1]].dot2(e-1,t-1),u=Ke(e);return Qe(Qe(i,a,u),Qe(o,s,u),Ke(t))},perlin3:function(e,t,n){var r=Math.floor(e),i=Math.floor(t),o=Math.floor(n);e-=r,t-=i,n-=o;var a=In[(r&=255)+wn[(i&=255)+wn[o&=255]]].dot3(e,t,n),s=In[r+wn[i+wn[o+1]]].dot3(e,t,n-1),u=In[r+wn[i+1+wn[o]]].dot3(e,t-1,n),h=In[r+wn[i+1+wn[o+1]]].dot3(e,t-1,n-1),l=In[r+1+wn[i+wn[o]]].dot3(e-1,t,n),c=In[r+1+wn[i+wn[o+1]]].dot3(e-1,t,n-1),f=In[r+1+wn[i+1+wn[o]]].dot3(e-1,t-1,n),d=In[r+1+wn[i+1+wn[o+1]]].dot3(e-1,t-1,n-1),m=Ke(e),p=Ke(t),v=Ke(n);return Qe(Qe(Qe(a,l,m),Qe(s,c,m),v),Qe(Qe(u,f,m),Qe(h,d,m),v),p)}}),Nn.seed(0);var Cn={};Object.assign(Cn,{createModel:function(e,t,n,r,i,o){var a=new Q(Cn.createMesh(e,t,n,r,i,o));return Object.assign(a,{setTime:function(e,t){return Cn.setTime(e,this.mesh,t),this},addTime:function(e,t){return Cn.addTime(e,this.mesh,t),this}})},createMesh:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6,o=arguments[5],a=o&&o.minHeight||0,s=o&&o.maxHeight||1,u=o&&o.baseHeight||0,h=o&&o.perlinFreq||10,l=o&&o.time||Math.random(),c=n/-2,f=t/-2,d=r*i,m=(r-1)*i,p=n/(r-1),v=t/(i-1),_=0,g=0,b=[],y=[],E=[],M=1/(i-1),A=1/(r-1),T=void 0,x=0;x<d;x++)_=Math.floor(x/i),g=x%i,T=u+Lt.map(Nn.perlin3(_/h,g/h,l/h),0,1,a,s),b.push(f+g*v,T,c+_*p),E.push(g===i-1?.9999:g*M,_===r-1?.9999:_*A),x<m&&(y.push(_*i+g,(_+1)*i+g),g===i-1&&x<m-1&&y.push((_+1)*i+g,(_+1)*i));var R=Je(b,r,i,s-a),O={indices:{data:y}};O[_t]={data:b,drawType:35048},O[bt]={data:E},O[Et]={data:R};var P=new te(e||"Terrain",O,{drawMode:5});return Object.assign(P,{time:l,minHeight:a,maxHeight:s,baseHeight:u,perlinFreq:h,rowCount:r,colCount:i})},setTime:function(e,t,n){for(var r=t.attribArrays[_t].data,i=r.length/3,o=t.minHeight,s=t.maxHeight,u=t.baseHeight,h=t.perlinFreq,l=t.rowCount,c=t.colCount,f=void 0,d=void 0,m=0;m<i;m++)f=Math.floor(m/c),d=m%c,r[3*m+1]=u+Lt.map(Nn.perlin3(f/h,d/h,n/h),0,1,o,s);var p=Je(r=a(r),l,c,s-o);p=a(p),t.time=n,t.attribArrays[Et].data=p,t.attribArrays[_t].data=r;var v=t.bufferInfo;if(v){X(e,v.attribs[_t].buffer,r);X(e,v.attribs[Et].buffer,p)}return t},addTime:function(e,t,n){return Cn.setTime(e,t,t.time+n)}});var Ln=[{format:6408,type:5121,min:9729,wrap:33071},{format:34041}],Un={};Un[34041]=33306,Un[6401]=36128,Un[36168]=36128,Un[6402]=36096,Un[33189]=36096;var kn={};kn[32854]=!0,kn[32855]=!0,kn[36194]=!0,kn[34041]=!0,kn[33189]=!0,kn[6401]=!0,kn[36168]=!0;var Bn=void 0,Dn=void 0;Object.assign(st.prototype,{blankId:0,maxId:16777215,id2Color:ot,color2Id:at,addModels:function(){if(this.models.length>=this.maxId-1)throw new Error("Color picker models length bigger than max length "+(this.maxId-1));for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;r++)Array.isArray(t[r])?this.addModels.apply(this,Zt(t[r])):this.models.push(t[r]);return this},removeModels:function(){for(var e=-1,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;i++)Array.isArray(n[i])?this.removeModels.apply(this,Zt(n[i])):(e=this.models.indexOf(n[i]))>-1&&this.models.splice(e,1);return this},clear:function(){return nt(this.gl,this.framebufferInfo),Le(this.gl),nt(this.gl,null),this},render:function(){var e=this;return nt(this.gl,this.framebufferInfo),this.shader.updateCamera(),this.models.forEach(function(t,n){e.shader.setColor(e.id2Color(n+1)).renderModel(t)}),nt(this.gl,null),this},pick:function(e,t){var n=rt(this.gl,this.framebufferInfo,e,this.gl.canvas.clientHeight-t),r=this.color2Id(n);console.log(e,t,n,r,this.models[r-1])},updateCanvasParam:function(){var e=this.canvas.getBoundingClientRect();return this.offsetX=e.left,this.offsetY=e.top,this.lastCanvasWidth=this.canvas.clientWidth,this.lastCanvasHeight=this.canvas.clientWidth,this},onmouseclick:function(e){if(this.isActive){var t=e.pageX-this.offsetX,n=e.pageY-this.offsetY;this.needPick=!0,this.pickx=t,this.picky=n}},dispose:function(){return this.controler.removeListeners(this.eventListeners),this},update:function(){return this.needPick&&(this.canvas.clientWidth===this.lastCanvasWidth&&this.canvas.clientHeight===this.lastCanvasHeight||(this.resizeFramebufferInfo(this.canvas.clientWidth,this.canvas.clientHeight),this.updateCanvasParam()),this.clear().render(),this.pick(this.pickx,this.picky),this.needPick=!1),this},activate:function(){return this.isActive=!0,this.updateCanvasParam(),this},deactivate:function(){return this.isActive=!1,this},resizeFramebufferInfo:function(e,t){return it(this.gl,this.framebufferInfo,void 0,e,t),this}});ut.prototype=Object.assign(Object.create(q.prototype),{constructor:ut,setFlipy:function(e){this.setUniformObj({u_flipy:!!e})}}),Object.assign(ut,{vs:"#version 300 es\n#define GLSLIFY 1\nin vec3 a_position;\nin vec2 a_uv;\n\nout highp vec2 v_uv;\n\nvoid main() {\n    v_uv = a_uv;\n    gl_Position = vec4(a_position, 1.0);\n}\n",fs:'#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\n\nin highp vec2 v_uv;\n\n#ifdef FXAA\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2D2DLod stuff was removed since it\'s\nunsupported by WebGL.\n--\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\nCopyright (c) 2011 by Armin Ronacher.\nSome rights reserved.\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture2D2D reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE,\n            vec2 v_rgbSW, vec2 v_rgbSE,\n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture(tex, v_rgbSE).xyz;\n    vec4 texColor = texture(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n        texture(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n\t\t\tout vec2 v_rgbNW, out vec2 v_rgbNE,\n\t\t\tout vec2 v_rgbSW, out vec2 v_rgbSE,\n\t\t\tout vec2 v_rgbM) {\n\tvec2 inverseVP = 1.0 / resolution.xy;\n\tv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n\tv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n\tv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n\tv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n\tv_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvec4 apply(sampler2D tex, vec2 fragCoord, vec2 resolution) {\n\tmediump vec2 v_rgbNW;\n\tmediump vec2 v_rgbNE;\n\tmediump vec2 v_rgbSW;\n\tmediump vec2 v_rgbSE;\n\tmediump vec2 v_rgbM;\n\n\t//compute the texture2D2D coords\n\ttexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n\t//compute FXAA\n\treturn fxaa(tex, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n\nuniform vec2 u_resolution;\n#endif\n\nuniform sampler2D u_texture;\nuniform bool u_flipy;\n\nlayout(location = 0) out vec4 finalColor;\n\nvoid main() {\n    vec2 uv = vec2(v_uv.s, u_flipy ? (1.0 - v_uv.t) : v_uv.t );\n    \n    #ifdef FXAA\n        vec2 fragCoord = uv * u_resolution;\n        finalColor = apply(u_texture, fragCoord, u_resolution);\n    #else\n        finalColor = texture(u_texture, uv);\n    #endif\n}\n'}),Object.assign(ht.prototype,{blankColor:ot(0),id2Color:ot,color2Id:at,pick:function(e,t){var n=this.framebufferInfo.width/this.canvas.clientWidth,r=rt(this.gl,this.framebufferInfo,e*n,this.gl.canvas.height-t*n,this.bufferIdx),i=this.color2Id(r);console.log(e,t,r,i,this.models[i-1])},updateCanvasParam:function(){var e=this.canvas.getBoundingClientRect();return this.offsetX=e.left,this.offsetY=e.top,this.lastCanvasWidth=this.canvas.width,this.lastCanvasHeight=this.canvas.height,this},dispose:function(){return this.controler.removeListeners(this.eventListeners),this},setActivate:function(e){return e?(this.isActive=!0,this.updateCanvasParam()):this.isActive=!1,this},onmouseclick:function(e){if(this.isActive){this.canvas.width===this.lastCanvasWidth&&this.canvas.height===this.lastCanvasHeight||this.updateCanvasParam();var t=e.pageX-this.offsetX,n=e.pageY-this.offsetY;this.pick(t,n)}}});var zn={LEFT:0,MIDDLE:1,RIGHT:2};Object.assign(ft.prototype,{addListeners:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;r++)if(Array.isArray(t[r]))this.addListeners.apply(this,Zt(t[r]));else{var i=t[r];switch(i.type){case"mousedown":this.mouseDownListeners.addFunction(i.listener);break;case"mousemove":this.mouseMoveListeners.addFunction(i.listener);break;case"mouseup":this.mouseUpListeners.addFunction(i.listener);break;case"wheel":this.mouseWheelListeners.addFunction(i.listener);break;case"keydown":this.keydownListeners.addFunction(i.listener);break;case"keyup":this.keyupListeners.addFunction(i.listener);break;case"touchstart":this.touchStartListeners.addFunction(i.listener);break;case"touchend":this.touchEndListeners.addFunction(i.listener);break;case"touchmove":this.touchMoveListeners.addFunction(i.listener);break;case"mouseclick":this.mouseClickListeners.addFunction(i.listener);break;case"mouseleftclick":this.mouseLeftClickListeners.addFunction(i.listener);break;case"mousemiddleclick":this.mouseMiddleClickListeners.addFunction(i.listener);break;case"mouserightclick":this.mouseRightClickListeners.addFunction(i.listener)}}return this},removeListeners:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;r++)if(Array.isArray(t[r]))this.removeListeners.apply(this,Zt(t[r]));else{var i=t[r];switch(i.type){case"mousedown":this.mouseDownListeners.removeFunction(i.listener);break;case"mousemove":this.mouseMoveListeners.removeFunction(i.listener);break;case"mouseup":this.mouseUpListeners.removeFunction(i.listener);break;case"wheel":this.mouseWheelListeners.removeFunction(i.listener);break;case"keydown":this.keydownListeners.removeFunction(i.listener);break;case"keyup":this.keyupListeners.removeFunction(i.listener);break;case"touchstart":this.touchStartListeners.removeFunction(i.listener);break;case"touchend":this.touchEndListeners.removeFunction(i.listener);break;case"touchmove":this.touchMoveListeners.removeFunction(i.listener);break;case"mouseclick":this.mouseClickListeners.removeFunction(i.listener);break;case"mouseleftclick":this.mouseLeftClickListeners.removeFunction(i.listener);break;case"mousemiddleclick":this.mouseMiddleClickListeners.removeFunction(i.listener);break;case"mouserightclick":this.mouseRightClickListeners.removeFunction(i.listener)}}return this},dispose:function(){return this.element.removeEventListener("contextmenu",this.oncontext,!1),this.element.removeEventListener("mousedown",this.onmousedown,!1),this.element.removeEventListener("mousemove",this.onmousemove,!1),this.element.removeEventListener("mouseup",this.onmouseup,!1),this.element.removeEventListener("wheel",this.onwheel,!1),this.element.removeEventListener("keydown",this.onkeydown,!1),this.element.removeEventListener("keyup",this.onkeyup,!1),this.element.removeEventListener("touchstart",this.ontouchstart,!1),this.element.removeEventListener("touchmove",this.ontouchmove,!1),this.element.removeEventListener("touchend",this.ontouchend,!1),this}}),Object.assign(dt.prototype,{add:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;r++)Array.isArray(t[r])?this.add.apply(this,Zt(t[r])):(t[r].shader&&this.addModelToShader(t[r].shader,t[r].model),t[r].helper&&this.addDataToHelper(t[r].helper,t[r].data));return this},addModelToShader:function(e,t){var n=this;if(Array.isArray(t))t.forEach(function(t){return n.addModelToShader(e,t)});else{if(t instanceof Ge)return this.addNodeToShader(e,t);var r=this.shadersMap.indexOf(e);if(r>-1)this.shaders[r].models.indexOf(t)<0&&this.shaders[r].models.push(t);else{var i={shader:this.enablePick?e.setDefines("ColorPick"):e,models:[t]};this.shaders.push(i),this.shadersMap.push(e)}this.models.indexOf(t)<0&&(this.models.push(t),this.root.addChild(t),this.enablePick&&t.setUniformObj({u_colorId:this.bufferPicker.id2Color(this.models.length)}))}return this},addNodeToShader:function(e,t){var n=[];t.traverse(function(e){e.model&&n.push(e.model)});var r=this.shadersMap.indexOf(e);if(r<0){var i={shader:this.enablePick?e.setDefines("ColorPick"):e,models:[]};this.shaders.push(i),this.shadersMap.push(e),r=this.shaders.length-1}for(var o=this.shaders[r].models,a=0;a<n.length;a++){var s=n[a],u=o.indexOf(s);u<0&&o.push(s),(u=this.models.indexOf(s))<0&&(this.models.push(s),this.enablePick&&s.setUniformObj({u_colorId:this.bufferPicker.id2Color(this.models.length)}))}return this.root.addChild(t),this},addDataToHelper:function(e,t){var n=this;if(Array.isArray(t))t.forEach(function(t){return n.addDataToHelper(e,t)});else{var r=this.helpersMap.indexOf(e);if(r>-1)this.helpers[r].datas.push(t);else{var i={helper:e,datas:[t]};this.helpers.push(i),this.helpersMap.push(e)}}return this},remove:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;r++)Array.isArray(t[r])?this.remove.apply(this,Zt(t[r])):(t[r].shader&&this.removeModelFromShader(t[r].shader,t[r].model),t[r].helper&&this.removeDataFromHelper(t[r].helper,t[r].data));return this},removeModelFromShader:function(e,t){var n=this;if(Array.isArray(t))t.forEach(function(t){return n.removeModelFromShader(e,t)});else{var r=this.shadersMap.indexOf(e),i=-1;r>-1&&(i=this.shaders[r].models.indexOf(t))>-1&&this.shaders[r].models.splice(i,1),(i=this.models.indexOf(t))>-1&&(this.models.splice(i,1),this.root.remove(t.node),this.enablePick&&(this.needUpdateColorId=!0))}return this},removeDataFromHelper:function(e,t){var n=this;if(Array.isArray(t))t.forEach(function(t){return n.removeDataFromHelper(e,t)});else{var r=this.helpersMap.indexOf(e);if(r>-1){var i=this.helpers[r].datas.indexOf(t);i>-1&&this.helpers[r].datas.splice(i,1)}}return this},render2Buffer:function(e){return e&&(it(this.gl,this.framebufferInfo,this.attachments),this.ScreenQuadShader.setUniformObj({u_resolution:[this.gl.canvas.width,this.gl.canvas.height]})),nt(this.gl,this.framebufferInfo),this.renderer.clear(),this.render(),nt(this.gl,null),this},render2Screen:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.ScreenQuadShader.setTexture(this.framebufferInfo.attachments[e]).renderModel(this.quad2UnitModel),this},render:function(){this.root.updateMatrix(),this.enablePick&&this.needUpdateColorId&&(this.models.forEach(function(e,t){return e.setUniformObj({u_colorId:t+1})}),this.needUpdateColorId=!1);for(var e=void 0,t=void 0,n=void 0,r=0;r<this.shaders.length;r++){e=(t=this.shaders[r]).shader;for(var i=0;i<t.models.length;i++)n=t.models[i],e.renderModel(n);e.deactivate()}for(var o=0;o<this.helpers.length;o++){e=(t=this.helpers[o]).helper;for(var a=0;a<t.datas.length;a++)(n=t.datas[a]).data&&(e.setData(n.data),n.transform&&e.model.setTransform(n.transform),n.position&&e.model.setPosition(n.position),n.rotation&&e.model.setRotation(n.rotation),n.scale&&e.model.setScale(n.scale),e.render())}},setPick:function(e){var t=this;return!!e===this.enablePick?this:(e&&(this.shadersMap.forEach(function(e){return e.setDefines("ColorPick")}),this.models.forEach(function(e,n){return e.setUniformObj({u_colorId:t.bufferPicker.id2Color(n+1)})})),e||this.shadersMap.forEach(function(e){return e.setDefines()}),this.enablePick=!!e,this.bufferPicker.setActivate(this.enablePick),this)},removeAll:function(){return this.models=[],this.shaders=[],this.shadersMap=[],this.helpers=[],this.helpersMap=[],this}}),Object.assign(vt.prototype,{_parseRawData:function(e){this.animations=vt.types[e.type](e)},resetAll:function(){return this.animations.forEach(function(e){e.clips.forEach(function(e){e.currentTime=0,e.currentIdx=0,e.sumTime=0})}),this},playAnimation:function(e){var t=this;return this._playList=[],this.animations.forEach(function(n){n.name===e&&(t._playList=[n])}),this},playAll:function(){var e=this;return this._playList=[],this.animations.forEach(function(t){return e._playList.push(t)}),this},update:function(e){for(var t=0;t<this._playList.length;t++)for(var n=this._playList[t].clips,r=0;r<n.length;r++){var i=n[r],o=i.sumTime,a=i.currentIdx,s=i.currentTime,u=i.minTime,h=i.maxTime,l=i.times,c=i.values,f=i.lerpFun,d=i.setTarget,m=i.animateMaxTime,p=i.animateMinTime;if(o+=e,(s+=e)>m&&(s%=m,a=0),i.sumTime=o,i.currentTime=s,!(s<p||s<u||s>h)){for(var v=a;v<l.length;v++)if(s<l[v]){a=v-1;break}i.currentIdx=a;var _=(s-l[a])/(l[a+1]-l[a]);f(i.currentValue,c[a],c[a+1],_),d(i.currentValue)}}}}),Object.assign(vt,{types:{gltf:function(e){for(var t=e.animations,n=e.rootNode,r=[],i=function(e){for(var i=t[e],o=i.name,a=i.clips,s=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,h=[],l=function(e){var t=a[e],r=t.findFlag,i=t.findValue,o=t.targetProp,l=t.times,c=t.values,f=t.extras,d=n.findInChildren(r,i),m=[d];!d.model&&d.gltfPrimitives&&(m=d.gltfPrimitives);var p=void 0,v=function(e){m.forEach(function(t){t[o]=e})};switch(o){case"quaternion":p=pt;break;case"weights":p=mt,v=function(e){var t={};t[f.uniformName]=e,m.forEach(function(e){e.model.setUniformObj(t)})};break;case"position":case"scale":p=mt}if(!p)return"continue";u=u<l[0]?u:l[0],s=s>l[l.length-1]?s:l[l.length-1];var _={setTarget:v,times:l,values:c,lerpFun:p,sumTime:0,minTime:l[0],maxTime:l[l.length-1],currentIdx:0,currentTime:0,currentValue:c[0].slice?c[0].slice():c[0]};h.push(_)},c=0;c<a.length;c++){l(c)}h.forEach(function(e){e.animateMaxTime=s,e.animateMinTime=u}),r.push({name:o,clips:h})},o=0;o<t.length;o++)i(o);return r}}}),e.ATTRIB_POSITION_NAME=_t,e.ATTRIB_POSITION_LOC=gt,e.ATTRIB_UV_NAME=bt,e.ATTRIB_UV_LOC=yt,e.ATTRIB_NORMAL_NAME=Et,e.ATTRIB_NORMAL_LOC=Mt,e.ATTRIB_BARYCENTRIC_NAME=At,e.ATTRIB_BARYCENTRIC_LOC=Tt,e.UNIFORM_WORLD_MAT_NAME=xt,e.UNIFORM_VIEW_MAT_NAME=Rt,e.UNIFORM_PROJ_MAT_NAME=Ot,e.UNIFORM_MVP_MAT_NAME=Pt,e.UNIFORM_VP_MAT_NAME=wt,e.UNIFORM_NORMAL_MAT_NAME=It,e.UNIFORM_MAIN_TEXTURE_NAME="u_texture",e.UNIFORM_PREFIX=Ft,e.UNIFORM_CAMPOS=St,e.ATTRIB_JOINT_0_NAME="a_joint",e.ATTRIB_WEIGHT_0_NAME="a_weight",e.ATTRIB_UV_1_NAME="a_uv1",e.ATTRIB_JOINT_1_NAME="a_joint1",e.ATTRIB_WEIGHT_1_NAME="a_weight1",e.ATTRIB_TANGENT_NAME="a_tangent",e.ATTRIB_VERTEX_COLOR_NAME="a_color",e.LINES=1,e.LINE_STRIP=3,e.TRIANGLES=Nt,e.TRIANGLE_STRIP=5,e.DYNAMIC_DRAW=35048,e.DEFINE_FLAT="FLAT",e.NEAREST=9728,e.LINEAR=9729,e.NEAREST_MIPMAP_NEAREST=9984,e.NEAREST_MIPMAP_LINEAR=9986,e.LINEAR_MIPMAP_NEAREST=9985,e.LINEAR_MIPMAP_LINEAR=9987,e.CLAMP_TO_EDGE=33071,e.MIRRORED_REPEAT=33648,e.REPEAT=10497,e.Transform=s,e.Model=Q,e.Mesh=te,e.GridAxis=an,e.Quad=sn,e.Cube=un,e.Sphere=hn,e.deIndexAttribs=ne,e.addBarycentricAttrib=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.mesh||e,r=n.attribArrays.indices.data,i=t?1:0;n.drawMode===Nt&&function(){n.attribArrays.indices&&ne(e);for(var t=n.attribArrays[_t].data.length/n.attribArrays[_t].numComponents,o=[],a=[],s=[],u=[],h=0;h<t/3;h++)1===(u=(s=[r[3*h+0],r[3*h+1],r[3*h+2]]).map(function(e){return a.indexOf(e)}))[0]&&2===u[2]?(o.push(0,1,0,0,0,1,1,0,i),a=[]):(o.push(0,0,1,0,1,0,1,0,i),a=s);n.attribArrays[At]={data:o,numComponents:3},delete n.bufferInfo,delete n.vao}()},e.Curve=ln,e.Render=cn,e.Shader=q,e.GridAxisShader=re,e.FlatTextureShader=ie,e.DynamicSkyboxShader=oe,e.PointlightShader=ae,e.ColorPointShader=se,e.PhongLightShader=ue,e.ColorpickShader=he,e.WireframeShader=le,e.MeshLineShader=ce,e.TransformShader=fe,e.GLTFShader=de,e.MeshLineModel=me,e.createBuffersFromArrays=function(e,t){var n={};return Object.keys(t).forEach(function(r){n[r]=G(e,t[r],r)}),t.indices?n.numElements=t.indices.length:n.numElements=function(e){var t=void 0,n=void 0;for(n=0;n<nn.length;n++)if(nn[n]in e){t=nn[n];break}if(n===nn.length){var r=Object.keys(e);t=qt(r,1)[0]}var i=e[t];return B(i).length/j(i,t)}(t),n},e.createBufferInfoFromArrays=W,e.isIndices=k,e.setTypedArrayToBuffer=X,e.getNumComponents=j,e.createBufferFromArray=G,e.createTexture=Ne,e.createTextures=function(e,t,n){function r(){0===o&&setTimeout(function(){i(a.length?a:void 0,s,u)},0)}var i=n||pe,o=0,a=[],s=[],u={};return Object.keys(t).forEach(function(n){var i=t[n],h=void 0;(function(e){return"string"==typeof e||Array.isArray(e)&&"string"==typeof e[0]})(i.src)&&(h=function(e,t,i){u[n]=i,o-=1,e&&a.push(e),r()},o+=1),s[n]=Ne(e,i,h)}),r(),s},e.resizeTexture=Ce,e.createProgram=c,e.createAttributesSetters=T,e.setAttributes=x,e.createUniformSetters=R,e.setUniforms=O,e.createUniformBlockSpec=P,e.createUniformBlockInfo=w,e.createUniformBlockInfos=I,e.setUniformBlock=S,e.setBlockUniforms=N,e.setBlockUniformsForProgram=C,e.createTransformFeedbackInfo=L,e.createTransformFeedback=U,e.Renderer=An,e.PerspectiveCamera=ke,e.OrthographicCamera=Be,e.OrbitControls=Tn,e.Vector2=De,e.Vector3=t,e.Spherical=ze,e.Matrix4=r,e.FileLoader=je,e.ObjLoader=xn,e.GLTFLoader=Ve,e.PointHelper=Xe,e.LineHelper=qe,e.Terrain=Cn,e.createFramebufferInfo=tt,e.bindFramebufferInfo=nt,e.readPixcelFromFrameBufferInfo=rt,e.resizeFramebufferInfo=it,e.FramebufferPicker=st,e.id2Color=ot,e.color2Id=at,e.Scene=dt,e.Controler=ft,e.Animator=vt,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=czpg.min.js.map
